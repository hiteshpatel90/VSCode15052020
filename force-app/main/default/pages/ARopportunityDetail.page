<apex:page id="oppPage" applyBodyTag="false" applyHtmlTag="false" showChat="false" showHeader="false" sidebar="false" showQuickActionVfHeader="false" standardStylesheets="false" controller="CS_AROpportunityCC"  extensions="CS_ARCCExtension" docType="html-5.0">

    <apex:composition template="ARtemplate">
        <apex:define name="bodyContent"> 
         
            <script src="https://d3js.org/d3.v3.min.js"></script>
            <script src="https://cdn.rawgit.com/jakezatecky/d3-funnel/v0.7.5/dist/d3-funnel.js"></script>
                        
            
            <style> 
                    /* Changing the modal overflow to fix the issue with scrolling issue when 2 modals are present*/
                .modal { 
                  /* overflow-y:auto; */
                } 
                #opportunity-edit-modal .modal-dialog,
                #opportunity-edit-modal .modal-content,
                #opportunity-case-modal .modal-dialog,
                #opportunity-case-modal .modal-content {
                    /* 80% of window height 
                    height: 90%; */
                }
                
                #opportunity-edit-modal .modal-body,
                #opportunity-case-modal .modal-body {
                /* 100% = dialog height, 120px = header + footer */
                    max-height: calc(100% - 120px);
                    overflow-y: scroll;
                }
                .border_top_2{
                    border-top-width: 2px; 
                }
                
                .border_top_none{
                    border-top-width: 0px; 
                }
                
                .light_border_top_bottom{
                    border-top: thin solid lightgrey;
                    border-bottom: thin solid lightgrey;
                }
                
                .grey_border_right{
                    border-right: thin solid grey;
                }
                
                .grey_border_left{
                    border-left: thin solid grey;
                }
                
                .nopadding {
                   padding: 0 !important; 
                }
                
                .menu_btn{
                    width: 140px;
                }
                
                .font-large {
                    font-size: large;
                }
                 
                .chart_table {
                    border-top: thin solid lightgrey;
                }
                
                .chart_table tbody tr, .chart_table tfoot tr {
                    text-align: left;
                    height: 30px;
                }
                /* .ibox{
                    background-color: white;
                } */
                .ibox_border{
                    border: 1px solid lightgrey;
                }
                
                .ct-series-a .ct-bar {
                      /* Colour of your bars 
                      stroke: teal;*/
                      /* The width of your bars */
                      stroke-width: 20px;
                }
                
                .fa-2x {
                
                    width: 50px;
                    text-align: center;
                }
                /* .row {
                    display: table;
                }
                
                [class*="col-"] {
                    float: none;
                    display: table-cell;
                    vertical-align: top;
                } */
                .row_match_height {
                  display: -webkit-box;
                  display: -webkit-flex;
                  display: -ms-flexbox;
                  display:         flex;
                  flex-wrap: wrap;
                }
                .row_match_height > [class*='col-xs-8'] {
                  display: flex;
                  flex-direction: column;
                }
                
                
                /*
                    From reports
                */
                div.stat h4, div.stat h2, div.stat p {
                    margin: 0px;
                    font-weight: bold;
                }
                h2.cat-title {
                    margin: 15px;
                }
                div.stat > div {
                    padding: 10px;
                }

                div.chart {
                    font-size: 1rem;
                }

                .text-blue {
                    color: #325996;
                }
                .ct-blue {
                    stroke: #325996;
                }
                .ct-red {
                    stroke: #ed5565;
                }
                .ct-green {
                    stroke: #9cc984;
                }
                .ct-gray {
                    stroke: #D3D3D3;
                }                

                div.donut-ytd-quota, div.donut-mtd-quota {
                    text-align: center;
                    position: relative;
                    font-size: 2rem;
                }

                div.donut-divider-container {
                    height: 2px;
                }
                div.donut-divider-container > div.donut-divider {
                    background-color: #325996;
                    padding:0px;
                    margin:0px;
                    width:50px; /* this must be the same as the stroke-width for the chart */
                    height:4px;
                    float:right
                }
                div.donut-divider > div.donut-divider-text {
                    color: #325996;
                    width:25px;
                    text-align:center;
                    padding: 0px;
                    margin: 0px;
                    position: relative; 
                    left: -26px; 
                    top: -7px;
                    font-weight: bold;
                    font-size: 1.25em;
                } 
                
                .readonly-control{
                    border: lightgray thin solid;
                    padding-left: 10px;
                }
                
                .related-table{
                    border: thin solid lightgrey;
                }
                
                .related-table td, .related-table th {
                    border:none
                }
                
                .related-table caption{
                    padding-bottom: 0px;
                    padding-top: 20px;
                }
                
                .muted_label{
                    padding-top: 0px;
                    color: #9c9a9a; /*lightgrey;*/
                    min-height: 25px !important;
                }
                
                .detail_div{
                    margin-bottom: 25px !important;
                }
                
                .GGrid-content {
                    border-top-color: #151516 !important;
                    height: inherit !important;
                }
                
                .subsection_header{
                    font-size: 18px;
                    margin-left: 15px;
                }
                
                .fa-border{
                    background-color: #545454;
                }
                .fa-meeting-background{
                    background-color: #a94442 !important;
                }
                .fa-meeting-task{
                    background-color: #3c763d !important;
                    /* added by chad */
                    font-size: 1.5em;
                    /* end added by chad */
                }

                /*  Vishnu Release 4.4  */
                .fa-meeting-lead{
                    background-color: #f78a04 !important;
                    font-size: 1.5em;
                }
                /*  Vishnu Release 4.4  */
                
                /*added by srinivas.sattoor on 8.21.2017 for release 4.4 CID-000440*/
                .fa-meeting-attachment{
                    background-color: #FFA500 !important;
                    /* added by chad */
                    font-size: 1.5em; 
                }
                .fa-meeting-surgicalcase{
                    background-color: #337ab7 !important;
                    font-size: 1.5em;
                }
                .fa-meeting-note{
                    background-color: #ed5565 !important;
                    font-size: 1.5em;
                }
                .fa-meeting-log{
                    background-color: #f8ac59 !important;
                    font-size: 1.5em;
                }
                
                .nav-tabs { border-bottom: 2px solid #DDD; }
                .nav-tabs > li.active > a, .nav-tabs > li.active > a:focus, .nav-tabs > li.active > a:hover { border-width: 0; }
                .nav-tabs > li > a { border: none; color: #666; }
                    .nav-tabs > li.active > a, .nav-tabs > li > a:hover { border: none; color: #4285F4 !important; background: transparent; }
                    .nav-tabs > li > a::after { content: ""; background: #4285F4; height: 2px; position: absolute; width: 100%; left: 0px; bottom: -1px; transition: all 250ms ease 0s; transform: scale(0); }
                .nav-tabs > li.active > a::after, .nav-tabs > li:hover > a::after { transform: scale(1); }
                .tab-nav > li > a::after { background: #21527d none repeat scroll 0% 0%; color: #fff; }
                .tab-pane { padding: 15px 0; }
                .tab-content{padding:20px}
                
               
                    /*  CSS for breadcrumbs */
                .breadcrumbs_side{
                    padding: 5px;
                }  
                ul {
                  list-style: none;
                  margin: 0px;
                  padding-left: 0px;
                }
                
                .cf:before, .cf:after {
                  content: ' ';
                  display: table;
                }
                .cf:after {
                  clear: both;
                }
                .inner {
                  max-width: 820px;
                  margin: 0 auto;
                }
                
                .breadcrumbs {
                  background-color: white;  /*#f5f5f5*/
                }
                
                .breadcrumbs ul {
                    border: 1px solid #ddd;
                    border-top-left-radius: 20px;
                    border-bottom-left-radius: 20px;
                    border-top-right-radius: 20px;
                    border-bottom-right-radius: 20px;
                }
                
                .breadcrumbs li {
                  float: left;
                  width: 20%;
                }
                .breadcrumbs li:first-child a{border-top-left-radius: 20px; border-bottom-left-radius: 20px;  }
                .breadcrumbs li:last-child a{border-top-right-radius: 20px; border-bottom-right-radius: 20px;  }
                
                .breadcrumbs a {
                  position: relative;
                  display: block;
                  padding: 5px;
                  padding-right: 0 !important;
                  /* important overrides media queries */
                  font-size: 12px;
                  font-weight: bold;
                  text-align: center;
                  color: #aaa;
                  cursor: pointer;
                  white-space: nowrap;
                  /*overflow: hidden;*/
                  text-overflow: clip;
                }
                
                .breadcrumbs a:hover {
                  background: #eee; /*TODO: need to change*/
                }
                .breadcrumbs a.active {
                  color: white;
                  background-color: rgb(75, 202, 129);
                }
                
                .breadcrumbs a.current {
                  color: white;
                  background-color: rgb(0, 112, 210);
                }
                
                .breadcrumbs a.won {
                  color: white;
                  background-color: rgb(4, 132, 75);
                }
                
                .breadcrumbs a.lost {
                  color: white;
                  background-color: rgb(212, 80, 76);
                } 
                
                .breadcrumbs a.active span:first-child {
                    display: inline-block;
                    width: 22px;
                    height: 22px;
                    padding: 2px;
                    margin-right: 5px;
                    color: white;
                    border: none;
                    background-color: rgb(75, 202, 129);
                }
                
                .breadcrumbs a.current span:first-child {
                    display: inline-block;
                    height: 22px;
                    padding: 2px;
                    /*width: 22px;
                    margin-right: 5px;
                    color: white;
                    border: none;
                    background-color: rgb(0, 112, 210);*/
                }
                
                .breadcrumbs a.won span:first-child {
                    display: inline-block;
                    /*width: 22px;*/
                    height: 22px;
                    padding: 2px;
                    margin-right: 5px;
                    color: white;
                    border: none;
                    background-color: rgb(4, 132, 75);
                }
                
                .breadcrumbs a.lost span:first-child {
                    display: inline-block;
                    /* width: 22px; */
                    height: 22px;
                    padding: 2px;
                    margin-right: 5px;
                    color: white;
                    border: none;
                    background-color: rgb(212, 80, 76);
                }
                
                .breadcrumbs a:before,
                .breadcrumbs a:after {
                  content: '';
                  position: absolute;
                  top: 0;
                  left: 100%;
                  z-index: 1;
                  display: block;
                  width: 0;
                  height: 0;
                  border-top: 16px solid transparent;
                  border-bottom: 16px solid transparent;
                  border-left: 8px solid transparent;
                }
                
                .breadcrumbs a:before {
                  margin-left: 1px;
                  border-left-color: #d5d5d5;
                }
                
                .breadcrumbs a:after {
                  border-left-color: white;
                }
                
                .breadcrumbs a:hover:after {
                  border-left-color: #eee;
                }
                
                .breadcrumbs a.active:after {
                  border-left-color: rgb(75, 202, 129);
                }
                
                .breadcrumbs a.current:after {
                  border-left-color: rgb(0, 112, 210);
                }
                
                .breadcrumbs a.won:after {
                  border-left-color: rgb(4, 132, 75);
                }
                
                .breadcrumbs a.lost:after {
                  border-left-color: rgb(212, 80, 76);
                }
                
                .breadcrumbs li:last-child a:before,
                .breadcrumbs li:last-child a:after {
                  display: none;
                }
                
                @media (max-width: 520px) {
                    .breadcrumbs_side{
                        padding: 5px;
                    } 
                  .breadcrumbs a {
                    padding: 5px;
                  }
                
                  .breadcrumbs a:before,
                  .breadcrumbs a:after {
                    border-top-width: 16px;
                    border-bottom-width: 16px;
                    border-left-width: 8px;
                  }
                
                  .breadcrumbs li a span:first-child {
                    display: block;
                    margin: 0 auto;
                  }
                
                  .breadcrumbs li a span:last-child {
                    display: none;
                  }
                }
                
                /*
                    Dependent list table style
                */
                .filterable {
                    margin-top: 15px;
                }
                .filterable .panel-heading .pull-right {
                    margin-top: -20px;
                }
                .filterable .filters input[disabled] {
                    background-color: transparent;
                    border: none;
                    cursor: auto;
                    box-shadow: none;
                    padding: 0;
                    padding-top: 11px;
                    height: auto;
                }
                .filterable .filters input[disabled]::-webkit-input-placeholder {
                    color: #333;
                }
                .filterable .filters input[disabled]::-moz-placeholder {
                    color: #333;
                }
                .filterable .filters input[disabled]:-ms-input-placeholder {
                    color: #333;
                }
            </style>
            
            <script type="text/javascript"> 
                
                var OPPORTUNITY_LIST;
                var LINKED_CASES_LIST;
                var LINKED_OPPS_LIST;
                var TOTAL_OPPORTUNITIES_WON;
                var NO_OF_ROWS_TO_DISPLAY=8;
                var OPP_STAGE_CLOSED_WON = "Closed - Won";
                var OPP_STAGE_CLOSED_LOST = "Closed - Lost";
                var DASHBOARD_FILTER_SELECTION=[];
                var MAP_TERRITORY_ID_CHILD_IDS={};
                var opportunityId = GetURLParameter('id');
                var OBJOPPORTUNITY;
                 
            
                $(document).ready(function() {                    
                        
                    // set Opportunity related UI status
                    $('#opportunities').addClass('active');
                    $("h2.title-icon-container i").removeClass().addClass("fa fa-line-chart");
                    
                    //$("#dashboardFilter").hide();
                    $("#oppListing").hide();
                    $("#listingFilter").hide();
                    $("#oppDetailsView").hide();
                    
                    $("#oppDashboardBtn").hide();
                    
                    
                    Visualforce.remoting.Manager.invokeAction("CS_AROpportunityCC.retrieveOpportunity",
                        opportunityId,
                        function(result, event) {
                        //console.log('##--retrieveOpportunity.result :'+ JSON.stringify(result));
                        OBJOPPORTUNITY = result;
                        $('#opportunity-modal').modal('hide');
                        showOppDetailsView();
                        populateOpportunityDetailsView(result);  
                        showOpportunityDetailFields(result.opportunityType);
                        showClosedLostReason(result.currentStage);
                        switchOpportunityView('DetailView');
                        setupCreateOppModal();
                         
                        //populate competitive conversion picklist values
                        populateCompetitiveConversion();
                        //populate competitive company picklist values
                        populateCompetitiveCompanies();
                    }); //  end of remote call  
                    
                   
                    // added by chad for 4.1
                    // setup a delegated click handler for this activity
                    // refactor the call of linkactivity from inline click handler to jquery delegated event so
                    // we can avoid the complex string escape on the notes field and just pass the opp directly
                    $("#tab-activities").on("click", ".activity-link", function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        var thisRecordId = $(this).parent().prop("id")
                        linkActivity(window.oppActivities[thisRecordId]);                    

                    });
                    
                    
               
                    
                    $('#opportunity-notes-modal').on('hidden.bs.modal', function (e) {
                    
                        $('#opportunity-notes-modal textarea#oppNotes').val('');
                    
                    });
                    
                    //Added by Mimansha Samal for Save Warning modal
                    $("#cancel-opportunity-notes-modal button.btn-cancel-opp-notes-warning").on("click", function(e) {                     
                        $("#cancel-opportunity-notes-modal").modal('hide');
                        $("#opportunity-notes-modal").modal('hide');
                    }); //  end of Cancel Opp Notes modal.cancel click
                    
                    $("#opportunity-notes-modal button.btn-cancel-opportunity-notes").on("click", function() {
               
                        $("#cancel-opportunity-notes-modal").modal("show");                   
                    }); //  end of Opp Notes modal.cancel click
                    
                     $("#cancel-opportunity-modal button.btn-cancel-opportunity-card").on("click", function(e) {                     
                        $("#cancel-opportunity-modal").modal('hide');
                        $("#opportunity-edit-modal").modal('hide');
                        
                          <!--CID - CDID-000065/Swetha P/Dec/9/2016/Edit opportunity Page holding values -->
                      
                        Visualforce.remoting.Manager.invokeAction("CS_AROpportunityCC.retrieveOpportunity",
                             opportunityId,
                             function(result, event) {      
                              populateOpportunityEditView(result, false);
                             }); //  end of remote call
                         <!--CID - CDID-000065/Swetha P/Dec/9/2016/Edit opportunity Page holding values -->
                      
      
                    }); //  end of opp type modal.cancel click
                    
                    
                    $("#opportunity-edit-modal button.opportunity-save-btn").on("click", function() {
                        
                        //console.log('##--save button clicked');
                        $('opportunity-edit-modal #newOppErrors').html('');
                        
                        if(isEditOpportunityInputsValid()){
                            //console.log('##--opportunityisValid');
                            if (!isClosedLostPopulatedWhenStageIsClosed()){
                            
                                $("#opportunity-edit-modal #newOppErrors").html('Closed lost reason is required when stage is closed.');
                            
                            }else {
                                $(this).text("Saving...");
                                $("#opportunity-edit-modal button").attr("disabled","true");
                                saveOpportunity();
                            }
                        }  else{
                            
                            $("#opportunity-edit-modal #newOppErrors").html('All fields are required.');
                        }
                        
                    }); //  end of opp type modal.save click
                    
                    //added by srinivas.sattoor on 8.21.2017 for release 4.4 CID-000440 
                    $("#attachment-modal button.download").on("click", function(e) {
                        
                        var attachmentId =$("#attachment-modal").attr('data-rec-id') || '';
                        console.log('Clicking download button');
                        //var attachmentId =$("#attachment-modal").attr('data-rec-id') || '';
                        console.log('##--attachment modal: attachment Id: '+ attachmentId);
                        window.open('/sfc/servlet.shepherd/version/download/'+attachmentId);
                    });
                    
                    //added by srinivas.sattoor on 8.21.2017 for release 4.4 CID-000440 
                    $("#attachment-modal button.delete").on("click", function(e) {
                        var attachmentId =$("#attachment-modal").attr('data-rec-id') || '';
                        if(attachmentId != ''){ 
                         
                            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.deleteOpportunityAttachment}",
                             attachmentId,
                               function(result, event) {
                                if(event.statusCode == 200){
                                    loadOpportunityActivities($("#oppDetailsView select#activityFilter").val()); 
                                    $("#attachment-modal").modal("hide");
                                }
                            }); 
                        }
                    });
                    //added by srinivas.sattoor on 8.21.2017 for release 4.4 CID-000440 
                    var attachment; 
                    var attachmentName;
                    var fileSize;
                    var maxStringSize = 6000000;//Maximum String size is 6,000,000 characters
                    var maxFileSize = 4350000; //After Base64 Encoding, this is the max file size
                    var chunkSize = 950000; //Maximum Javascript Remoting message size is 1,000,000 characters 
                    var positionIndex;
                    var doneUploading;
                    $("#attachment-modal button.save").on("click", function(e) { 
                      console.log('##-- button clicked');
                      var attachmentId =$("#attachment-modal").attr('data-rec-id') || '';
                      
                      if(attachmentId != ''){
                      
                        var updatedFileName = $("#attachment-modal input#oppFileName").val();
                         
                         Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.updateOpportunityAttachment}",
                                        attachmentId, updatedFileName,
                                        function(result, event) {
                                            if(event.statusCode == 200){
                                                loadOpportunityActivities($("#oppDetailsView select#activityFilter").val()); 
                                                $("#attachment-modal").modal("hide");
                                            }
                         });
                      
                      }
                      
                      
                      var fileInput = document.getElementById('oppFileInput');    
                      var file = fileInput.files[0];
                      if(file != undefined) { 
                          if(file.size <= maxFileSize) {
                              var fileReader = new FileReader();
                              
                              var FileUploadPath = fileInput.value;
                              var fileName = FileUploadPath.substring(FileUploadPath.lastIndexOf("\\") + 1);
                              console.log('##--FileUploadPath: '+ FileUploadPath);
                              console.log('##--fileName: '+ fileName);
                              console.log('##--fileInput: '+ JSON.stringify(fileInput));
                              var Extension = FileUploadPath.substring(FileUploadPath.lastIndexOf('.') + 1).toLowerCase();
                              //Swetha Penmethsa --- 3.2 Release --Apr21---for Picture Validation 
                              if (Extension == "pdf" || Extension == "gif" || Extension == "png" || Extension == "bmp" || Extension == "jpeg" || Extension == "jpg"
                                || Extension == "zip" || Extension == "xls" || Extension == "ppt" || Extension == "docx") {
                               
                                  fileReader.onloadend = function(e) {
                              
                                    attachment = window.btoa(this.result);  //Base 64 encode the file before sending it
                                    
                                    positionIndex=0;
                                    fileSize = attachment.length;
                                    console.log("Total Attachment Length: " + fileSize);
                                    doneUploading = false;
                                    
                                     
                                    if(fileSize < maxStringSize) {
                                               
                                        var attachmentBody = "";
                                        if(fileSize <= positionIndex + chunkSize) {
                                            attachmentBody = attachment.substring(positionIndex);
                                            doneUploading = true;
                                        } else {
                                            attachmentBody = attachment.substring(positionIndex, positionIndex + chunkSize);
                                        }
                                        Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.saveOpportunityAttachment}",
                                           $("#oppDetailsView input#opportunityId").val(), attachmentBody, fileName,
                                          function(result, event) {
                                               if(event.statusCode == 200){
                                               
                                               loadOpportunityActivities($("#oppDetailsView select#activityFilter").val());
                                               
                                                $("#attachment-modal").modal("hide"); 
                                               }
                                          
                                          }); //  end of remote call 
                                          
                                    } else {
                                        alert("Base 64 Encoded file is too large.  Maximum size is " + maxStringSize + " your file is " + fileSize + ".");
                                    }
                                    
                                }
                              }else{
                                  alert('Please upload images only.');
                              } 
                              fileReader.onerror = function(e) {
                                alert("There was an error reading the file.  Please try again.");
                              }
                              fileReader.onabort = function(e) {
                                alert("There was an error reading the file.  Please try again.");
                              }
                             
                              fileReader.readAsBinaryString(file);  //Read the body of the file
                              
                           }
                              
                           else {
                              alert("File must be under 500 KB in size.  Your file is too large.  Please try again.");
                            }
                      }
                  });
                    
                    //on click of opportunity detail drop down
                    $(".dropdown-menu").on("click", "li", function(event){
                    //$(".dropdown-menu").change(function(event){
                        //console.log("You clicked the drop downs", event)
                        
                          <!--CID - CDID-000011/Sweth P/Dec/9/2016/ Edit Opportunity form is holding the previous data even after cancelling the editting-->
                        
                       var value = $(this).val();
                        var selectedValue = parseInt(jQuery(this).val());
                        $("#opportunity-edit-modal select.stage").val($("#tab-opportunityDetail div.stage").text());
                        $("#opportunity-edit-modal input.opportunityName").val($("#tab-opportunityDetail div.opportunityName").text());
                        $("#opportunity-edit-modal input.account").val ($("#tab-opportunityDetail div.accountName").text());
                        $("#opportunity-edit-modal select.competitive-company").val($("#tab-opportunityDetail div.competitiveCompany").text());
                        $("#opportunity-edit-modal input.totalProductAmount").val($("#tab-opportunityDetail div.totalProductAmount").text());
                        $("#opportunity-edit-modal input.annualNumberOfProcedures").val($("#tab-opportunityDetail div.annualNumberOfProcedures").text());
                        $("#opportunity-edit-modal input.potentialRevenuePerCase").val($("#tab-opportunityDetail div.potentialRevenuePerCase").text());
                        
                         var cDate =  $("#tab-opportunityDetail div.closeDate").text();
                         
               <!--CID - CDID-000065/Swetha P/Dec/9/2016/ Edit page holding previous data/qdate -->
               
                  if(cDate != undefined && cDate != '-'){
                      var tempDate = cDate.split("-");
                   if(tempDate != undefined && tempDate.length > 1){
                      var actualDate = tempDate[0] + "/" + tempDate[1] + "/" + tempDate[2];
                   $("#opportunity-edit-modal input.closeDate").val(actualDate);
                        }
                        }
                      var qDate =  $("#tab-opportunityDetail div.quoteDate").text();
                 if(qDate != undefined && qDate != '-'){
                  
                      var tempqDate = qDate.split("-");
                      
               if(tempqDate != undefined && tempqDate.length > 1){
                      var actualQuoteDate = tempqDate[0] + "/" + tempqDate[1] + "/" + tempqDate[2];
                      
                   $("#opportunity-edit-modal input.quoteDate").val(actualQuoteDate);
                       }
                       }
                        <!--CID - CDID-000065/Swetha P/Dec/9/2016/ Edit page holding previous data/qdate -->
                        
                      <!--CID - CDID-000011/Swetha P/Dec/9/2016/ Edit Opportunity form is holding the previous data even after cancelling the editting-->
                          

                        $("#opportunity-edit-modal input.totalAnnualPotential").val($("#tab-opportunityDetail div.totalAnnualPotential").text());
                        $("#opportunity-edit-modal input.quoteId").val($("#tab-opportunityDetail div.quoteId").text());
                        $("#opportunity-edit-modal select.productCategory").val($("#tab-opportunityDetail div.productCategory").text());
                       
                        $("#opportunity-edit-modal select.opportunity-owner").val(document.getElementById('oppOwnerId').value);
                        $("#opportunity-edit-modal select.competitive-conversion").val($("#tab-opportunityDetail div.competitiveConversion").text());
                        $("#opportunity-edit-modal select.opportunity-type").val($("#oppDetailsView div.oppTypeName").text());
                        
                         
                          <!--CID - CDID-000011/Swetha P/Dec/9/2016/ Edit Opportunity form is holding the previous data even after cancelling the editting-->
                          
                        //Depend on Value i.e. 0 or 1 respective function gets called. 
                        switch(selectedValue){
                            case 0:
                                //handlerFunctionA();
                                break;
                            case 1:
                                //handlerFunctionB();
                                break;
                            //etc... 
                            default:
                                alert("catch default");
                                break;
                        }
                    });
                    
                    $('#opportunity-modal').on('hidden.bs.modal', function (e) {
                        $('#opportunity-modal input.clear-on-close').val('');
                        $('#opportunity-modal select.clear-on-close').val('');
                        $('#opportunity-modal div.clear-on-close').empty();
                        $('#opportunity-modal #newOppErrors').html('');
                        $('#opportunity-modal button.opportunity-save-btn').text('Save');
                        $("#opportunity-modal button").removeAttr('disabled');
                        
                        if($("#opportunity-modal .opportunity-owner option[value='"+currentUserId+"']").length > 0){
                            $('#opportunity-modal .opportunity-owner').val(currentUserId);
                        } else{
                            $('#opportunity-modal .opportunity-owner').val("");
                        }
                    });
                    
                    /*Opportunity Surgeon add modal logic starts here */
                    $('#opportunity-surgeon-add-modal').on('hidden.bs.modal', function (e) {
                        $('#opportunity-surgeon-add-modal input.clear-on-close').val('');
                        $('#opportunity-surgeon-add-modal select.clear-on-close').val('');
                        $('#opportunity-surgeon-add-modal div.clear-on-close').empty();
                        $('#opportunity-surgeon-add-modal #newOppContactErrors').html('');
                        //added by srinivas sattoor on 7.4.2017 for 4.1 CDID-000383
                        $('#opportunity-surgeon-add-modal #newSurgeonErrors').html('');
                        $('#opportunity-surgeon-add-modal input[type="checkbox"]').attr('checked', false);
                    });
                     
                    $('#opportunity-surgeon-add-modal').on('show.bs.modal', function (e) {
                        //  populate the Opportunity Name
                        $("#opportunity-surgeon-add-modal p#opportunity-name").html($("#oppDetailsView div.opportunityName").html());
                        
                            //  populate the list of contacts
                        $("#opportunity-surgeon-add-modal i.surgeon-add-busy").show();
                        var selectedOwner = '';
                        selectedTeam = $("#oppDetailsView #hiddenAccountTeamId").val();
                        
                        console.log('##--#opportunity-surgeon-add-modal.selectedTeam: '+selectedTeam);
                        $("#opportunity-surgeon-add-modal .surgeon-typeahead").val(""); 
                        $("#opportunity-surgeon-add-modal div.surgeon.ctag-list").empty();
                        $("#opportunity-surgeon-add-modal input.surgeon-typeahead").typeahead("destroy");
                        //Visualforce.remoting.Manager.invokeAction("CS_ARCCExtension.retrievePractitioners",
                        Visualforce.remoting.Manager.invokeAction("CS_ARCCExtension.retrievePractitionersByOwner",
                        selectedOwner,
                        selectedTeam,
                        function(result, event) {
                            
                            // setup the surgeon type ahead options
                             var surgeonTypeAheadOptions = {
                                minLength: 0,
                                items: 50,
                                source: result,
                                showHintOnFocus: false,                    
                                displayText: function(item) {
                                    return globalDecodeEntities(item.objAccount.Name);
                                },
                                afterSelect: function(item) {
                                    
                                    var practId = item.Id; 
                                    if ( $("#opportunity-surgeon-add-modal span[data-record-id="+item.objAccount.Id+"].ctag").length === 0 
                                        &&  $("#divSurgeonSummary div#"+item.Id).length === 0) {
                                        // no duplicates and can't add yourself
                                        $("#opportunity-surgeon-add-modal div.ctag-list.surgeon").append(obj2ctag(item.objAccount));
                                    }
                                    $("#opportunity-surgeon-add-modal .surgeon-typeahead").val("");
                                    
                                }            
    
                            };
    
                            // init the type ahead
                            $("#opportunity-surgeon-add-modal input.surgeon-typeahead").typeahead(surgeonTypeAheadOptions);
                            $("#opportunity-surgeon-add-modal i.surgeon-add-busy").hide();
                        }); //  end of remote call
                        //populateSurgeonTypeahead();
                        
                    }); //  opportunity surgeon add modal show event
                    
                    
                    $("#opportunity-surgeon-add-modal button.surgeon-add-save-btn").on("click", function() {
                        
                        $('#opportunity-surgeon-add-modal #newSurgeonErrors').html('');
                        var surgeons = [];
                        var surgeonAlreadyExistsError = false;
                        
                        $("#opportunity-surgeon-add-modal div.surgeon").children().each(function() {
                            var surgeonId = $(this).attr("data-record-id");
                            if($('#divSurgeonSummary').children('div[data-surgeon-id='+surgeonId+']').length != 0){
                                surgeonAlreadyExistsError = true;
                            }else{
                                surgeons.push($(this).attr("data-record-id"));
                            }
                        });
                        
                        if(surgeonAlreadyExistsError){
                            $("#opportunity-surgeon-add-modal #newSurgeonErrors").html('Surgeon already exists. Please add a different surgeon.');
                        }else if (! surgeons.length == 0 ){
                            var oppId = $("#oppDetailsView input#opportunityId").val();
                            console.log('##--opportunity-surgeon-add-modaloppId: '+ oppId);
                            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.saveOpportunitySurgeons}",
                                oppId,
                                surgeons,
                                function(result, event) {  
                                    
                                if(event.statusCode == 200){
                            
                                    $('#opportunity-surgeon-add-modal').modal('hide'); 
                                    populateOpportunityDetailsView(result); 
                                    showOpportunityFields(result.opportunityType);
                                    showClosedLostReason(result.currentStage);
                                    loadOpportunityActivities($("#oppDetailsView select#activityFilter").val());
                                
                                } else{
                                    $("#opportunity-surgeon-add-modal #newSurgeonErrors").html('Unexpected error. Please try again.');
                                }
                              });   //  end of remote call
                            
                        } else{
                            $("#opportunity-surgeon-add-modal #newSurgeonErrors").html('Please select atleast one surgeon.');
                            
                        }
                        
                    }); //  end of opp type modal.save click
                    
                    /*Opportunity surgeon add logic ends here*/
                    
                    
                    /*Opportunity Contact Role modal logic starts here */
                    $('#opportunity-contact-modal').on('hidden.bs.modal', function (e) {
                        $('#opportunity-contact-modal input.clear-on-close').val('');
                        $('#opportunity-contact-modal select.clear-on-close').val('');
                        $('#opportunity-contact-modal div.clear-on-close').empty();
                        $('#opportunity-contact-modal #newOppContactErrors').html('');
                        $('#opportunity-contact-modal input[type="checkbox"]').attr('checked', false);
                    });
                    
                    $('#opportunity-contact-modal').on('show.bs.modal', function (e) {
                        //  populate the Opportunity Name
                        $("#opportunity-contact-modal p#opportunity-name").html($("#oppDetailsView div.opportunityName").html());
                        $("#opportunity-contact-modal button.contact-save-btn").prop("disabled",false);
                        
                            //  populate the list of contacts
                        $("#opportunity-contact-modal i.contact-busy").show();
                        var oppId = $("#oppDetailsView input#opportunityId").val();
                        //moved below functionality to picklist option
                       /* Visualforce.remoting.Manager.invokeAction("CS_ARCCExtension.searchOpportunityContacts",
                        $("#oppDetailsView #hiddenAccountId").val(),
                        oppId,
                        function(result, event) {
                           
                           console.log('##--result: '+ result);
                            // setup the surgeon type ahead options
                            var contactTypeAheadOptions = {
                                minLength: 0,
                                items: 50,
                                source: result,
                                showHintOnFocus: false,                    
                                displayText: function(item) {
                                    return globalDecodeEntities(item.Name);
                                    /*
                                    if(!item.length){
                                        return "No Results";
                                    }else{
                                        return globalDecodeEntities(item.Name);
                                    }* /
                                },
                                afterSelect: function(item) {
                                    $("#opportunity-contact-modal input.opportunity-contact").val(globalDecodeEntities(item.Name));
                                    $("#opportunity-contact-modal input.opportunity-contact").attr("data-record-id", item.Id);   
                                }
                            };
                            // init the type ahead
                            $("#opportunity-contact-modal input.opportunity-contact-typeahead").typeahead(contactTypeAheadOptions);
                            $("#opportunity-contact-modal i.contact-busy").hide();
                        }); */ //  end of remote call
                        
                            //  populate contact roles
                        $("#opportunity-contact-modal i.contact-role-busy").show();
                        var selectList = $("#opportunity-contact-modal select.contact-role");
                        selectList.find("option:gt(0)").remove();
                        Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.retrieveOpportunityContactRoleValues}",
                            function(result, event) { 
                              for ( var i=0; i < result.length; i++) {
                                  var txt = globalDecodeEntities(result[i]);
                                  $("#opportunity-contact-modal select.contact-role").append("<option value='"+txt+"'>"+txt+"</option>");
                              }
                              
                              $("#opportunity-contact-modal i.contact-role-busy").hide();
                          });   //  end of remote call
                          
                        //populating options for opportunity contacts
                        $("#opportunity-contact-modal i.opportunity-contact-busy").show();
                        //var oppContactselectList = $("#opportunity-contact-modal select.opportunity-contact");
                        //oppContactselectList.find("option:gt(0)").remove();
                        $("#opportunity-contact-modal select.opportunity-contact")
                                        .find('option')
                                        .remove()
                                        .end()
                                        .append('<option value="">-Select One-</option>')
                                    ;
                        var oppId = $("#oppDetailsView input#opportunityId").val();
                        Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_ARCCExtension.searchOpportunityContacts}",
                            $("#oppDetailsView #hiddenAccountId").val(),
                            oppId,
                            function(result, event) { 
                              
                              if(result.length == 0){
                                //oppContactselectList.remove();
                                $("#opportunity-contact-modal select.opportunity-contact")
                                        .find('option')
                                        .remove()
                                        .end()
                                        .append('<option value="">No contacts found</option>')
                                    ;
                                $("#opportunity-contact-modal #newOppContactErrors").html('If no contacts, please add one in the customer tab under Accounts.');
                                $("#opportunity-contact-modal button.contact-save-btn").prop("disabled",true);
                              }else{
                                  console.log('##--opportunity Contact result: '+ JSON.stringify(result));
                                  for ( var i=0; i < result.length; i++) {
                                      var txt =  result[i];
                                      console.log('##--opportunity Contact: '+ JSON.stringify(txt));
                                      $("#opportunity-contact-modal select.opportunity-contact").append("<option value='"+txt.Id+"'>"+txt.Name+"</option>");
                                  }
                              }
                              
                              $("#opportunity-contact-modal i.opportunity-contact-busy").hide();
                          });   //  end of remote call
                        
                    }); //  opportunity contact modal show event
                    
                    
                    $("#opportunity-contact-modal button.contact-save-btn").on("click", function() {
                        
                        $('#opportunity-contact-modal #newOppContactErrors').html('');
                        var contactRole = $("#opportunity-contact-modal #contact-role").val(); 
                        var contactName = $("#opportunity-contact-modal #opportunity-contact option:selected").text(); 
                        //var contactId = $("#opportunity-contact-modal #opportunity-contact").attr("data-record-id");
                        var contactId = $("#opportunity-contact-modal #opportunity-contact").val();
                        console.log('##--contactrole: '+ contactRole);
                        console.log('##--contactId: '+ contactId);
                        console.log('##--contactName: '+ contactName);
                        
                        
                        if( contactId && contactId  != 0 && 
                             contactRole != 0){
                             
                            if ($('#divKeyContactsSummary').children('div[data-key-contact-id='+contactId+']').length != 0) {  
                                $("#opportunity-contact-modal #newOppContactErrors").html(contactName + ' already exists. Please add a different contact.');         
                            }else{
                                var oppId = $("#oppDetailsView input#opportunityId").val();
                                
                                //var contactRole = $("#opportunity-contact-modal #contact-role").val(); 
                                var primaryRole = $("#opportunity-contact-modal #primary-role").is(':checked');
                                console.log('##--primaryRole: '+ primaryRole);
                                Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.saveOpportunityContactRole}",
                                    oppId,
                                    contactId,
                                    contactRole,
                                    $("#opportunity-contact-modal #primary-role").is(':checked'),
                                    function(result, event) { 
                                        //console.log('##--Contact Role saved');
                                        $('#divKeyContactsSummary span#noKeyContacts').hide();
                                        var htm = "<div id='"+result.Id+"' data-key-contact-id='"+contactId+"'><dl><dt>"+contactName+"</dt><dd>"+contactRole;
                                        if(primaryRole == 1){
                                        //htm += ' <i class="fa fa-asterisk" color: red></i>';
                                        htm += '<span class="text-danger">*</span>';
                                        }
                                         htm +=     "<div class='pull-right'><a href='#' onclick='deleteSublistItem(\"ContactRole\", \""+result.Id+"\")'>Delete</a></div></dd></dl></div>";
                                         $("#divKeyContactsSummary").append(htm);
                                        //$("#divKeyContactsSummary").append("<div id='"+result.Id+"' data-key-contact-id='"+contactId+"'><dl><dt>"+contactName+"</dt><dd>"+contactRole+"<div class='pull-right'><a href='#' onclick='deleteSublistItem(\"ContactRole\", \""+result.Id+"\")'>Delete</a></div></dd></dl></div>");
                                        $('#opportunity-contact-modal').modal('hide');
                                  });   //  end of remote call
                            }
                        } else{
                            $("#opportunity-contact-modal #newOppContactErrors").html('All fields are required.');
                            
                        }
                        
                    }); //  end of opp type modal.save click
                    
                    /*Opportunity Contact Role logic ends here*/
                    
                    /*Opportunity Team Role modal logic starts here */
                    $('#opportunity-team-modal').on('hidden.bs.modal', function (e) {
                        $('#opportunity-team-modal input.clear-on-close').val('');
                        $('#opportunity-team-modal select.clear-on-close').val('');
                        $('#opportunity-team-modal div.clear-on-close').empty();
                        $('#opportunity-team-modal #newOppContactErrors').html('');
                        $('#opportunity-team-modal input[type="checkbox"]').attr('checked', false);
                    });
                    
                    $('#opportunity-team-modal').on('show.bs.modal', function (e) {
                        //  populate the Opportunity Name
                        $("#opportunity-team-modal p#opportunity-name").html($("#oppDetailsView div.opportunityName").html());
                        
                        console.log('##--setting up oppty team typeahed');
                            //  sales reps type ahead
                        $("#opportunity-team-modal .add-sales-rep-typeahead").typeahead({
                            // typeahead setup for case participants
                            minLength: 1,
                            items: 50,
                            source: function(query, onSuccess) {
                                search(query, "CS_ARCCExtension.searchUsers", onSuccess);                                    
                            },
                            displayText: function(item) {
                                return globalDecodeEntities(item.Name);
                            },
                            afterSelect: function(item) {
                                
                                $("#opportunity-team-modal input.add-sales-rep-typeahead").val(globalDecodeEntities(item.Name));
                                $("#opportunity-team-modal input.add-sales-rep-typeahead").attr("data-record-id", item.Id);
                
                            }
                        });
                        
                        
                        
                            //  populate contact roles
                        $("#opportunity-team-modal i.opportunity-team-role-busy").show();
                        var selectList = $("#opportunity-team-modal select.opportunity-team-role");
                        selectList.find("option:gt(0)").remove();
                        Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.retrieveOpportunityTeamRoleValues}",
                            function(result, event) { 
                              for ( var i=0; i < result.length; i++) {
                                  var txt = globalDecodeEntities(result[i]);
                                  $("#opportunity-team-modal select.opportunity-team-role").append("<option value='"+txt+"'>"+txt+"</option>");
                              }
                              
                              $("#opportunity-team-modal i.opportunity-team-role-busy").hide();
                          });   //  end of remote call
                        
                    }); //  opportunity contact modal show event
                    
                    
                    $("#opportunity-team-modal button.contact-save-btn").on("click", function() {
                        
                        $('#opportunity-team-modal #newOppContactErrors').html('');
                         var oppId = $("#oppDetailsView input#opportunityId").val();
                         var salesRepId = $("#opportunity-team-modal #add-sales-rep").attr("data-record-id");
                         var salesRepName = $("#opportunity-team-modal #add-sales-rep").val();
                         var opptyTeamRole = $("#opportunity-team-modal #opportunity-team-role").val(); 
                         var oppOwnerId = $("#oppDetailsView input#oppOwnerId").val();
                            
                        console.log('##--salesRepName: '+ salesRepName);
                        console.log('##--salesRepId: '+ salesRepId);
                        
                        if(salesRepId && 
                              opptyTeamRole != 0){
                            
                            if ($('#divOppTeamSummary').children('div[data-opp-team-id='+salesRepId+']').length != 0) {  
                                console.log('Error adding rep:');
                                $("#opportunity-team-modal #newOppContactErrors").html(salesRepName + ' already exists. Please add a different sales rep.');         
                            }else if(oppOwnerId == salesRepId){
                                $("#opportunity-team-modal #newOppContactErrors").html('You can not add Owner to opportunity team.');
                            }else {
                                Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.saveOpportunityTeamRole}",
                                    oppId,
                                    salesRepId,
                                    opptyTeamRole,
                                    function(result, event) { 
                                        //console.log('##--Contact Role saved');
                                        
                                        if(event.statusCode == 200){
                                            
                                            $('#divKeyContactsSummary span#noOppTeam').hide();
                                            $("#divOppTeamSummary").append("<div id='"+result.Id+"' data-opp-team-id='"+salesRepId+"'><dl><dt>"+salesRepName+"</dt><dd>"+opptyTeamRole+"<div class='pull-right'><a href='#' onclick='deleteSublistItem(\"TeamMemberRole\", \""+result.Id+"\")'>Delete</a></div></dd></dl></div>");
                                            $('#opportunity-team-modal').modal('hide');
                                        }else{
                                            $("#opportunity-team-modal #newOppContactErrors").html('Unexpected error. Please try again');
                                        }
                                  });   //  end of remote call
                            }
                            
                        } else if(salesRepId == null 
                                    && salesRepName != ''){
                            $("#opportunity-team-modal #newOppContactErrors").html('Invalid Sales rep entry.');
                        
                        }else{
                            $("#opportunity-team-modal #newOppContactErrors").html('All fields are required.');
                            
                        }
                        
                    }); //  end of opp type modal.save click
                    
                    /*Opportunity Team Role logic ends here*/
                    
                    /*Opportunity Cancel logic starts here*/
                    
                    $("#opportunity-cancel-confirm-modal button.btn-cancel-opp").on("click", function() {
                        $('#opportunity-cancel-modal #confirmation').val('confirmed');
                        $("#opportunity-cancel-confirm-modal").modal('hide');
                    });
                    
                    $('#opportunity-cancel-confirm-modal').on('hidden.bs.modal', function (e) {
                        if($('#opportunity-cancel-modal #confirmation').val() == 'confirmed'){
                            $('#opportunity-cancel-modal').modal('show');
                        }
                    });
                    
                    
                    $('#opportunity-cancel-modal').on('hidden.bs.modal', function (e) {
                        $('#opportunity-cancel-modal input.clear-on-close').val('');
                        $('#opportunity-cancel-modal select.clear-on-close').val('');
                        $('#opportunity-cancel-modal #cancelOppSaveErrors').html('');
                    });
                    
                    $('#opportunity-cancel-modal').on('show.bs.modal', function (e) {
                        //  populate the Opportunity Name
                        $("#opportunity-cancel-modal p#opportunity-name").html($("#oppDetailsView div.opportunityName").html());
                        
                            //  populate opportunity stage name as cancel
                        $("#opportunity-cancel-modal p#opportunity-stage").html('Cancelled');
                        
                        //remove the drop down list so that its not added
                        
                    }); //  opportunity contact modal show event
                    
                    $("#opportunity-cancel-modal button.contact-save-btn").on("click", function() {
                        
                        $('#opportunity-cancel-modal #newOppContactErrors').html('');
                        
                        var oppId = $("#oppDetailsView input#opportunityId").val();
                        var cancelledReason = $("#opportunity-cancel-modal #cancelledWithaReason").val();
                        //console.log('##--oppId: '+ oppId);
                        //console.log('##--cancelledReason:'+ cancelledReason);
                        
                        if( $("#opportunity-cancel-modal #cancelledWithaReason").val()){
                              
                            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.cancelOpportunity}",
                                oppId,
                                cancelledReason,
                                function(result, event) { 
                                    
                                    if(event.statusCode == 200){
                                        //console.log('##--Opportunity Cancelled saved');
                                        $('#opportunity-cancel-modal').modal('hide');
                                        //switchOpportunityView("ListView");
                                        //updating stage name and probability on detail page and edit pages
                                        $("#oppDetailsView div.stage").html(globalDecodeEntities(result.currentStage));
                                        $("#oppDetailsView div.probabilityToClose").html((result.probability || "0") + "%");
                                    }
                              });   //  end of remote call
                            
                        } else{
                            $("#opportunity-cancel-modal #cancelOppSaveErrors").html('All fields are required.');
                            
                        }
                        
                    }); //  end of opp type modal.save click
                    
                    /*Opportunity Cancel logic ends here */
                    
                    /*Opportunity Mark stage as complete logic starts here*/
                    $("#oppDetailsView button#mark-stage-as-complete-btn").on("click", function() {
                        oppId = $("#oppDetailsView input#opportunityId").val();
                        currentStage = $("ul.cf li a.current").parent();
                        nextStage = $("ul.cf li a.current").parent().next(); 
                        //console.log('##--nextStage: '+ $(nextStage).attr('data-stage') );
                        if($(nextStage).attr('data-stage')  == 'Closed - Won'){
                            $('#opportunity-stage-close-modal').modal('show');
                            
                        }else if($(nextStage).length == 0){
                            
                        } else {
                            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.saveOpportunityStage}",
                                oppId,
                                $(nextStage).attr('data-stage'),
                                '',
                                function(result, event) {
                                    
                                    if(event.statusCode == 200){
                                        OBJOPPORTUNITY= result;
                                        //console.log('##--Opportunity Stage Name: '+ result.currentStage);
                                        $(currentStage).children().first().removeClass('current');
                                        $(currentStage).children().first().addClass('active').prepend('<span><i class="fa fa-check"></i></span>');
                                        $(nextStage).children().first().addClass('current');
                                        
                                        //updating stage name and probability on detail page and edit pages
                                        $("#oppDetailsView div.stage").html(globalDecodeEntities(result.currentStage));
                                        $("#oppDetailsView div.probabilityToClose").html((result.probability || "0") + "%");
                                        
                                        $("#opportunity-modal select.stage").val(result.currentStage);
                                        $("#opportunity-modal input.probabilityToClose").val((result.probability || "") + "%");
                                        
                                        //$("#opportunity-edit-modal select.stage").val(result.currentStage);
                                        //$("#opportunity-edit-modal input.probabilityToClose").val((result.probability || "") + "%");
                                    }
                                    
                            }); //  end of remote delete call
                        }
                    }); //  end of mark stage as complete button click
                    
                    $('#opportunity-stage-close-modal').on('show.bs.modal', function (e) {
                        
                        populateCloseLostReasons($("#oppDetailsView div.oppTypeName").text());
                        //populateCloseLostReasons($("#opportunity-edit-modal #opportunity-type").val());
                        
                        
                    });
                    
                    /*Opportunity stage close-won/close-lost logic starts here*/
                    $("#opportunity-stage-close-modal button.stage-close-modal-btn").on("click", function() {
                        oppId = $("#oppDetailsView input#opportunityId").val();
                        currentStage = $("ul.cf li a.current").parent();
                        nextStage = $("ul.cf li a.current").parent().next();
                        newStage = $("#opportunity-stage-close-modal select#opportunity-stage-closed").val();
                        var closelostReason = $("#opportunity-stage-close-modal select#closed-lost-reason").val();
                        console.log('##--closelostReason: '+ closelostReason);
                        
                        if(isClosedOpportunityValid()){
                            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.saveOpportunityStage}",
                                oppId,
                                newStage,
                                closelostReason,
                                function(result, event) {
                                    
                                    if(event.statusCode == 200){
                                        //console.log('##--Opportunity Stage Name: '+ result.currentStage);
                                        
                                        populateOpportunityStageBreadCrumbs(result);
                        
                                        $("#oppDetailsView div.stage").html(globalDecodeEntities(result.currentStage));
                                        $("#oppDetailsView div.probabilityToClose").html((result.probability || "0") + "%");
                                        $("#oppDetailsView div.closeLostReason").html(globalDecodeEntities(result.closeLostReasons));
                                        
                                        $('#opportunity-stage-close-modal').modal('hide');
                                        
                                        $("#opportunity-edit-modal select.stage").val(result.currentStage);
                                        $("#opportunity-edit-modal input.probabilityToClose").val((result.probability || "") + "%");
                                        $("#opportunity-edit-modal select.closeLostReason").val(result.closeLostReasons);
                                        showClosedLostReason(result.currentStage);
                                        
                                                
                                    }else{
                                        $("#stageClosedModalErrors").html('Unexpected error. Please try again');
                                    }
                                    
                            }); //  end of remote delete call
                        } else{
                            $("#stageClosedModalErrors").html('All fields are required.');
                        }
                        
                            
                        
                    }); //
                    
                    $('#opportunity-stage-close-modal').on('hidden.bs.modal', function (e) {
                        $('#opportunity-stage-close-modal input.clear-on-close').val('');
                        $('#opportunity-stage-close-modal select.clear-on-close').val('');
                        $('#opportunity-stage-close-modal div.clear-on-close').empty();
                        $('#opportunity-stage-close-modal #stageClosedModalErrors').html('');
                        $("#divClosedLostReason").hide();
                    });
                    
                    /*Opportunity stage close-won/close-lost logic ends here*/
                
                    /* Opportunity Mark stage as complete logic ends here*/
                    $('#confirm-delete').on('click', '.btn-ok', function(e) {
                        
                        var deleteId = $("#confirm-delete #deleteId").val();
                        var deleteMethod = $("#confirm-delete #deleteMethod").val();
                        
                        if(deleteMethod == 'ContactRole'){
                            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.deleteOpportunityContactRole}",
                                deleteId,
                                function(opportuityWrapper, event) {
                                    //console.log('Successfully deleted Contact Role: ' + deleteId);
                                    $("#divKeyContactsSummary div#"+deleteId).remove();
                                    if($("#divKeyContactsSummary div").length < 1){
                                        $("#divKeyContactsSummary span#noKeyContacts").show(); 
                                    }
                                    $("#confirm-delete").modal('hide');
                                    $("#confirm-delete #deleteId").val('');
                                    $("#confirm-delete #deleteMethod").val('');
                            }); //  end of remote delete call
                        } else if(deleteMethod == 'TeamMemberRole'){
                            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.deleteOpportunityTeamMember}",
                                deleteId,
                                function(opportuityWrapper, event) {
                                    //console.log('Successfully deleted Oppty Team Role: ' + deleteId);
                                    $("#divOppTeamSummary div#"+deleteId).remove();
                                    if($("#divKeyContactsSummary div").length < 1){
                                        $("#divKeyContactsSummary span#noOppTeam").show();
                                    }
                                    $("#confirm-delete").modal('hide');
                                    $("#confirm-delete #deleteId").val('');
                                    $("#confirm-delete #deleteMethod").val('');
                            }); //  end of remote delete call
                        }else if(deleteMethod == 'OpportunitySurgeon'){
                            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.deleteOpportunitySurgeon}",
                                deleteId,
                                function(opportuityWrapper, event) {
                                    //console.log('Successfully deleted Oppty Team Role: ' + deleteId);
                                    $("#divSurgeonSummary div#"+deleteId).remove();
                                    $("#confirm-delete").modal('hide');
                                    $("#confirm-delete #deleteId").val('');
                                    $("#confirm-delete #deleteMethod").val('');
                            }); //  end of remote delete call
                        }else {
                            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.deleteLinkedOpportunity}",
                                deleteId,
                                function(opportuityWrapper, event) {
                                    //console.log('Successfully deleted Contact Role: ' + deleteId);
                                    $("#divLinkedOppsSummary div#"+deleteId).remove();
                                    $("#confirm-delete").modal('hide');
                                    $("#confirm-delete #deleteId").val('');
                                    $("#confirm-delete #deleteMethod").val('');
                            }); //  end of remote delete call
                        }
                    });
                    
                    
                    
                    $('#opportunity-modal').on('hidden.bs.modal', function (e) {
                        $('#opportunity-contact-modal input.clear-on-close').val('');
                        $('#opportunity-contact-modal select.clear-on-close').val('');
                        $('#opportunity-contact-modal div.clear-on-close').empty();
                        $('#opportunity-contact-modal #newOppContactErrors').html('');
                    });
                    
                    $('#opportunity-edit-modal input.opportunity-part-quantity').on('input',function(e){
                        calculatePartsPrice(e);
                    });
                    
                    $('#opportunity-edit-modal input.opportunity-part-unit-price').on('input',function(e){
                        calculatePartsPrice(e);
                    });
                    
                    
                    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                        //console.log('e.target: ' + e.target); // newly activated tab
                        //console.log('e.relatedTarget: '+ e.relatedTarget); // previous active tab
                        if(e.target.id == 'activities'){
                            loadOpportunityActivities('All Activities');
                        }
                    });
                    
                        //  Logic for dependent list
                        
                    $('.filterable .btn-filter').click(function(){
                        var $panel = $(this).parents('.filterable'),
                        $filters = $panel.find('.filters input[type="text"]'),
                        $tbody = $panel.find('.table tbody');
                        if ($filters.prop('disabled') == true) {
                            $filters.prop('disabled', false);
                            $filters.first().focus();
                            
                            $('input.dependent-filter').keyup(function(e){
                                performFilter(e);
                            });
                            
                        } else {
                            $filters.val('').prop('disabled', true);
                            $tbody.find('.no-result').remove();
                            $tbody.find('tr').show();
                        }
                        
                    });
                    
                    $('#opportunity-case-modal').on('hidden.bs.modal', function (e) {
                        var $panel = $(this).parents('.filterable'),
                        $filters = $panel.find('.filters input[type="text"]'),
                        $tbody = $panel.find('.table tbody');
                        
                        $filters.val('').prop('disabled', true);
                        $tbody.find('.no-result').remove();
                        $('#table-dependents tbody').empty();
                        $('#table-dependents thead tr').find('th.clear-on-close').remove();
                        
                        $('#table-dependents #checkAllDependents').attr('checked', false);
                        
                        $("#divLinkedCasesFilters").hide();
                        $("#divLinkedOpportunityFilters").hide();
                        $('#table-dependents').bootstrapTable('destroy');
                        
                    });
                    
                    $("#cancel-opportunity-case-modal button.btn-cancel-opp-case-warning").on("click", function(e) {                     
                        $("#cancel-opportunity-case-modal").modal('hide');
                        $("#opportunity-case-modal").modal('hide');
                    }); //  end of Cancel Opp Case modal.cancel click
                    
                    $("#opportunity-case-modal button.btn-cancel-opportunity-case").on("click", function() {
                        $("#cancel-opportunity-case-modal").modal("show");
                        
                        if($('#opportunity-case-modal .dependent-list-header').text() == 'Linked Opportunity Selection')
                        {
                            console.log('Opp Modal Header'+$('#opportunity-case-modal .dependent-list-header').text());
                            console.log('Inside Linkd Opp Sel');
                            $('#cancel-opportunity-case-modal .modal-title').html('Linked Opportunity Selection');
                            $('#cancel-opportunity-case-modal .dependent-opp-label').html('Do you want to save the changes you made for the Linked Opportunity Selection?');
                        }
                        else
                        {
                            console.log('Inside Else of Linkd Opp Sel');
                            $('#cancel-opportunity-case-modal .modal-title').html('Opportunity Case Selection');
                            $('#cancel-opportunity-case-modal .dependent-opp-label').html('Do you want to save the changes you made for the Opportunity Case Selection?');
                            
                        }                   
                    }); //  end of Opp Case modal.cancel click
                  
                    // added by chad

                    // saving a task
                    $("#task-modal button.save").on("click", function(e) {
                        e.stopPropagation();
                        e.preventDefault();

                        var task = taskModal2TaskObj(); /* this function is defined in ARTemplate */

                        // subject ( labeled as description on the modal ) is required
                        if ( typeof task.subject == "undefined" || task.subject.length == 0 ) {
                            $("#task-modal .help-text.required.subject").show();
                            return;
                        }

                        $(this).attr("disabled", true);
                        $("#task-modal .save-busy").show();
                        Visualforce.remoting.Manager.invokeAction("CS_AROpportunityCC.saveSFTask",task.whatIdList, task.whoIdList, task,
                        function(result, event) {
                            $("#task-modal .save-busy").hide();
                            if ( event.status ) {

                                // if taskOwnerId is "noaccess", then the owner does not have access to the account
                                if ( result.taskOwnerId == "noaccess" ) {
                                    $("#task-modal span.task-modal-error").text("The owner does not have access to the account");
                                    $("#task-modal button.save").removeAttr("disabled");
                                    return;
                                }

                                $("div.detail_div[data-record-id="+task.id+"]").find("span.notes").text(result.subject);                                                                
                                $("#task-modal").modal("hide");
                                $("span.task-modal-error").text("");
                                loadOpportunityActivities($("#oppDetailsView select#activityFilter").val());

                                
                            } else {

                                $("#task-modal span.task-modal-error").text(event.message);

                            }
                            $("#task-modal button.save").removeAttr("disabled");
                            
                        });                   
                        
                    });

                    // deleting a task just set's its status to completed
                    $("#task-modal button.delete").on("click", function(e) {
                        e.stopPropagation();
                        e.preventDefault();
                        $(this).attr("disabled", true);

                        var taskId = $("#task-modal").attr("data-record-id");

                        $("#task-modal .delete-busy").show();
                        Visualforce.remoting.Manager.invokeAction("CS_AROpportunityCC.updateTaskStatus", taskId, "Cancelled",
                        function(result, event) {
                            $("#task-modal .delete-busy").hide();
                            if ( event.status ) {

                                $("div.detail_div[data-record-id="+taskId+"]").remove();

                                $("#task-modal").modal("hide");
                                $("span.task-modal-error").text("");

                                
                            } else {

                                $("#task-modal span.task-modal-error").text(event.message);

                            }

                            $("#task-modal button.delete").removeAttr("disabled");
                            
                        });
                    });                    
                    // end added by chad

                }); //  end of ready fn
                
                //show opportunity fields based on opportunity type
                function showOpportunityDetailFields(opportunityType){
                        
                    $("#tab-opportunityDetail #divOpportunityTypeDetails").show();
                    //hide Product Conversion fields
                    $("#tab-opportunityDetail #divAnnualNumberofProcedures").hide();
                    $("#tab-opportunityDetail #divPotentialRevenuePerCase").hide();
                    $("#tab-opportunityDetail #divTotalAnnualPotential").hide();
                    $("#tab-opportunityDetail #divCurrentFYRevenue").hide();
                    $("#tab-opportunityDetail div#divCompetitiveConversion").hide();
                    $("#tab-opportunityDetail div#divCompetitiveCompany").hide();  
                    //hide SOS fields
                    
                    $("#tab-opportunityDetail #divPatientVolume").hide();
                    $("#tab-opportunityDetail #divPotentialUserNumber").hide();
                     
                    //hide Synergy Video fields
                    $("#tab-opportunityDetail #divTotalNumOfTowers").hide();
                    $("#tab-opportunityDetail #divPotentialRevenuePerTower").hide(); 
                    
                    //hide Synergy Installation fields
                    $("#tab-opportunityDetail #divTotalNumOfORs").hide();
                    $("#tab-opportunityDetail#divEquipmentCost").hide();
                    $("#tab-opportunityDetail #divLaborAndMaterials").hide();
                    $("#tab-opportunityDetail #divTotalBudgetary").hide();
                    $("#tab-opportunityDetail #divFinalPOAmount").hide();
                    $("#tab-opportunityDetail #divEstimatedInstallDate").hide();
                    $("#tab-opportunityDetail #divQuoteId").hide(); 
                    
                    //hide instrument purchase
                    $("#tab-opportunityDetail #divTotalNumOfORs").hide();
                    $("#tab-opportunityDetail #divTotalAnnualPotential").hide();
                    $("#tab-opportunityDetail #divCurrentFYRevenue").hide();
                    $("#tab-opportunityDetail #divQuoteNum").hide();
                     
                    
                    //hide stocking order
                    $("#tab-opportunityDetail #divTotalAnnualPotential").hide();
                    $("#tab-opportunityDetail #divCurrentFYRevenue").hide();
                    $("#tab-opportunityDetail #divQuoteDate").hide();
                    
                    //hide agreement
                    $("#tab-opportunityDetail #divNoChargeEquipmentValue").hide();
                    $("#tab-opportunityDetail #divDisposablePurchaseValue").hide();
                    $("#tab-opportunityDetail #divContractYears").hide();
                    $("#tab-opportunityDetail #divTotalAnnualPotential").hide();
                    $("#tab-opportunityDetail #divCurrentFYRevenue").hide();
                     
                    $("#tab-opportunityDetail #divOpportunityLineItems").show();
                    $("#tab-opportunityDetail #divDetailOppLineItems").show(); 
                        
                    if(opportunityType == "Product Conversion"){
                    
                        $("#tab-opportunityDetail #divAnnualNumberofProcedures").show();
                        $("#tab-opportunityDetail #divPotentialRevenuePerCase").show();
                        $("#tab-opportunityDetail #divTotalAnnualPotential").show();
                        $("#tab-opportunityDetail #divCurrentFYRevenue").show();
                        $("#tab-opportunityDetail div#divCompetitiveConversion").show();
                        $("#tab-opportunityDetail div#divCompetitiveCompany").show();
                         
                        
                    }else if(opportunityType == "SOS"){
                    
                        //$("#tab-opportunityDetail #divPatientVolume").show();
                        //$("#tab-opportunityDetail #divPotentialUserNumber").show();
                        //$("#tab-opportunityDetail #divTotalAnnualPotential").show();
                        //$("#tab-opportunityDetail #divCurrentFYRevenue").show();
                        //$("#tab-opportunityDetail div#divQuoteId").show();
                        //$("#tab-opportunityDetail div#divQuoteDate").show();
                        
                         $("#tab-opportunityDetail #divOpportunityLineItems").hide();
                         $("#tab-opportunityDetail #divDetailOppLineItems").hide();
                         $("#tab-opportunityDetail #divEnrollmentFormType").show();
                         $("#tab-opportunityDetail #divEnrollmentFormsSent").show();
                         
                          
                        $("#tab-opportunityDetail div#divCompetitiveConversion").hide();
                        $("#tab-opportunityDetail div#divCompetitiveCompany").hide();
                    
                    }else if(opportunityType == "Synergy Video"){
                    
                        $("#tab-opportunityDetail #divTotalNumOfTowers").show();
                        $("#tab-opportunityDetail #divPotentialRevenuePerTower").show();
                        $("#tab-opportunityDetail #divTotalAnnualPotential").show();
                        $("#tab-opportunityDetail #divCurrentFYRevenue").show();
                        $("#tab-opportunityDetail div#divCompetitiveConversion").show();
                        $("#tab-opportunityDetail div#divCompetitiveCompany").show();
                        $("#tab-opportunityDetail div#divQuoteId").show();
                        $("#tab-opportunityDetail div#divQuoteDate").show();
                         
                    
                    }else if(opportunityType == "Synergy Installation"){
                    
                        $("#tab-opportunityDetail #divTotalNumOfORs").show();
                        $("#tab-opportunityDetail #divEquipmentCost").show();
                        $("#tab-opportunityDetail #divLaborAndMaterials").show();
                        $("#tab-opportunityDetail #divTotalBudgetary").show();
                        $("#tab-opportunityDetail #divFinalPOAmount").show();
                        $("#tab-opportunityDetail #divEstimatedInstallDate").show();
                        $("#tab-opportunityDetail div#divCompetitiveConversion").show();
                        $("#tab-opportunityDetail div#divQuoteId").show();
                        $("#tab-opportunityDetail div#divQuoteDate").show();
                         
                    
                    }else if(opportunityType == "Agreements"){
                        
                        $("#tab-opportunityDetail #divNoChargeEquipmentValue").show();
                        $("#tab-opportunityDetail #divDisposablePurchaseValue").show();
                        $("#tab-opportunityDetail #divContractYears").show();
                        $("#tab-opportunityDetail #divTotalAnnualPotential").show();
                        $("#tab-opportunityDetail #divCurrentFYRevenue").show();
                        $("#tab-opportunityDetail #divQuoteId").show();
                        $("#tab-opportunityDetail div#divQuoteDate").show();
                        $("#tab-opportunityDetail div#divCompetitiveConversion").show();
                        $("#tab-opportunityDetail div#divCompetitiveCompany").show();
                         
                        
                    }else if(opportunityType == "Instrument Purchase"){
                         
                        $("#tab-opportunityDetail #divTotalAnnualPotential").show();
                        $("#tab-opportunityDetail #divCurrentFYRevenue").show();
                        $("#tab-opportunityDetail #divQuoteNum").show();
                        $("#tab-opportunityDetail #divQuoteId").show();
                        $("#tab-opportunityDetail div#divCompetitiveConversion").show();
                        $("#tab-opportunityDetail div#divCompetitiveCompany").show();
                        $("#tab-opportunityDetail div#divQuoteDate").show(); 
                        
                    }else if(opportunityType == "Stocking Order"){
                        
                        $("#tab-opportunityDetail #divTotalAnnualPotential").show();
                        $("#tab-opportunityDetail #divCurrentFYRevenue").show();
                        $("#tab-opportunityDetail #divQuoteId").show();
                        $("#tab-opportunityDetail #divQuoteNum").show();
                        $("#tab-opportunityDetail #divQuoteDate").show();
                        $("#tab-opportunityDetail div#divCompetitiveConversion").show();
                        $("#tab-opportunityDetail div#divCompetitiveCompany").show();
                         
                    } 
                
                }// end of showOpportunityDetailFields 
                
                function checkAll(ele, name){
                    if(ele.checked){
                        $('#table-dependents input[name="'+name+'"]').attr('checked', true);
                    } else {
                        $('#table-dependents input[name="'+name+'"]').removeAttr('checked');
                    }
                }   //  end of checkAll
                
                function performFilter(e){
                    /* Ignore tab key */
                        var code = e.keyCode || e.which;
                        if (code == '9') return;
                        /* Useful DOM data and selectors */
                        //var $input = $(this),
                        var $input = $("#"+e.currentTarget.id),
                        inputContent = $input.val().toLowerCase(),
                        $panel = $input.parents('.filterable'),
                        column = $panel.find('.filters th').index($input.parents('th')),
                        $table = $panel.find('.table'),
                        $rows = $table.find('tbody tr');
                        /* Dirtiest filter function ever ;) */
                        var $filteredRows = $rows.filter(function(){
                            var value = $(this).find('td').eq(column).text().toLowerCase();
                            return value.indexOf(inputContent) === -1;
                        });
                        /* Clean previous no-result if exist */
                        $table.find('tbody .no-result').remove();
                        /* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
                        $rows.show();
                        $filteredRows.hide();
                        /* Prepend no-result row if all rows are filtered */
                        if ($filteredRows.length === $rows.length) {
                            $table.find('tbody').prepend($('<tr class="no-result text-center"><td colspan="'+ $table.find('.filters th').length +'">No result found</td></tr>'));
                        }
                }   //  end of performFilter
                
                /*function setupCreateOppModal(){
                    populateOppOwner();
                    populateSurgeonTypeahead();
                    populateAccounts();
                    assignSalesRepsTypeahead();
                    assignProcedureTypeahead();
                    assignProductsTypeahead();
                    assignOppPartsTypeahead();
                    assignOppPartDescriptionTypeahead();
                    
                }  */ //  end of setupCreateOppModal 
                 
                
                function switchOpportunityView(eleType){
                    
                    if(eleType == "ListView"){
                        
                        window.location = "/AROpportunityLV";
                        
                    } else if(eleType == "Dashboard"){
                       
                       window.location = "/AROpportunityDB";
                        
                    } else if(eleType == 'DetailView'){
                    
                        $("#oppListing").hide();
                        $("#listingFilter").hide();
                        $("#listingHeader").hide();
                        $("#detailHeader").show();
                        $("#dashboardFilter").hide();
                        $("#divOppListingFilters").hide();
                        $("#oppDashboard").hide();
                        
                        $("#oppListBtn").show();
                        $("#oppDashboardBtn").show();
                        $("#oppDetailsView").show();
                    }
                }   //  end of switchOpportunityView  
                 
                function showOppDetailsView(){
                    $("#oppDashboard").hide();
                    $("#dashboardFilter").hide();
                    $("#detailHeader").show();
                    //$("div.reports").slick('unslick');
                    
                    $("#oppListing").hide();
                    $("#listingFilter").hide();
                    
                    $("#oppDetailsView").show();
                    $('#opportunityDetail').tab('show')
                    $("div#oppDetailsView .oppFieldInput").hide();
                    
                        //  Also set the toggle for summary divs
                    $("#divOppSummaries i[id$='toggle']").on('click', function(event){
                        targetDiv = $(this).attr('data-target');
                        $("#"+targetDiv).collapse('toggle');
                        
                        if($(this).hasClass('fa-chevron-up')){
                            $(this).removeClass('fa-chevron-up');
                            $(this).addClass('fa-chevron-down');
                        } else {
                            $(this).removeClass('fa-chevron-down');
                            $(this).addClass('fa-chevron-up');
                        }
                    });
                        
                }   //  end of showOppDetailsView
                
                function populateOpportunityDetailsView(newOpp){
                    
                    console.log('##--populating opp: '+JSON.stringify(newOpp));
                    console.log('##--populating accountTerritoryId: '+newOpp.accountTerritoryId);
                    $("#divSurgeonSummary").empty();
                    $("#divKeyContactsSummary").empty();
                    $("#divOppTeamSummary").empty();
                    $("#divLinkedOppsSummary").empty();
                    
                    
                    $("#oppDetailsView input#opportunityId").val(newOpp.opportunityId);
                    $("#oppDetailsView input#oppOwnerId").val(newOpp.ownerId);
                    $("#oppDetailsView div.oppTypeName").html(globalDecodeEntities(newOpp.opportunityType));
                    $("#oppDetailsView div.accountName").html(globalDecodeEntities(newOpp.account));
                    $("#oppDetailsView #hiddenAccountId").val(newOpp.accountId);
                    populateAccountTeam(newOpp.accountId, 'Opportunity');
                    $("#oppDetailsView div.closeDate").html( dateFormatterNoTime(newOpp.closeDate) );
                    if(globalDecodeEntities(newOpp.opportunityType) == 'SOS'){
                    $("#oppDetailsView div.currentFYRevenue").html("N/A");
                    } else{
                    $("#oppDetailsView div.currentFYRevenue").html(newOpp.currentFYRevenue || "-");
                    }
                    $("#oppDetailsView div.oppOwner").html(newOpp.opportunityOwner);
                    $("#oppDetailsView div.opportunityName").html(globalDecodeEntities(newOpp.opportunityName));
                    $("#oppDetailsView input.txtopportunityName").html(globalDecodeEntities(newOpp.opportunityName));
                    $("#oppDetailsView div.stage").html(globalDecodeEntities(newOpp.currentStage));
                    $("#oppDetailsView input.txtstage").val(globalDecodeEntities(newOpp.currentStage));
                    $("#oppDetailsView div.productCategory").html(globalDecodeEntities(newOpp.productCategory) || "-");
                    $("#oppDetailsView div.probabilityToClose").html((newOpp.probability || "0") + "%");
                    $("#oppDetailsView div.procedure").html(globalDecodeEntities(newOpp.procedure || ""));
                    $("#oppDetailsView div.annualNumberOfProcedures").html(newOpp.annualNumberOfProcedures|| "");
                    $("#oppDetailsView div.potentialRevenuePerCase").html(newOpp.potentialFYRevenue || "");
                    $("#oppDetailsView div.totalAnnualPotential").html(newOpp.totalAnnualRevenue || "-");
                    $("#oppDetailsView div.competitiveConversion").html(newOpp.competitiveConversion || "-");
                    $("#oppDetailsView div.competitiveCompany").html(newOpp.competitiveCompany || "-");
                    $("#oppDetailsView div.procedure").html(newOpp.procedure || "-");
                    $("#oppDetailsView div.quoteId").html(newOpp.quoteId || "-");
                    $("#oppDetailsView div.closeLostReason").html(newOpp.closeLostReasons || "-");
                    $("#oppDetailsView div.patientVolume").html(newOpp.patientVolume || "-");
                    $("#oppDetailsView div.potentialUserNumber").html(newOpp.potentialUserNumber || "-");
                    $("#oppDetailsView div.totalNumOfTowers").html(newOpp.totalNumOfTowers || "-");
                    $("#oppDetailsView div.potentialRevenuePerTower").html(newOpp.potentialRevenuePerTower || "-");
                    $("#oppDetailsView div.totalNumOfORs").html(newOpp.totalNumOfORs || "-");
                    $("#oppDetailsView div.equipmentCost").html(newOpp.equipmentCost || "-");
                    $("#oppDetailsView div.laborAndMaterials").html(newOpp.laborAndMaterials || "-");
                    $("#oppDetailsView div.totalBudgetary").html(newOpp.totalBudgetary || "-");
                    $("#oppDetailsView div.finalPOAmount").html(newOpp.finalPOAmount || "-");
                    $("#oppDetailsView div.estimatedInstallDate").html(newOpp.estimatedInstallDate || "-");
                    $("#oppDetailsView div.noChargeEquipmentValue").html(newOpp.noChargeEquipmentValue || "-");
                    $("#oppDetailsView div.disposablePurchaseValue").html(newOpp.disposablePurchaseValue || "-");
                    $("#oppDetailsView div.contractYears").html(newOpp.contractYears || "-");
                    $("#oppDetailsView div.quoteNum").html(newOpp.quoteNum || "-");
                    
                    //$("#oppDetailsView div.enrollmentFormsSent").html(dateFormatterNoTime(newOpp.enrollmentFormsSent) || "-");
                    $("#oppDetailsView div.enrollmentFormsSent").html(dateFormatterNoTime(newOpp.enrollmentFormsSent));
                    $("#oppDetailsView div.enrollmentFormType").html(newOpp.enrollmentFormType || "-");
                    
                    if(newOpp.quoteDate != undefined )
                    {
                        console.log('inside if');
                        $("#oppDetailsView div.quoteDate").html(  dateFormatterNoTime(newOpp.quoteDate) );
                    }
                    else
                    {
                        console.log('inside else');
                        $("#oppDetailsView div.quoteDate").html("-");
                    }
                    console.log('Quote Date by Mim-----&'+newOpp.quoteDate+'-------');
                    if(newOpp.opportunitySurgeons && newOpp.opportunitySurgeons.length >0){
                        var htm="";
                        
                        $.each(newOpp.opportunitySurgeons, function(i, v){
                            //console.log('Opp Surgeon: ' + JSON.stringify(v))
                            if(v.Surgeon__r != undefined){
                                var surgeonPractice = v.Surgeon__r.Designation__pc || "";
                                //console.log('##--surgeon Name: '+v.Surgeon__r.Name);
                                //htm += "<dl><dt>"+v.Surgeon__r.Name+"</dt>";
                                //htm += "<dd>"+surgeonPractice +"</dd></dl>";
                                htm += "<div id='"+v.Id+"' data-surgeon-id='"+v.Surgeon__c+"'><dl><dt>"+v.Surgeon__r.Name+"</dt><dd>"+surgeonPractice+"<div class='pull-right'><a href='#' onclick='deleteSublistItem(\"OpportunitySurgeon\", \""+v.Id+"\")'>Delete</a></div></dd></dl></div>";
                            }
                            
                        });
                        $("#divSurgeonSummary").html(htm);
                    
                    }
                    
                    if(newOpp.opportunityContactRoles && newOpp.opportunityContactRoles.length >0){
                        var htm="";
                        
                        $.each(newOpp.opportunityContactRoles, function(i, v){
                            
                            //htm += "<div id='"+v.Id+"' data-key-contact-id='"+v.ContactId+"'><dl><dt>"+v.Contact.Name+"</dt><dd>"+v.Role+"<div class='pull-right'><a href='#' onclick='deleteSublistItem(\"ContactRole\", \""+v.Id+"\")'>Delete</a></div></dd></dl></div>";
                            htm += "<div id='"+v.Id+"' data-key-contact-id='"+v.ContactId+"'><dl><dt>"+v.Contact.Name+"</dt><dd>"+v.Role;
                            console.log('##--IsPrimary: '+ v.IsPrimary);
                            if(v.IsPrimary ==1){
                                htm += '<span class="text-danger">*</span>';
                            } 
                            htm += "<div class='pull-right'><a href='#' onclick='deleteSublistItem(\"ContactRole\", \""+v.Id+"\")'>Delete</a></div></dd></dl></div>";
                            
                        });
                        $("#divKeyContactsSummary").html(htm);
                    
                    }
                    
                    /*
                    Adding owner as opp team.
                    */
                    
                    
                    var divOppTeamSummaryhtm = '';
                    divOppTeamSummaryhtm = "<div id='"+newOpp.Id+"' data-opp-team-id='"+ newOpp.OwnerId+"'><dl><dt>"+newOpp.opportunityOwner+"</dt><dd>Owner</dd></dl></div>";
                    
                    if(newOpp.opportunityTeamMembers && newOpp.opportunityTeamMembers.length>0){
                        //var htm="";
                        
                        $.each(newOpp.opportunityTeamMembers, function(i, v){
                        
                            var userTeamRole = v.TeamMemberRole || "";
                            //console.log('##--userTitle: '+ userTeamRole);
                            //console.log('##--userName: '+ v.User.Name);
                            divOppTeamSummaryhtm += "<div id='"+v.Id+"' data-opp-team-id='"+v.UserId+"'><dl><dt>"+v.User.Name+"</dt><dd>"+userTeamRole+"<div class='pull-right'><a href='#' onclick='deleteSublistItem(\"TeamMemberRole\", \""+v.Id+"\")'>Delete</a></div></dd></dl></div>";
                            
                            /*htm += "<dl><dt>"+v.User.Name+"</dt>";
                            htm += "<dd>"+ userTitle +"</dd></dl>";*/
                        });
                    }
                    $("#divOppTeamSummary").html(divOppTeamSummaryhtm);
                    
                    if(newOpp.lstLinkedOpportunities && newOpp.lstLinkedOpportunities.length>0){
                        $("#divLinkedOppsSummary p.remove-when-present").hide();
                        $("#divLinkedOppsSummary").empty();
                        $.each(newOpp.lstLinkedOpportunities, function(i, v){
                            $("#divLinkedOppsSummary").append("<div id='"+v.Id+"' data-linked-opp-id='"+v.Linked_Opportunity__c+"'><dl><dt>"+v.Linked_Opportunity__r.Name+"</dt><dd>"+v.Linked_Opportunity__r.Type+"<div class='pull-right'><a href='#' onclick='deleteSublistItem(\"LinkedOpportunity\", \""+v.Id+"\")'>Delete</a></div></dd></dl></div>");
                        });
                    }
                    
                        //  Set the Stage of the Opportunity
                    populateOpportunityStageBreadCrumbs(newOpp);
                    
                        //  Set the Products
                    $("#oppDetailsView .product-parts tbody").empty();
                    
                    var totalAmount=0;
                    $.each(newOpp.products, function(i,v){
                    //Id, Product2.Material_Number__c, Product2.Description, Quantity, TotalPrice, UnitPrice, Product2Id, Product2.Name
                        $("#oppDetailsView .product-parts tbody").append('<tr data-part-id="'+v.PricebookEntryId+'"><td><p class="form-control-static">'+v.Product2.Material_Number__c+'</p></td><td><p class="form-control-static">'+v.Product2.Description+'</p></td><td><p class="form-control-static part-quantity">'+v.Quantity+'</p></td><td><p class="form-control-static">$'+ v.UnitPrice.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,') +'</p></td><td><p class="form-control-static">$'+ v.TotalPrice.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,') +'</p></td>');
                        totalAmount += v.TotalPrice;
                        
                    }); //  end of for-each product
                    $("#oppDetailsView .product-parts tfoot td#totalProductAmount").attr("data-total", totalAmount);
                    $("#oppDetailsView .product-parts tfoot td#totalProductAmount").html("$" + totalAmount.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                    
                }   //  end of populateOpportunityDetailsView
                
                function populateOpportunityStageBreadCrumbs(newOpp){
                    
                    Visualforce.remoting.Manager.invokeAction("CS_AROpportunityCC.retrieveOpportunityStages",
                                                                newOpp.opportunityType,
                        function(result, event) {
                            $("ul.cf").empty();
                            var crumbWidth='16.5%';
                            var lastCrumbWidth='17.5%';
                            if(result.length == 8){
                                crumbWidth='14.2%'; //100/7 ignoring Closed - Lost
                                lastCrumbWidth='14.8%';
                            }
                            //console.log('Result: ' + JSON.stringify(result) + '\n\nEvent: ' + JSON.stringify(event));
                            $.each(result, function (i, v){
                                
                                if((newOpp.currentStage == v) && (newOpp.currentStage == OPP_STAGE_CLOSED_WON)){
                                    $("ul.cf").append("<li style='width: "+lastCrumbWidth+"' data-stage='"+v+"'><a href='#' class='current won'><span>"+v+"</span></a></li>");
                                } else if((newOpp.currentStage == v) && (newOpp.currentStage == OPP_STAGE_CLOSED_LOST)){
                                    $("ul.cf").append("<li style='width: "+lastCrumbWidth+"' data-stage='"+v+"'><a href='#' class='lost'><span>"+v+"</span></a></li>");
                                } else if(newOpp.currentStage == v){
                                    $("ul.cf").append("<li style='width: "+crumbWidth+"' data-stage='"+v+"'><a href='#' class='current'><span><i class='fa'></i></span><span>"+v+"</span></a></li>");
                                } else if((v == OPP_STAGE_CLOSED_WON) && (newOpp.currentStage == OPP_STAGE_CLOSED_LOST)){
                                    // DOnt display anything
                                } else if((v != OPP_STAGE_CLOSED_LOST)){
                                    $("ul.cf").append("<li style='width: "+crumbWidth+"' data-stage='"+v+"'><a href='#'><span>"+v+"</span></a></li>");
                                }
                                
                            });
                            
                            ////console.log("Inside the handler: " + newOpp.currentStage);
                            $("ul.cf li a.current").parent().prevAll().each(function(i){
                                                                                $(this).children().first().addClass('active').prepend('<span><i class="fa fa-check"></i></span>');
                                                                            });
                            
                            $('div.breadcrumbs').show();
                            
                    }); //  end of remote call to get stage values
                
                
                }// end of populateOpportunityStageBreadCrumbs
                
                function editOpportunity(){ 
                    populateOpportunityEditView(OBJOPPORTUNITY, false);
                    // show the modal
                     
                }   //  end of editCase 
                
                function populateOpportunityEditView(objOpp, clone){ 
                     
                     $("#opportunity-modal input.clear-on-close").val('');
                     $("#opportunity-modal select.clear-on-close").val('');
                     $("#opportunity-modal div.clear-on-close").empty();
                     $('#opportunity-modal #newOppContactErrors').html('');
                     $('#opportunity-modal input[type="checkbox"]').attr('checked', false);
                     $("#opportunity-modal input.quoteDate").val("");
                     $("#opportunity-modal input#quoteId").val("");
                     populateAccountAndSurgeonTypeaheadOnEdit(objOpp.accountId, 'Opportunity');
                     if(clone){
                        $("#opportunity-modal span.modal-title-txt").text('Clone of '+ globalDecodeEntities(objOpp.opportunityName));
                        $("#opportunity-modal input#opportunityId").val('');
                     }else{
                        $("#opportunity-modal span.modal-title-txt").text("Edit Opportunity"); 
                        $("#opportunity-modal input#opportunityId").val(objOpp.opportunityId); 
                        //hide opportunity-team drop down and show accountteam  
                        $("#opportunity-modal div#divOpportunityTeam").hide(); 
                        $("#opportunity-modal div#divAccountTeam").show();
                     }
                    
                    showOpportunityFields(objOpp.opportunityType);   
                    var closeDate = moment(objOpp.closeDate).format('MM/DD/YYYY');
                    console.log('##--populateOpportunityEditView.closeDate:'+objOpp.closeDate + '; '+ moment(objOpp.closeDate).format('MM/DD/YYYY'));
                    var estimatedInstallDate = objOpp.estimatedInstallDate == null || undefined ? '':moment(objOpp.estimatedInstallDate).format('MM/DD/YYYY');
                    var quoteDate = objOpp.quoteDate== null || undefined? '':moment(objOpp.quoteDate).format('MM/DD/YYYY');
                    var enrollmentFormsSentDate = objOpp.enrollmentFormsSent == null || undefined? '': moment(objOpp.enrollmentFormsSent).format('MM/DD/YYYY');  
                    
                    populateOppotunityType(globalDecodeEntities(objOpp.opportunityType));
                    $("#opportunity-modal input.account").val(globalDecodeEntities(objOpp.account)); 
                    $("#opportunity-modal input.account").attr("data-record-id", objOpp.accountId);
                    populateAccountTeam(objOpp.accountId, 'Opportunity');// This will set the team on the edit modal
                    $("#opportunity-modal input#close-date").val(closeDate);
                    $("#opportunity-modal input.current-fy-revenue").val(objOpp.currentFYRevenue || "");
                    $("#opportunity-modal select.opportunity-owner").val(objOpp.ownerId);
                    $("#opportunity-modal input.opportunity-name").val(globalDecodeEntities(objOpp.opportunityName));
                    populateOpportunityStageNames(globalDecodeEntities(objOpp.opportunityType), objOpp.currentStage);
                    //populateAccountTeam(objOpp.accountId); 
                    removeOpportunityProductCategories(objOpp.opportunityType, objOpp.productCategory);
                    $("#opportunity-modal input.probabilityToClose").val((objOpp.probability || "") + "%");
                    $("#opportunity-modal input.procedure").val(globalDecodeEntities(objOpp.procedure || ""));
                    $("#opportunity-modal input#procedureId").val(globalDecodeEntities(objOpp.procedureId || ""));
                    $("#opportunity-modal input.annualNumberOfProcedures").val(objOpp.annualNumberOfProcedures|| "");
                    $("#opportunity-modal input.potentialRevenuePerCase").val(objOpp.potentialFYRevenue || "");
                    $("#opportunity-modal input.totalAnnualPotential").val(objOpp.totalAnnualRevenue || "");
                    $("#opportunity-modal select.competitive-conversion").val(objOpp.competitiveConversion || "");
                    $("#opportunity-modal select.competitive-company").val(objOpp.competitiveCompany || "");
                    $("#opportunity-modal input.procedure").val(objOpp.procedure || "");
                    $("#opportunity-modal input.quoteId").val(objOpp.quoteId || "");
                    //$("#opportunity-modal input.closed-reason").val(objOpp.closeLostReasons || "");
                    removeCloseLostReasonsOnEditModal(objOpp.opportunityType, objOpp.closeLostReasons);
                    $("#opportunity-modal input.patientVolume").val(objOpp.patientVolume || "");
                    $("#opportunity-modal input.potentialUserNumber").val(objOpp.potentialUserNumber || "");
                    $("#opportunity-modal input.totalNumOfTowers").val(objOpp.totalNumOfTowers || "");
                    $("#opportunity-modal input.potentialRevenuePerTower").val(objOpp.potentialRevenuePerTower || "");
                    $("#opportunity-modal input.totalNumOfORs").val(objOpp.totalNumOfORs || "");
                    $("#opportunity-modal input.equipmentCost").val(objOpp.equipmentCost || "");
                    $("#opportunity-modal input.laborAndMaterials").val(objOpp.laborAndMaterials || "");
                    $("#opportunity-modal input.totalBudgetary").val(objOpp.totalBudgetary || "");
                    $("#opportunity-modal input.finalPOAmount").val(objOpp.finalPOAmount || "");
                    $("#opportunity-modal input.estimatedInstallDate").val(estimatedInstallDate);
                    $("#opportunity-modal input.noChargeEquipmentValue").val(objOpp.noChargeEquipmentValue || "");
                    $("#opportunity-modal input.disposablePurchaseValue").val(objOpp.disposablePurchaseValue || "");
                    $("#opportunity-modal input.contractYears").val(objOpp.contractYears || "");
                    $("#opportunity-modal input.quoteNum").val(objOpp.quoteNum || "");
                    populateEnrollmentFormType(globalDecodeEntities(objOpp.enrollmentFormType || ""));
         
                    $("#opportunity-modal input.quoteDate").val(quoteDate);
                    console.log('##--populateOpportunityEditView.enrollmentFormsSentDate val: '+ objOpp.enrollmentFormsSent);
                    console.log('##--populateOpportunityEditView.enrollmentFormsSentDate: '+ enrollmentFormsSentDate);
                    $("#opportunity-modal input.enrollmentFormsSent").val(enrollmentFormsSentDate);
                    
                    
                    $("#opportunity-modal div.ctag-list.surgeon").empty();
                    var lstSurgeons = objOpp.opportunitySurgeons;
                    for ( var i=0; i < lstSurgeons.length; i++ ) {
                    
                        $("#opportunity-modal div.ctag-list.surgeon").append(obj2ctag({
                          Name: globalDecodeEntities(lstSurgeons[i].Surgeon__r.Name),
                          Id: lstSurgeons[i].Surgeon__c
                        }));
    
                    }
                    
                    $("#opportunity-modal div.ctag-list.sales-reps").empty();
                    var lstTeamMembers = objOpp.opportunityTeamMembers;
                    for ( var i=0; i < lstTeamMembers.length; i++ ) {
                    
                        $("#opportunity-modal div.ctag-list.sales-reps").append(obj2ctag({
                          Name: globalDecodeEntities(lstTeamMembers[i].User.Name),
                          Id: lstTeamMembers[i].UserId
                        }));
    
                    }
                    
                    if(objOpp.opportunitySurgeons && objOpp.opportunitySurgeons.length >0){
                        var htm="";
                        
                        $.each(objOpp.opportunitySurgeons, function(i, v){
                            if(v.Surgeon__r != undefined){
                                var surgeonPractice = v.Surgeon__r.Designation__pc || "";
                                //htm += "<dl><dt>"+v.Surgeon__r.Name+"</dt>";
                                //htm += "<dd>"+surgeonPractice +"</dd></dl>";
                                htm += "<div id='"+v.Id+"' data-surgeon-id='"+v.Surgeon__c+"'><dl><dt>"+v.Surgeon__r.Name+"</dt><dd>"+surgeonPractice+"<div class='pull-right'><a href='#' onclick='deleteSublistItem(\"OpportunitySurgeon\", \""+v.Id+"\")'>Delete</a></div></dd></dl></div>";
                            }
                        });
                        $("#divSurgeonSummary").html(htm);
                    
                    }
                    
                    $("#opportunity-modal .product-parts tbody").empty();
                    var totalAmount=0;
                    $.each(objOpp.products, function(i,v){
                        $("#opportunity-modal .product-parts tbody").append('<tr data-part-id="'+v.PricebookEntryId+'"><td><p class="form-control-static">'+v.Product2.Material_Number__c+'</p></td><td><p class="form-control-static">'+v.Product2.Description+'</p></td><td><p class="form-control-static part-quantity">'+v.Quantity+'</p></td><td><p class="form-control-static">$'+ v.UnitPrice.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,') +'</p></td><td id="total" data-total="'+v.TotalPrice+'"><p class="form-control-static">$'+ v.TotalPrice.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,') +'</p></td><td><button class="btn btn-xs btn-primary" onclick="$(this).parent().parent().remove()">delete</button></td>');
                        totalAmount += v.TotalPrice;
                    }); //  end of for-each product
                    
                    $("#opportunity-modal .product-parts tfoot td#totalProductAmount").attr("data-total", totalAmount);
                    $("#opportunity-modal .product-parts tfoot td#totalProductAmount").html("$" + totalAmount.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                    setCompetitiveComapny(objOpp.competitiveConversion);
                    
                    //make opportunity type as readonly
                    $('#opportunity-modal select.opportunity-type').attr('readonly', 'readonly');
                    $('#opportunity-modal select.opportunity-type').attr("disabled", true);
                    $("#opportunity-modal").modal('show');
                    
                }   //  end of populateOpportunityEditView
                
                function retrieveDefaultProductCategory(opportunityType){
                    
                    if(opportunityType == 'SOS'){
                        
                        return 'Other';
                    }else if(opportunityType == 'Synergy Video' ||
                                opportunityType == 'Synergy Installation'){
                        
                        return 'Synergy';
                        
                    }else {
                        return null;
                    }
                
                }// end of retrieveDefaultProductCategory
                
                function deleteOpportunity(){
                    oppId = $("#oppDetailsView input#opportunityId").val();
                    if(confirm('Do you want to delete this opportunity')){
                        //  Call Delete method and switch the view
                        Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.deleteOpportunity}",
                            oppId,
                            function(opportuityWrapper, event) {
                                //console.log('Successfully deleted OppId: ' + oppId);
                                switchOpportunityView("ListView");
                            
                        }); //  end of remote delete call
                    }
                }   //  end of deleteOpportunity
                
                /*function cloneOpportunity(){
                    $("#opportunity-edit-modal input#opportunityId").val('');
                    $("#opportunity-edit-modal").modal('show');
                    $("#opportunity-edit-modal #opportunity-edit-modal-title").text('Clone of '+ $("#opportunity-edit-modal input#opportunityName").val());
                } */  //  end of cloneOpportunity
                
                function cloneOpportunity(){
                    populateOpportunityEditView(OBJOPPORTUNITY, true);
                    //$("#opportunity-modal input#opportunityId").val('');
                    //$("#opportunity-modal").modal('show');
                    //$("#opportunity-modal #opportunity-modal-title").text('Clone of '+ $("#opportunity-modal input#opportunityName").val());
                }  //  end of cloneOpportunity
                
                function deleteSublistItem(listType, deleteId){
                    
                    $("#confirm-delete").modal('show');
                    $("#confirm-delete #deleteId").val(deleteId);
                    $(this).find('.btn-ok').attr('id', deleteId);
                    
                    if(listType == 'ContactRole'){
                        $("#confirm-delete div.modal-header").html('Deleting Opportunity Contact');
                        $("#confirm-delete p.confirm-modal-body").html('Please confirm if you want to delete the Opportunity Contact.');
                        $("#confirm-delete #deleteMethod").val('ContactRole');
                    } else if (listType == 'TeamMemberRole'){
                        $("#confirm-delete div.modal-header").html('Deleting Opportunity Team Member');
                        $("#confirm-delete p.confirm-modal-body").html('Please confirm if you want to delete the Opportunity Team Member.');
                        $("#confirm-delete #deleteMethod").val('TeamMemberRole');
                    }else if (listType == 'OpportunitySurgeon'){
                        
                        console.log('##--lenght of child divs: '+ $("#divSurgeonSummary > div").length);
                        
                        $("#confirm-delete div.modal-header").html('Deleting Opportunity Surgeon');
                        $("#confirm-delete #deleteMethod").val('OpportunitySurgeon');
                        if($("#divSurgeonSummary > div").length == 1){
                            $("#confirm-delete p.confirm-modal-body").html('You cannot delete the opportunity surgeon. Atleast one surgeon is required on opportunity');
                            $('#confirm-delete button.btn-ok').hide();
                        }else{
                            $("#confirm-delete p.confirm-modal-body").html('Please confirm if you want to delete the Opportunity Surgeon.');
                        }
                    }else{
                        $("#confirm-delete div.modal-header").html('Deleting Linked Opportunity');
                        $("#confirm-delete p.confirm-modal-body").html('Please confirm if you want to delete the Linked Opportunity.');
                        $("#confirm-delete #deleteMethod").val('LinkedOpportunity');
                    }
                    
                }   //  end of deleteSublistItem 
                 
                function isOppInCurrentFY(givenDate){
                    
                    givenDate = moment(givenDate, 'YYYY-MM-DD');
                    var d = new Date();
                    var month = d.getMonth();
                    
                    begininglimitDate = new Date(d.getFullYear(), 6, 1);
                    
                    endinglimitDate = new Date(begininglimitDate.getFullYear(), begininglimitDate.getMonth() + 12, 0);
                    
                    if(givenDate.isBetween(begininglimitDate, endinglimitDate, null, '[]')){
                        return true;
                    }
                    
                    return false;

                } 
                
                function openOppModalForEdit(opp){
                    $('#opportunity-modal').modal('show');
                }   //  end of openOppModalForEdit 
                
                function addSurgeonOptionToSelect(filterDiv, filterId, optionValue){
                    
                    if(optionValue == null || optionValue == ''){
                        return;
                    }
                    var splitOptionValue = optionValue.split(",");
                    
                    for (i = 0; i < splitOptionValue.length; i++) {
                        addOptionToSelect('divOppListingFilters', 'filterSurgeon', splitOptionValue[i]);
                    }
                
                }// end of addSurgeonOptionToSelect 
                
                function addProcOptionToSelect(filterDiv, filterId, optionValue){
                    
                    if(optionValue == null || optionValue == ''){
                        return;
                    }
                    var splitOptionValue = optionValue.split(",");
                    
                    for (i = 0; i < splitOptionValue.length; i++) {
                        //optionValue.trim().replace(/,/g , "");
                        addOptionToSelect(filterDiv, filterId, splitOptionValue[i].trim());
                    }
                
                }// end of addProcOptionToSelect
                
                function addOptionToSelect(filterDiv, filterId, optionValue){
                    
                    if(optionValue == null || optionValue == ''){
                        return;
                    }
                    var select= document.getElementById(filterId);
                    if(select == null){
                        return;
                    }
                    for (var i= select.options.length; i-->0;) {
                    
                        if(filterId == 'filterAccount'){
                            console.log('##--existing option' + select.options[i].value);
                            console.log('##--new option' + optionValue);
                        }
                        if (select.options[i].value == globalDecodeEntities(optionValue)) {
                            
                            return;
                        }   
                    }
                    if(filterId == 'filterAccount'){
                        console.log('##--checking if option is being added: ' + optionValue);
                    }
                    $("#"+filterDiv+" select#" + filterId).append( $("<option />").val(globalDecodeEntities(optionValue)).text(globalDecodeEntities(optionValue)) );
                    
                }   //  end of addOptionToSelect 
                                      
                function dateSortFn(a, b) {
                    return new Date(a.closeDate).getTime() - new Date(b.closeDate).getTime();
                }   //  end of dateSortFn
                
                
                function sortJSON(data, prop, asc) {
                    sortedData = data.sort(function(a, b) {
                        if (asc) {
                            return (toNumber(a[prop]) > toNumber(b[prop])) ? 1 : ((toNumber(a[prop]) < toNumber(b[prop])) ? -1 : 0);
                        } else {
                            return (toNumber(b[prop]) > toNumber(a[prop])) ? 1 : ((toNumber(b[prop]) < toNumber(a[prop])) ? -1 : 0);
                        }
                        
                    });
                    return sortedData;
                }   //  end of sortJSON
                
                function toNumber(currency){
                    if(! currency)
                        return 0;
                        
                    return Number(currency.replace(/[^0-9\.]+/g,""));
                    
                }   //  end of toNumber
                
                function clearAllFilters(){
                    
                    $('#divOppListingFilters select[id^="filter"]').selectpicker('deselectAll');
                    $('#divOppListingFilters select#filterCloseDate').selectpicker('val', '');
                    
                    filterOppListingTable();
                    
                }   //  end of clearAllFilters
             
                
                // load in the competitive conversion type list
                function populateCompetitiveConversion(){
                  Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.retrieveCompetitiveConversionValues}",
                    function(result, event) { 
                      for ( var i=0; i < result.length; i++) {
                          var txt = globalDecodeEntities(result[i]);
                          $("#opportunity-modal select.competitive-conversion").append("<option value='"+txt+"'>"+txt+"</option>");
                          $("#opportunity-edit-modal select.competitive-conversion").append("<option value='"+txt+"'>"+txt+"</option>");
                      }
                  });
                  
                }
                
                // load in the competitive conversion type list
                function populateCompetitiveCompanies(){
                  Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.retrieveCompetitiveCompanyValues}",
                    function(result, event) { 
                      //console.log('##--populateCompetitiveCompanies: '+JSON.stringify(result));
                      for ( var i=0; i < result.length; i++) {
                          var txt = globalDecodeEntities(result[i]);
                          $("#opportunity-modal select.competitive-company").append("<option value='"+txt+"'>"+txt+"</option>");
                          $("#opportunity-edit-modal select.competitive-company").append("<option value='"+txt+"'>"+txt+"</option>");
                      }
                  });
                  
                }
                
                // load in the close lost reasons
                function populateCloseLostReasons(opportunityType){
                  var selectList = $("#opportunity-stage-close-modal select.opportunity-closed-lost-reason");
                  selectList.find("option:gt(0)").remove();
                  //console.log('##--opportunityType: '+opportunityType);
                  Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.retrieveOpportunityCloseLostReasons}", 
                    opportunityType, function(result, event) { 
                      for ( var i=0; i < result.length; i++) {
                          var txt = globalDecodeEntities(result[i]);
                          $("#opportunity-stage-close-modal select.opportunity-closed-lost-reason").append("<option value='"+txt+"'>"+txt+"</option>");
                      }
                  });
                  
                }
                
                
                
                
                
                // load in the close lost reasons
                /*function populateCloseLostReasonsOnEditModal(){
                  var selectList = $("#opportunity-edit-modal select.opp-edit-closed-lost-reason");
                  selectList.find("option:gt(0)").remove();
                  Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.retrieveOpportunityCloseLostReasons}",
                    'Product Conversion', function(result, event) { 
                      for ( var i=0; i < result.length; i++) {
                          var txt = globalDecodeEntities(result[i]);
                          $("#opportunity-edit-modal select.opp-edit-closed-lost-reason").append("<option value='"+txt+"'>"+txt+"</option>");
                      }
                  });
                  
                }*/
                
                function showClosedLostReason(opportunityStage){
                    
                    $("#divCloseLostReason").hide();
                    $("#divOppEditClosedLostReason").hide();
                    
                    
                    if(opportunityStage == 'Closed - Lost'){
                    
                        $("#divCloseLostReason").show();
                        $("#divOppEditClosedLostReason").show();
                        
                    }
                
                }
                
                function inArray(value, array){
                    if(! array){
                        return false;
                    }
                    return ($.inArray(value, array) >= 0);
                }   //  end of inArray
                
                function GetURLParameter(sParam){
                    var sPageURL = window.location.search.substring(1);
                    var sURLVariables = sPageURL.split('&');
                    for (var i = 0; i < sURLVariables.length; i++){
                        var sParameterName = sURLVariables[i].split('=');
                        if (sParameterName[0] == sParam){
                            return sParameterName[1];
                        }
                    }
                } // end of GetURLParameter
                
            </script>
            
            <div class="wrapper wrapper-content">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <div class="clearfix">
                                    <div class="pull-left">
                                         
                                        <div id="detailHeader">
                                            <div class="text-pull-left">
<!--                                            <i class="fa fa-list fa-2x"></i> 
 -->                                            <h2>
                                                    <b><span class="font-large">{!$Label.AROpportunity_OppoDetailView}</span></b>
                                                    <i class="oppDetail-busy fa fa-refresh fa-spin" style="display:none"></i>
                                                </h2>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="pull-right">
                                        <button type="button" class="btn btn-primary menu_btn" tabindex="-1" id="oppAddBtn" onclick="createNewOpportunity()" ><i class="fa fa-plus"></i> Opportunity</button>
                                        <button type="button" class="btn btn-primary menu_btn btnViewSwitch"  tabindex="-1" id="oppListBtn" style="margin-right: 5px" onclick="switchOpportunityView('ListView')"><i class="fa fa-list"></i> List View</button>
                                        <button type="button" class="btn btn-primary menu_btn btnViewSwitch"  tabindex="-1" id="oppDashboardBtn" style="margin-right: 5px; display: none;" onclick="switchOpportunityView('Dashboard')"><i class="fa fa-pie-chart"></i> Dashboard</button>
                                    </div>
                                </div>
                            </div>  <!-- End of ibox-title -->
                            
                            <!-- <div class="row">
                                <div class="col-xs-12">
                                    <div class="ibox">
                                        <div class="ibox-content box border_top_2">
                                            <div class="clearfix"> 
                                                <div id="listingFilter" style="display: none"> 
                                                </div>
                                            </div>
                                        </div>
                                    </div> 
                                </div>
                            </div> -->  <!-- End of the row --> 
                            <div id="oppDetailsView" style="background-color: white; display: none;">
                                <div class="row ibox">
                                    <div class="col-xs-12">
                                        <div class="ibox-content box border_top_none light_border_top_bottom ">
                                            <div class="clearfix">
                                                <div class="row">
                                                    <div class="col-xs-11">
                                                        <p class="form-control-static axis-detail-pg-field-label">
                                                            <div class="oppTypeName text-uppercase">{!$Label.AROpportunity_OppTypeName}</div>
                                                        </p>
                                                    </div>
                                                    <div class="col-xs-11">
                                                        <b><div class="opportunityName" style="font-size:20px">{!$Label.AROpportunity_OppoName}</div></b>
                                                        <input type="hidden" id="opportunityId" name="opportunityId"/>
                                                    </div>
                                                    <div class="col-xs-1">
                                                        <div class="dropdown">
                                                            <button class="btn btn-primary opportunity-detail-dropdown" type="button" data-toggle="dropdown">
                                                            <span class="caret"></span></button>
                                                            <ul class="dropdown-menu">
                                                              <li><a href="#" onclick="editOpportunity()">{!$Label.AROpportunity_Edit}</a></li>
                                                              <li><a href="#" data-toggle="modal" data-target="#opportunity-cancel-confirm-modal">{!$Label.AROpportunity_Cancel}</a></li>
                                                              <li><a href="#" onclick="cloneOpportunity()">{!$Label.AROpportunity_Clone}</a></li>
                                                            </ul>
                                                        </div> <!-- end of dropdown -->
                                                    </div>
                                                    
                                                    <div class="col-xs-11 col-sm-3 form-group">
                                                        <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_ACCOUNTNAME}</p>
                                                        <div class="accountName">{!$Label.AROpportunity_AcctName}</div>
                                                    </div>
                                                    <div class="col-xs-11 col-sm-3 form-group">
                                                        <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_PROJCLOSEDATE}</p>
                                                        <div class="closeDate">{!$Label.AROpportunity_ProjectedCloseDate}</div>
                                                    </div>
                                                    <div class="col-xs-11 col-sm-3 form-group">
                                                        <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_CURRENTFYREV}</p>
                                                        <div class="currentFYRevenue">{!$Label.AROpportunity_FYRevenue}</div>
                                                    </div>
                                                    <div class="col-xs-11 col-sm-3 form-group">
                                                        <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_OPPOWNER}</p>
                                                        <div class="oppOwner">{!$Label.AROpportunity_OppoOwner}</div>
                                                        <input type="hidden" id="oppOwnerId" name="oppOwnerId"/>
                                                    </div>
                                                    
                                                </div>
                                            </div>  <!-- end of clear fix -->
                                        </div> <!-- end of border_top_none -->
                                    </div> 
                                </div> <!-- end of row ibox -->
                                
                                    <!-- Status Nav Bar -->
                                <div class="row" style="margin-bottom: 10px">
                                    <div class="col-xs-12">
                                        <div class="border_top_none">
                                            <div class="col-xs-10" style="padding: 5px">
                                                <div class="breadcrumbs" style="display: none">
                                                    <div>
                                                        <ul class="cf">
                                                            <li><a href="#" class="active"><span>1</span><span>{!$Label.AROpportunity_Stage1}</span></a></li>
                                                            <li><a href="#" class="active"><span>2</span><span>{!$Label.AROpportunity_Stage2}</span></a></li>
                                                            <li><a href="#"><span>{!$Label.AROpportunity_Stage3}</span></a></li>
                                                            <li><a href="#"><span>{!$Label.AROpportunity_Stage4}</span></a></li>
                                                            <li><a href="#"><span>{!$Label.AROpportunity_Stage5}</span></a></li>
                                                            <li><a href="#"><span>{!$Label.AROpportunity_Stage6}</span></a></li>
                                                        </ul>
                                                    </div>
                                                </div>  <!-- end of breadcrumbs -->
                                            </div>  <!-- End of col-xs-9 -->
                                            <div class="col-xs-2 breadcrumbs_side">                                                 
                                                <button type="button" class="btn btn-primary" id="mark-stage-as-complete-btn">Mark As Complete</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row ibox row_match_height">
                                    <div class="col-xs-8 grey_border_right">
                                        <div class="ibox-content box border_top_none">
                                            <div class="clearfix">
                                            <div class="tabs-container">
                                                <ul class="nav nav-tabs opportunity">
                                                    <li class="active">                                     
                                                        <a id="opportunityDetail" class="tab-skinny" style="border: none" data-toggle="tab" href="#tab-opportunityDetail" aria-expanded="">{!$Label.AROpportunity_DETAILS}
                                                        </a>
                                                        <i class="opportunityDetail-busy tab-busy fa fa-refresh fa-spin" style="display:none"></i>
                                                    </li>
                                                    <li class="">
                                                        <a id="activities" class="tab-skinny" style="border: none" data-toggle="tab" href="#tab-activities" aria-expanded="false">{!$Label.AROpportunity_ACTIVITY}</a>
                                                        <i class="activities-busy tab-busy fa fa-refresh fa-spin" style="display:none"></i>
                                                    </li>
                                                </ul>
                                                <div class="tab-content nopadding">
                                                    <!-- Opportunity Detail tab -->
                                                    <div id="tab-opportunityDetail" class="tab-pane active">
                                                          <div class="full-height-scroll">
                                                            <div class="clearfix">
                                                                <div class="row"> 
                                                                    <div class="col-sm-6" >
                                                                        <div class="col-sm-12 form-group detail_div nopadding">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_OppoName}</p>
                                                                            <div class="opportunityName oppFieldDisplay" data-target="#txtopportunityName">opportunityName</div>
                                                                            <input type="text" id="txtopportunityName" class="form-control input-sm oppFieldInput" data-target="opportunityName"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_AcctName}</p>
                                                                            <div class="accountName oppFieldDisplay" data-target="txtaccountName">accountName</div>
                                                                            <input type="text" id="txtaccountName" class="form-control input-sm oppFieldInput" data-target="accountName"/>
                                                                            <input type="hidden" id="hiddenAccountId" />
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_ProductCategory}</p>
                                                                            <div class="productCategory oppFieldDisplay" data-target="txtproductCategory"></div>
                                                                            <input type="text" id="txtproductCategory" class="form-control input-sm oppFieldInput" data-target="productCategory"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divProcedure" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_Procedure}</p>
                                                                            <div class="procedure oppFieldDisplay" data-target="txtprocedure">procedure</div>
                                                                            <input type="text" id="txtprocedure" class="form-control input-sm oppFieldInput" data-target="procedure"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divCompetitiveConversion" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_CompetitiveConv}</p>
                                                                            <div class="competitiveConversion oppFieldDisplay" data-target="txtcompetitiveConversion">competitiveConversion</div>
                                                                            <input type="text" id="txtcompetitiveConversion" class="form-control input-sm oppFieldInput" data-target="competitiveConversion"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divCompetitiveCompany" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_CompetitiveCo}</p>
                                                                            <div class="competitiveCompany oppFieldDisplay" data-target="txtcompetitiveCompany">competitiveCompany</div>
                                                                            <input type="text" id="txtcompetitiveCompany" class="form-control input-sm oppFieldInput" data-target="competitiveCompany"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divQuoteId" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_QuoteID}</p>
                                                                            <div class="quoteId oppFieldDisplay" data-target="txtquoteId">quoteId</div>
                                                                            <input type="text" id="txtquoteId" class="form-control input-sm oppFieldInput" data-target="quoteId"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divQuoteDate" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_QuoteDate}</p>
                                                                            <div class="quoteDate oppFieldDisplay" data-target="txtQuoteDate">quoteDate</div>
                                                                            <input type="text" id="txtQuoteDate" class="form-control input-sm oppFieldInput" data-target="quoteDate"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divCloseLostReason" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_CloseLostReason}</p>
                                                                            <div class="closeLostReason oppFieldDisplay" data-target="txtcloseLostReason">closeLostReason</div>
                                                                            <input type="text" id="txtcloseLostReason" class="form-control input-sm oppFieldInput" data-target="closeLostReason"/>
                                                                        </div> 
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divEnrollmentFormType" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$ObjectType.Opportunity.fields.Enrollment_Form_Type__c.Label}</p>
                                                                            <div class="enrollmentFormType oppFieldDisplay" data-target="txtEnrollmentFormType">enrollmentFormType</div>
                                                                            <input type="text" id="txtEnrollmentFormType" class="form-control input-sm oppFieldInput" data-target="enrollmentFormType"/>
                                                                        </div>
                                                                        
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divEnrollmentFormsSent" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$ObjectType.Opportunity.fields.Enrollment_Forms_Sent__c.Label}</p>
                                                                            <div class="enrollmentFormsSent oppFieldDisplay" data-target="txtEnrollmentFormsSent">enrollmentFormsSent</div>
                                                                            <input type="text" id="txtEnrollmentFormsSent" class="form-control input-sm oppFieldInput" data-target="enrollmentFormsSent"/>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <!-- Second column -->
                                                                    <div class="col-sm-6 form-group detail_div" >
                                                                        <div class="col-sm-12 form-group detail_div nopadding">
                                                                            <p class="form-control-static axis-detail-pg-field-label">Team</p>
                                                                            <div class="oppAccountTeam oppFieldDisplay" data-target="txtcloseDate">team</div>
                                                                            <input type="text" id="txtcloseDate" class="form-control input-sm oppFieldInput" data-target="accountTeam"/>
                                                                            <input type="hidden" id="hiddenAccountTeamId" />
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_ProjectedCloseDate}</p>
                                                                            <div class="closeDate oppFieldDisplay" data-target="txtcloseDate">closeDate</div>
                                                                            <input type="text" id="txtcloseDate" class="form-control input-sm oppFieldInput" data-target="closeDate"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_Stage}</p>
                                                                            <div class="stage oppFieldDisplay" data-target="txtstage">stage</div>
                                                                            <input type="text" id="txtstage" class="form-control input-sm oppFieldInput" data-target="stage"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_ProbToClose}</p>
                                                                            <div class="probabilityToClose oppFieldDisplay" data-target="txtprobabilityToClose">probabilityToClose</div>
                                                                            <input type="text" id="txtprobabilityToClose" class="form-control input-sm oppFieldInput" data-target="probabilityToClose"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divAnnualNumberofProcedures" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_AnnualNoOfProcedure}</p>
                                                                            <div class="annualNumberOfProcedures oppFieldDisplay" data-target="txtannualNumberOfProcedures">annualNumberOfProcedures</div>
                                                                            <input type="text" id="txtannualNumberOfProcedures" class="form-control input-sm oppFieldInput" data-target="annualNumberOfProcedures"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divTotalNumOfORs" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_TotalNoOfOR}</p>
                                                                            <div class="totalNumOfORs oppFieldDisplay" data-target="txtTotalNumOfORs">totalNumOfORs</div>
                                                                            <input type="text" id="txtTotalNumOfORs" class="form-control input-sm oppFieldInput" data-target="totalNumOfORs"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divTotalNumOfTowers" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_TotalNoOfTower}</p>
                                                                            <div class="totalNumOfTowers oppFieldDisplay" data-target="txtTotalNumOfTowers">totalNumOfTowers</div>
                                                                            <input type="text" id="txtTotalNumOfTowers" class="form-control input-sm oppFieldInput" data-target="totalNumOfTowers"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divEquipmentCost" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_EquipmentCost}</p>
                                                                            <div class="equipmentCost oppFieldDisplay" data-target="txtEquipmentCost">equipmentCost</div>
                                                                            <input type="text" id="txtEquipmentCost" class="form-control input-sm oppFieldInput" data-target="equipmentCost"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divLaborAndMaterials" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_LaborAndMaterials}</p>
                                                                            <div class="laborAndMaterials oppFieldDisplay" data-target="txtLaborAndMaterials">laborAndMaterials</div>
                                                                            <input type="text" id="txtLaborAndMaterials" class="form-control input-sm oppFieldInput" data-target="laborAndMaterials"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divNoChargeEquipmentValue" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_NoChargeEquipValue}</p>
                                                                            <div class="noChargeEquipmentValue oppFieldDisplay" data-target="txtNoChargeEquipmentValue">noChargeEquipmentValue</div>
                                                                            <input type="text" id="txtNoChargeEquipmentValue" class="form-control input-sm oppFieldInput" data-target="noChargeEquipmentValue"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divPotentialRevenuePerCase" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_PotentialRevPerCase}</p>
                                                                            <div class="potentialRevenuePerCase oppFieldDisplay" data-target="txtpotentialRevenuePerCase">potentialRevenuePerCase</div>
                                                                            <input type="text" id="txtpotentialRevenuePerCase" class="form-control input-sm oppFieldInput" data-target="potentialRevenuePerCase"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divPotentialRevenuePerTower" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_PotentialRevPerTower}  </p>
                                                                            <div class="potentialRevenuePerTower oppFieldDisplay" data-target="txtPotentialRevenuePerTower">potentialRevenuePerTower</div>
                                                                            <input type="text" id="txtPotentialRevenuePerTower" class="form-control input-sm oppFieldInput" data-target="potentialRevenuePerTower"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divDisposablePurchaseValue" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_DisposablePurchaseValue}</p>
                                                                            <div class="disposablePurchaseValue oppFieldDisplay" data-target="txtDisposablePurchaseValue">disposablePurchaseValue</div>
                                                                            <input type="text" id="txtDisposablePurchaseValue" class="form-control input-sm oppFieldInput" data-target="disposablePurchaseValue"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divPatientVolume" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_PatientVolume}</p>
                                                                            <div class="patientVolume oppFieldDisplay" data-target="txtPatientVolume">patientVolume</div>
                                                                            <input type="text" id="txtPatientVolume" class="form-control input-sm oppFieldInput" data-target="patientVolume"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divPotentialUserNumber" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_PotentialUserNumber}</p>
                                                                            <div class="potentialUserNumber oppFieldDisplay" data-target="txtPotentialUserNumber">patientVolume</div>
                                                                            <input type="text" id="txtPotentialUserNumber" class="form-control input-sm oppFieldInput" data-target="potentialUserNumber"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divTotalAnnualPotential" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_TotalAnnualPotential}</p>
                                                                            <div class="totalAnnualPotential oppFieldDisplay" data-target="txttotalAnnualPotential">totalAnnualPotential</div>
                                                                            <input type="text" id="txttotalAnnualPotential" class="form-control input-sm oppFieldInput" data-target="totalAnnualPotential"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divCurrentFYRevenue" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_CurrentFYReve}</p>
                                                                            <div class="currentFYRevenue oppFieldDisplay" data-target="txtcurrentFYRevenue">currentFYRevenue</div>
                                                                            <input type="text" id="txtcurrentFYRevenue" class="form-control input-sm oppFieldInput" data-target="currentFYRevenue"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divTotalBudgetary" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_TotalBudgetary}</p>
                                                                            <div class="totalBudgetary oppFieldDisplay" data-target="txtTotalBudgetary">totalBudgetary</div>
                                                                            <input type="text" id="txtTotalBudgetary" class="form-control input-sm oppFieldInput" data-target="totalBudgetary"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divFinalPOAmount" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_FinalPOAmount}</p>
                                                                            <div class="finalPOAmount oppFieldDisplay" data-target="txtFinalPOAmount">finalPOAmount</div>
                                                                            <input type="text" id="txtFinalPOAmount" class="form-control input-sm oppFieldInput" data-target="finalPOAmount"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divEstimatedInstallDate" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_EstimatedInstallDate}</p>
                                                                            <div class="estimatedInstallDate oppFieldDisplay" data-target="txtEstimatedInstallDate">estimatedInstallDate</div>
                                                                            <input type="text" id="txtEstimatedInstallDate" class="form-control input-sm oppFieldInput" data-target="estimatedInstallDate"/>
                                                                        </div>
                                                                        <div class="col-sm-12 form-group detail_div nopadding" id="divContractYears" style="display:none">
                                                                            <p class="form-control-static axis-detail-pg-field-label">{!$Label.AROpportunity_ContractYears}</p>
                                                                            <div class="contractYears oppFieldDisplay" data-target="txtContractYears">disposablePurchaseValue</div>
                                                                            <input type="text" id="txtContractYears" class="form-control input-sm oppFieldInput" data-target="contractYears"/>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-xs-12" id="divDetailOppLineItems" style="display:none">
                                                                        <h4>{!$Label.AROpportunity_ProductInfo}</h4>
                                                                        <table class="table product-parts">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th class="axis-detail-pg-field-label">{!$Label.AROpportunity_PartNumber}</th>
                                                                                    <th class="axis-detail-pg-field-label">{!$Label.AROpportunity_Description}</th>
                                                                                    <th class="axis-detail-pg-field-label">{!$Label.AROpportunity_Qty}</th>
                                                                                    <th class="axis-detail-pg-field-label">{!$Label.AROpportunity_UnitPrice}</th>
                                                                                    <th class="axis-detail-pg-field-label">{!$Label.AROpportunity_TotalPrice}</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                
                                                                            </tbody>
                                                                            <tfoot>
                                                                                <tr>
                                                                                    <td colspan="3">&nbsp;</td>
                                                                                    <td>{!$Label.AROpportunity_Total}</td>
                                                                                    <td id="totalProductAmount">-</td>
                                                                                </tr>
                                                                            </tfoot>
                                                                        </table>
                                                                    </div>
                                                                </div> <!-- end of row -->
                                                            </div> <!-- end of clearfix -->
                                                          </div> <!-- end of full-height-scroll -->
                                                     </div> <!-- tab-pane active -->
                                                    <div id="tab-activities" class="tab-pane" style="min-height: 400px">
<!--                                                        <h3>{!$Label.AROpportunity_ActivityTab}</h3>
 -->                                                    <div class="full-height-scroll">
                                                            <div class="clearfix">
                                                                <div class="row">
                                                                    <div class="col-sm-6 form-group detail_div">
                                                                        <div class="form-group">
                                                                            <label for="activityFilter" class="col-sm-2 control-label" style="padding-top: 7px">{!$Label.AROpportunity_Show} </label>
                                                                            <div class="col-sm-10">
                                                                                <select class="form-control" id="activityFilter" onchange="loadOpportunityActivities(this.value)">
                                                                                    <option value="All Activities">{!$Label.AROpportunity_AllActivities}</option>
                                                                                    <option value="Surgical Case">{!$Label.AROpportunity_SurgicalCase}</option>
                                                                                    <option value="Log">{!$Label.AROpportunity_Log}</option>
                                                                                    <!-- added by chad -->
                                                                                    <option value="Task">{!$Label.AROpportunity_Task}</option>
                                                                                    <!-- end added by chad -->
                                                                                    <option value="Note">{!$Label.AROpportunity_Note}</option>
                                                                                    <!-- Vishnu Release 4.4 -->
                                                                                    <option value="Lead">{!$Label.AROpportunity_Lead}</option>
                                                                                    <!-- Vishnu Release 4.4 -->
                                                                                    <option value="Attachment">Attachments</option><!-- added by srinivas.sattoor on 8.21.2017 for release 4.4 CID-000440 -->
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                      
                                                                    </div>
                                                                    <!-- Commented by Srinivas Sattoor on 8.22.2017 for 4.4 CID-000440 -->
                                                                    <!-- <div class="col-sm-6">
                                                                        <button class="btn btn-primary btn-sm" onclick="populateOppDependentLists('add-linked-cases')"> Link Cases </button>
                                                                        &nbsp;&nbsp;&nbsp;
                                                                        <button class="btn btn-primary btn-sm" onclick="showAddNotes()"> Add Notes </button>
                                                                        &nbsp;&nbsp;&nbsp;
                                                                        <button class="btn btn-primary btn-sm" onclick="showAddTasks()"> Add Task </button>

                                                                    </div> -->
                                                                    <div class="col-sm-6">
                                                                        <div class="col-sm-6">
                                                                        </div>
                                                                        <div class="col-sm-6 pull-right" >
                                                                            <div class="dropdown">
                                                                                <button class="btn btn-primary opportunity-detail-activity-dropdown" type="button" data-toggle="dropdown">
                                                                                <span class="caret"></span></button>
                                                                                <ul class="dropdown-menu">
                                                                                  <li><a href="#" onclick="populateOppDependentLists('add-linked-cases')">Link Cases</a></li>
                                                                                  <li><a href="#" onclick="showAddNotes()">Add Notes</a></li>
                                                                                  <li><a href="#" onclick="showAddTasks()">Add Task</a></li>
                                                                                  <!-- added by srinivas.sattoor on 8.21.2017 for release 4.4 CID-000440 -->
                                                                                  <li><a href="#" onclick="showAddAttachments()">Add Attachments</a></li>
                                                                                </ul>
                                                                            </div> <!-- end of dropdown -->
                                                                        </div>
                                                                    </div>
                                                                </div>  
                                                                <div class="row">
                                                                    <div class="col-sm-12 form-group detail_div">
                                                                        {!$Label.AROpportunity_NEXTSTEPS}
                                                                        <i class ="divNextSteps-busy fa fa-refresh fa-spin" style="display: none;"></i>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div id="divNextSteps" class="row">
                                                                </div>
                                                                
                                                                <div class="col-sm-12">
                                                                    <div style='border-bottom:1px solid #ccc;'></div>
                                                                </div>
                                                                <br/>
                                                                <div class="row">
                                                                    <div class="col-sm-12 form-group detail_div">
                                                                        {!$Label.AROpportunity_COMPLETEDSTEPS}
                                                                        <i class ="divCompletedSteps-busy fa fa-refresh fa-spin" style="display: none;"></i>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div id="divCompletedSteps" class="row">
                                                                </div>
                                                                    
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div> <!-- tab-content -->
                                            </div> <!--  end of tabs-container -->
                                        </div>  <!-- End of ibox-content -->
                                        </div>
                                    </div>
                                    <div id="divOppSummaries" class="col-xs-4 ">
                                        <div class="ibox-content box border_top_none">
                                            <div class="clearfix">
                                                <div class="GGrid col-lg-12">
                                                    <div class="row">
                                                        <div class="GGrid-content">
                                                            <i class="fa fa-user-md fa-2x  fa-fw fa-inverse  fa-border"></i> <span class="subsection_header">{!$Label.AROpportunity_Surgeons}</span>
                                                            <div class="pull-right"><i id="surgeons-toggle" class="fa fa-chevron-up" data-target="divSurgeonSummary"></i></div>
                                                            <div id="divSurgeonSummary" class="collapse in" style="margin-top: 10px">
                                                                {!$Label.AROpportunity_NoSurgeons}
                                                            </div>
                                                            <div class="col-xs-12">
                                                                <div class="pull-right">
                                                                    <button class="btn btn-primary btn-xs" data-toggle="modal" data-target="#opportunity-surgeon-add-modal">Add</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="ibox-content box border_top_none">
                                            <div class="clearfix">
                                                <div class="GGrid col-lg-12">
                                                    <div class="row">
                                                        <div class="GGrid-content">
                                                            <i class="fa fa-users fa-2x fa-fw fa-inverse  fa-border"></i> <span class="subsection_header">{!$Label.AROpportunity_KeyContacts}</span>
                                                            <div class="pull-right"><i id="key-contacts-toggle" class="fa fa-chevron-up" data-target="divKeyContactsSummary"></i></div>
                                                            <div id="divKeyContactsSummary" class="collapse in" style="margin-top: 10px">
                                                                <span id="noKeyContacts">{!$Label.AROpportunity_NoKeyContacts}</span>
                                                            </div>
                                                            <div class="col-xs-12">
                                                                <div class="pull-right">
                                                                    <button class="btn btn-primary btn-xs" data-toggle="modal" data-target="#opportunity-contact-modal">Add</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="ibox-content box border_top_none">
                                            <div class="clearfix">
                                                <div class="GGrid col-lg-12">
                                                    <div class="row">
                                                        <div class="GGrid-content">
                                                            <i class="fa fa-user fa-2x fa-fw fa-inverse  fa-border"></i> <span class="subsection_header">{!$Label.AROpportunity_OppTeam}</span>
                                                            <div class="pull-right"><i id="opp-team-toggle" class="fa fa-chevron-up" data-target="divOppTeamSummary"></i></div>
                                                            <div id="divOppTeamSummary" class="collapse in" style="margin-top: 10px">
                                                                <span id="noOppTeam">{!$Label.AROpportunity_NoOppTeam}</span>
                                                            </div>
                                                            <div class="col-xs-12">
                                                                <div class="pull-right">
                                                                    <button class="btn btn-primary btn-xs" data-toggle="modal" data-target="#opportunity-team-modal">Add</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="ibox-content box border_top_none">
                                            <div class="clearfix">
                                                <div class="GGrid col-lg-12">
                                                    <div class="row">
                                                        <div class="GGrid-content">
                                                            <i class="fa fa-line-chart fa-2x fa-fw fa-inverse  fa-border"></i> <span class="subsection_header">{!$Label.AROpportunity_LinkedOpp}</span>
                                                            <div class="pull-right"><i id="linked-opps-toggle" class="fa fa-chevron-up" data-target="divLinkedOppsSummary"></i></div>
                                                            <div id="divLinkedOppsSummary" class="collapse in" style="margin-top: 10px">
                                                                <p class="remove-when-present">{!$Label.AROpportunity_NoLinkedOpp}</p>
                                                            </div>
                                                            <div class="col-xs-12">
                                                                <div class="pull-right">
                                                                    <button class="btn btn-primary btn-xs" data-toggle="modal" onclick="populateOppDependentLists('add-linked-opps')">Add</button>
<!--                                                                        <button class="btn btn-primary btn-xs add-linked-opps" onclick="populateOppDependentLists('add-linked-opps')" data-trigger="opp-opportunty-type" data-toggle="modal" href="#opportunity-case-modal">Add</button>
 -->                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                    </div>  <!-- End of right column -->
                                </div>  <!-- End of ibox -->
                            </div>  <!-- End of Opportunity Details View -->
                        </div>
                    </div>
                </div>
                
                    <!-- Modal Start --> 
                    <!-- Edit Opportunity Modal -->
                
                <div id="opportunity-edit-modal" class="modal fade modal-authrex" role="dialog" data-backdrop="static" tabindex="-1" >
                    <div class="modal-dialog modal-lg">
                
                        <!-- Modal content-->
                        <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title" id="opportunity-edit-modal-title">{!$Label.AROpportunity_Opportunity}</h4>
                        </div>
                        
                        <div class="modal-body" >
                            <p/>
                            
                            <div class="row">
                                <div class="form-group col-sm-6">
                                    <div class="form-group col-sm-12">
                                        <label for="opportunityName" class="control-label"><span class="text-danger">*</span> {!$Label.AROpportunity_OppoName}</label>
                                        <input  id="opportunityName" class="form-control opportunityName" type="text" />
                                        <input  id="opportunityId" type="hidden" />
                                    </div>
                                    <div class="form-group col-sm-12">
                                        <label for="account" class="control-label"><span class="text-danger">*</span> {!$Label.AROpportunity_Account} <i class="account-busy fa fa-refresh fa-spin" style="display:none"></i></label>
                                        <input  id="account" class="form-control account account-typeahead" type="text" />
                                        <input  id="accountId"  type="hidden" />
                                    </div>
                                     <div class="form-group col-sm-12">
                                        <label for="opportunity-owner" class="control-label"><span class="text-danger">*</span> {!$Label.AROpportunity_OppoOwner} <i class="owner-busy fa fa-refresh fa-spin" style="display:none"></i></label>
                                        <select  id="opportunity-owner" class="form-control opportunity-owner" ></select>
                                        <input type="hidden" id="hidden-opportunity-owner" name="hidden-opportunity-owner" />
                                        <input type="hidden" id="opportunity-owner" name="opportunity-owner" />
                                    </div>
                                    <div class="form-group col-sm-12">
                                        <label for="productCategory" class="control-label">{!$Label.AROpportunity_ProductCategory}<i class="owner-busy fa fa-refresh fa-spin" style="display:none"></i></label>
                                        <select  id="productCategory" class="form-control productCategory clear-on-close" >
                                            <option value="0">- {!$Label.CS_Select} -</option>
                                        </select>
                                        <input type="hidden" id="hidden-productCategory" name="hidden-productCategory" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divProcedure" style="display:none">
                                        <label for="procedure" class="control-label"> {!$Label.AROpportunity_Procedure}</label>
                                        <input  id="procedure" class="form-control procedure clear-on-close procedure-typeahead" type="text" />
                                        <input  id="procedureId"  type="hidden" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divCompetitiveConversion" style="display:none">
                                        <label for="competitive-conversion" class="control-label"><span class="text-danger">*</span>{!$Label.AROpportunity_CompetitiveConv}</label>
                                        <select  id="competitive-conversion" class="form-control competitive-conversion clear-on-close" onchange="setCompetitiveComapny(this.value)">
                                            <option value="0">- {!$Label.CS_Select} -</option>
                                        </select>
                                        <input type="hidden" id="hidden-competitive-conversione" name="hidden-competitive-conversion" />
                                    </div>
                                    
                                    <!-- <div class="form-group col-sm-12">
                                        <label for="competitiveCompany" class="control-label">{!$Label.AROpportunity_CompetitiveCo}</label>
                                        <input  id="competitiveCompany" class="form-control competitiveCompany" type="text" />
                                    </div> -->
                                    <!-- <div class="form-group col-sm-12" id="divCompetitiveCompany" style="display:none">
                                        <label for="competitive-company" class="control-label">{!$Label.AROpportunity_CompetitiveCo}</label>
                                        <input  id="competitive-company" class="form-control competitive-company clear-on-close" type="text" />
                                    </div> -->
                                    <div class="form-group col-sm-12" id="divCompetitiveCompany" style="display:none">
                                        <label for="competitive-company" class="control-label"><span class="text-danger">*</span>{!$Label.AROpportunity_CompetitiveCo}</label>
                                        <select  id="competitive-company" class="form-control competitive-company clear-on-close">
                                            <option value="0">- {!$Label.CS_Select} -</option>
                                        </select>
                                        <input type="hidden" id="hidden-competitive-company" name="hidden-competitive-company" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divQuoteId" style="display:none">
                                        <label for="quoteId" class="control-label"> {!$Label.AROpportunity_QuoteID}</label>
                                        <input  id="quoteId" class="form-control quoteId" type="text" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divQuoteDate" style="display:none">
                                        <label for="quoteDate" class="control-label">{!$Label.AROpportunity_QuoteDate}</label>
                                        <div class="input-group date close-date-container">
                                            <input  id="quoteDate" class="form-control quoteDate clear-on-close" type="text" />
                                            <span class="input-group-addon">
                                                <span class="glyphicon glyphicon-calendar"></span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-12" id="divOppEditClosedLostReason">
                                        <label for="opp-edit-closed-lost-reason" class="control-label"> <span class="text-danger">*</span>{!$Label.AROpportunity_CloseLostReason}</label>
                                        <i class="opp-edit-closed-lost-reason-busy fa fa-refresh fa-spin" style="display:none"></i>
                                        <select  id="opp-edit-closed-lost-reason" class="form-control opp-edit-closed-lost-reason clear-on-close">
                                            <option value="0">- {!$Label.CS_Select} -</option>
                                      </select>
                                    </div>
                                
                                </div>
                                
                                <div class="form-group col-sm-6">
                                    <div class="form-group col-sm-12">
                                        <!-- <label for="closeDate" class="control-label"><span class="text-danger">*</span> {!$Label.AROpportunity_ProjectedCloseDate}</label>
                                        <input  id="closeDate" class="form-control closeDate" type="text" /> -->
                                        <label for="closeDate" class="control-label"><span class="text-danger">*</span> {!$Label.AROpportunity_ProjectedCloseDate}</label>
                                        <div class="input-group date close-date-container">
                                            <input  id="closeDate" class="form-control closeDate clear-on-close" type="text" />
                                            <span class="input-group-addon">
                                                <!--<span class="glyphicon glyphicon-calendar"></span>-->
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-12">
                                        <label for="stage" class="control-label"><span class="text-danger">*</span> {!$Label.AROpportunity_Stage}</label>
                                        <select  id="stage" class="form-control stage" onchange="setCloseLostReasons(this.value)">
                                            <option value="0">- {!$Label.CS_Select} -</option>
                                        </select>
                                    </div>
                                    <div class="form-group col-sm-12" id="divAnnualNumberofProcedures" style="display:none">
                                        <label for="annualNumberOfProcedures" class="control-label"> {!$Label.AROpportunity_AnnualNoOfProcedure}</label>
                                        <input  id="annualNumberOfProcedures" class="form-control annualNumberOfProcedures" onchange="populateTotalAnnualRevenue()" onkeypress="return OnlyNum(event)" type="text" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divPotentialRevenuePerCase" style="display:none">
                                        <label for="potentialRevenuePerCase" class="control-label"> {!$Label.AROpportunity_PotentialRevPerCase}</label>
                                        <input  id="potentialRevenuePerCase" class="form-control potentialRevenuePerCase" onchange="populateTotalAnnualRevenue()" onkeypress="return OnlyNum(event)" type="text" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divPatientVolume" style="display:none">
                                        <label for="patientVolume" class="control-label"> {!$Label.AROpportunity_PatientVolume}</label>
                                        <input  id="patientVolume" class="form-control patientVolume" onchange="populateTotalAnnualRevenue()" type="text" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divPotentialUserNumber" style="display:none">
                                        <label for="potentialUserNumber" class="control-label"> {!$Label.AROpportunity_PotentialUserNumber}</label>
                                        <input  id="potentialUserNumber" class="form-control potentialUserNumber" onchange="populateTotalAnnualRevenue()" type="text" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divPotentialRevenuePerTower" style="display:none">
                                        <label for="potentialRevenuePerTower" class="control-label">{!$Label.AROpportunity_PotentialRevPerTower}</label>
                                        <input  id="potentialRevenuePerTower" class="form-control potentialRevenuePerTower" onchange="populateTotalAnnualRevenue()" type="text" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divDisposablePurchaseValue" style="display:none">
                                        <label for="disposablePurchaseValue" class="control-label">{!$Label.AROpportunity_DisposablePurchaseValue}</label>
                                        <input  id="disposablePurchaseValue" class="form-control disposablePurchaseValue" onchange="populateTotalAnnualRevenue()" type="text" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divTotalNumOfTowers" style="display:none">
                                        <label for="totalNumOfTowers" class="control-label">{!$Label.AROpportunity_TotalNoOfTower}</label>
                                        <input  id="totalNumOfTowers" class="form-control totalNumOfTowers" onchange="populateTotalAnnualRevenue()" type="text" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divTotalNumOfORs" style="display:none">
                                        <label for="totalNumOfORs" class="control-label">{!$Label.AROpportunity_TotalNoOfOR}</label>
                                        <input  id="totalNumOfORs" class="form-control totalNumOfORs" type="text" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divEquipmentCost" style="display:none">
                                        <label for="equipmentCost" class="control-label">{!$Label.AROpportunity_EquipmentCost}</label>
                                        <input  id="equipmentCost" class="form-control equipmentCost" onchange="populateTotalAnnualRevenue()" type="text" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divNoChargeEquipmentValue" style="display:none">
                                        <label for="noChargeEquipmentValue" class="control-label">{!$Label.AROpportunity_NoChargeEquipValue}</label>
                                        <input  id="noChargeEquipmentValue" class="form-control noChargeEquipmentValue" onchange="populateTotalAnnualRevenue()"  type="text" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divTotalAnnualPotential" style="display:none">
                                        <label for="totalAnnualPotential" class="control-label">{!$Label.AROpportunity_TotalAnnualPotential}</label>
                                        <input  id="totalAnnualPotential" class="form-control totalAnnualPotential" type="text" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divLaborAndMaterials" style="display:none">
                                        <label for="laborAndMaterials" class="control-label">{!$Label.AROpportunity_LaborAndMaterials}</label>
                                        <input  id="laborAndMaterials" class="form-control laborAndMaterials" onchange="populateTotalAnnualRevenue()" type="text" />
                                    </div>
                                    <!-- <div class="form-group col-sm-12" id="divQuoteNum" style="display:none">
                                        <label for="quoteNum" class="control-label"> {!$Label.AROpportunity_QuoteNumber}</label>
                                        <input  id="quoteNum" class="form-control quoteNum" type="text" />
                                    </div> -->
                                    <!-- <div class="form-group col-sm-12" id="divCurrentFYRevenue" style="display:none">
                                        <label for="current-fy-revenue" class="control-label">{!$Label.AROpportunity_CurrentFYReve}</label>
                                        <input  id="current-fy-revenue" class="form-control current-fy-revenue readonly-control" type="text" />
                                    </div> -->
                                    <div class="form-group col-sm-12" id="divTotalBudgetary" style="display:none">
                                        <label for="totalBudgetary" class="control-label">{!$Label.AROpportunity_TotalBudgetary}</label>
                                        <input  id="totalBudgetary" class="form-control totalBudgetary" type="text" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divFinalPOAmount" style="display:none">
                                        <label for="finalPOAmount" class="control-label">{!$Label.AROpportunity_FinalPOAmount}</label>
                                        <input  id="finalPOAmount" class="form-control finalPOAmount" type="text" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divEstimatedInstallDate" style="display:none">
                                        <label for="estimatedInstallDate" class="control-label">{!$Label.AROpportunity_EstimatedInstallDate}</label>
    <!--                                    <input  id="estimatedInstallDate" class="form-control estimatedInstallDate" type="text" />
     -->                                    <div class="input-group date close-date-container">
                                            <input  id="estimatedInstallDate" class="form-control estimatedInstallDate clear-on-close" type="text" />
                                            <span class="input-group-addon">
                                                <span class="glyphicon glyphicon-calendar"></span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-12" style="display:none">
                                        <label for="opportunity-type" class="control-label"><span class="text-danger">*</span> {!$Label.AROpportunity_OppType} </label>
                                        <select  id="opportunity-type" class="form-control opportunity-type clear-on-close" onchange="setCompetitiveConversion(this.value)">
                                            <option value="0">- {!$Label.CS_Select} -</option>
                                        </select>
                                        <input type="hidden" id="hidden-opportunity-type" name="hidden-opportunity-type" />
                                    </div>
                                    <div class="form-group col-sm-12" id="divContractYears" style="display:none">
                                        <label for="contractYears" class="control-label">{!$Label.AROpportunity_ContractYears}</label>
                                        <input  id="contractYears" class="form-control contractYears" type="text" />
                                    </div>
                                
                                </div>
                                
                                <div class="row" id="divOpportunityLineItems" style="display:none">
                                    <div class="col-xs-12">
                                        <div class="table-responsive">

                                            <table class="table table-condensed product-parts related-table" style="margin-bottom:0px">
                                                <caption><h3>{!$Label.AROpportunity_Products}</h3></caption>
                                                <thead>
                                                    <tr>
                                                        <th style="width:22.5%">{!$Label.AROpportunity_PartNumber}</th>
                                                        <th style="width:34.5%">{!$Label.AROpportunity_Description}</th>
                                                        <th style="width:10%">{!$Label.AROpportunity_Qty}</th>
                                                        <th style="width:15%">{!$Label.AROpportunity_UnitPrice}</th>
                                                        <th style="width:15%">{!$Label.AROpportunity_TotalPrice}</th>
                                                        <th style="width:10%">&nbsp;</th>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <input type="text" class="form-control opportunity-part-number opportunity-part-number-typeahead"/>
                                                        </td>
                                                        <td>
                                                            <input type="text" class="form-control opportunity-part-description opportunity-part-description-typeahead"/>
                                                        </td>
                                                        <td>
                                                            <input type="text" class="form-control opportunity-part-quantity"/>
                                                        </td>
                                                        <td>
                                                            <input type="text" class="form-control opportunity-part-unit-price"/>
<!--                                                            <p class="form-control-static opportunity-part-unit-price"></p>
 -->                                                        </td>
                                                        <td>
                                                            <p class="form-control-static opportunity-part-total-price readonly-control"></p>
                                                            
                                                        </td>
                                                        <td style="vertical-align:middle;text-align:right">
                                                            <button class="btn btn-xs btn-primary add-opp-part" disabled="true" onclick="addPart()">Add</button>
                                                        </td>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                                                 
                                                </tbody>
                                                <tfoot>
                                                    <tr>
                                                        <td colspan="3">&nbsp;</td>
                                                        <td>Total</td>
                                                        <td id="totalProductAmount">-</td>
                                                        <td></td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>  <!-- End of Products Row -->
                            </div> <!-- End of row div -->

                        </div>
                        <div class="modal-footer">
                            <span class="text-danger save-error" id="newOppErrors"></span>
                            <button type="button" class="btn btn-default opportunity-cancel-btn">Cancel</button>
                            <button type="button" class="btn btn-primary opportunity-save-btn">Save</button>
                        </div>
                        </div>
                
                    </div>
                </div>
<!--                Opportunity surgeon add modal starts here
 -->                
                <div id="opportunity-surgeon-add-modal" class="modal fade modal-authrex" role="dialog" data-backdrop="static" tabindex="-1" >
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title">{!$Label.AROpportunity_CreateOppSurgeon}</h4>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="form-group col-sm-12">
                                        <label for="opportunity-name" class="control-label">{!$Label.AROpportunity_Opportunity}</label>
                                        <p id="opportunity-name" class="form-control-static opportunity-name readonly-control"></p>
                                    </div>
                                    <div class="form-group col-sm-12">
                                    <label for="surgeon" class="control-label"><span class="text-danger">*</span> {!$Label.AROpportunity_Surgeon} <i class="surgeon-busy fa fa-refresh fa-spin" style="display:none"></i></label>
                                        <input  id="surgeon" class="form-control surgeon-typeahead" type="text" />
                                         <div class="surgeon ctag-list clear-on-close"></div>
                                    </div>
                                </div>  <!-- end of row -->
                            </div>
                            <div class="modal-footer">
                                <span class="text-danger save-error" id="newSurgeonErrors"></span>
                                 
                                <button type="button" class="btn btn-default surgeon-add-cancel-btn" data-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary surgeon-add-save-btn"> Save</button>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
                

<!--                Opportunity surgeon add modal ends here
 -->
<!--                Opportunity contact role modal starts here
 -->                
                <div id="opportunity-contact-modal" class="modal fade modal-authrex" role="dialog" data-backdrop="static" tabindex="-1" >
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title">{!$Label.AROpportunity_CreateOppContactRole}</h4>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="form-group col-sm-12">
                                        <label for="opportunity-name" class="control-label">{!$Label.AROpportunity_Opportunity}</label>
                                        <p id="opportunity-name" class="form-control-static opportunity-name readonly-control"></p>
                                    </div>
                                    <!-- <div class="form-group col-sm-12">
                                        <label for="opportunity-contact" class="control-label"><span class="text-danger">*</span> {!$Label.AROpportunity_Contact} <i class="contact-busy fa fa-refresh fa-spin" style="display:none"></i></label>
                                        <input  id="opportunity-contact" class="form-control opportunity-contact opportunity-contact-typeahead clear-on-close" type="text" />
                                    </div> -->
                                    <div class="form-group col-sm-12">
                                        <label for="opportunity-contact" class="control-label">
                                            <span class="text-danger">*</span> {!$Label.AROpportunity_Contact} 
                                        <i class="opportunity-contact-busy fa fa-refresh fa-spin" style="display:none"></i></label>
                                        <select  id="opportunity-contact" class="form-control opportunity-contact clear-on-close">
                                            <option value="0"> - Select One -</option>
                                        </select>
                                    </div>
                                    <div class="form-group col-sm-12">
                                        <label for="contact-role" class="control-label"><span class="text-danger">*</span> {!$Label.AROpportunity_Role}
                                        <i class="contact-role-busy fa fa-refresh fa-spin" style="display:none"></i></label>
                                        <select  id="contact-role" class="form-control contact-role clear-on-close">
                                            <option value="0"> - Select One -</option>
                                        </select>
                                    </div>
                                    <div class="form-group col-sm-12">
                                        <label>
                                            <input type="checkbox" id="primary-role" class="primary-role clear-on-close"/> {!$Label.AROpportunity_PrimaryContactRole}
                                        </label>
                                    </div>
                                </div>  <!-- end of row -->
                            </div>
                            <div class="modal-footer">
                                <span class="text-danger save-error" id="newOppContactErrors"></span>
                                 
                                <button type="button" class="btn btn-default contact-cancel-btn" data-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary contact-save-btn"> Save</button>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
                

<!--                Opportunity contact role model ends here
 -->  
 
<!--                Opportunity Cancel model starts here
 -->                
                <div id="opportunity-cancel-modal" class="modal fade modal-authrex" role="dialog" data-backdrop="static" tabindex="-1" >
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title">{!$Label.AROpportunity_CancelOpp}</h4>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" id="confirmation" class="clear-on-close"/>
                                <div class="row">
                                    <div class="form-group col-sm-12">
                                        <label for="opportunity-name" class="control-label">{!$Label.AROpportunity_Opportunity}</label>
                                        <p id="opportunity-name" class="form-control-static opportunity-name readonly-control"></p>
                                    </div>
                                    <div class="form-group col-sm-12">
                                        <label for="opportunity-stage" class="control-label">{!$Label.AROpportunity_Stage}</label>
                                        <p id="opportunity-stage" class="form-control-static opportunity-stage readonly-control"></p>
                                    </div>
                                    <!-- <div class="form-group col-sm-12">
                                        <label for="close-lost-reasons" class="control-label"><span class="text-danger">*</span> {!$Label.AROpportunity_CloseLostReason}
                                        <i class="close-lost-reasons-busy fa fa-refresh fa-spin" style="display:none"></i></label>
                                        <select  id="close-lost-reasons" class="form-control close-lost-reasons clear-on-close">
                                            <option value=""> - Select One -</option>
                                        </select>
                                    </div> -->
                                    <div class="form-group col-sm-12">
                                        <label for="cancelledWithaReason" class="control-label"><span class="text-danger">*</span>{!$Label.AROpportunity_CancelledReason}</label>
                                        <input type="text" id="cancelledWithaReason" class="form-control" />
                                    </div>
                                </div>  <!-- end of row -->
                            </div>
                            <div class="modal-footer">
                                <span class="text-danger save-error" id="cancelOppSaveErrors"></span>
                                 
                                <button type="button" class="btn btn-default contact-cancel-btn" data-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary contact-save-btn"> Save</button>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->

<!--                Opportunity Cancel model ends here
 -->
                <!-- Opportunity Contact Role detele confirm starts here -->
                
                <div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                {!$Label.AROpportunity_DeletingOppContact}
                            </div>
                            <div class="modal-body">
                                <p class="confirm-modal-body">
                                {!$Label.AROpportunity_Confirmation}
                                </p>
                                <input type="hidden" id="deleteId" />
                                <input type="hidden" id="deleteMethod" />
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button class="btn btn-danger btn-ok">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Opportunity Contact Role detele confirm ends here -->
                
                <!--                Opportunity team model starts here
 -->                
                <div id="opportunity-team-modal" class="modal fade modal-authrex" role="dialog" data-backdrop="static" tabindex="-1" >
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title">{!$Label.AROpportunity_CreateOppTeamRole}</h4>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="form-group col-sm-12">
                                        <label for="opportunity-name" class="control-label">{!$Label.AROpportunity_Opportunity}</label>
                                        <p id="opportunity-name" class="form-control-static opportunity-name readonly-control"></p>
                                    </div>
                                    <div class="form-group col-sm-12">
                                        <label for="add-sales-rep" class="control-label"><span class="text-danger">*</span> {!$Label.AROpportunity_SalesRep} <i class="contact-busy fa fa-refresh fa-spin" style="display:none"></i></label>
                                        <input  id="add-sales-rep" class="form-control add-sales-rep add-sales-rep-typeahead clear-on-close" type="text" />
                                        <div class="sales-reps ctag-list clear-on-close"></div>
                                    </div>
                                    <div class="form-group col-sm-12">
                                        <label for="opportunity-team-role" class="control-label"><span class="text-danger">*</span> {!$Label.AROpportunity_Role}
                                        <i class="opportunity-team-role-busy fa fa-refresh fa-spin" style="display:none"></i></label>
                                        <select  id="opportunity-team-role" class="form-control opportunity-team-role clear-on-close">
                                            <option value="0"> - Select One -</option>
                                        </select>
                                    </div>
                                </div>  <!-- end of row -->
                            </div>
                            <div class="modal-footer">
                                <span class="text-danger save-error" id="newOppContactErrors"></span>
                                 
                                <button type="button" class="btn btn-default contact-cancel-btn" data-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary contact-save-btn"> Save </button>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->

<!--                Opportunity team modal ends here
 -->  
                
                <!-- link opportunities modal starts here -->
                <div class="modal fade" id="link-oppportunities-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                {!$Label.AROpportunity_ExistingOpp}
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-xs-12">
                                        <div class="table-responsive">
                
                                            <table id="linked-opps" class="table table-condensed linked-opps related-table" style="margin-bottom:0px">
                                                <caption><h3>{!$Label.AROpportunity_LinkedOpp}</h3></caption>
                                                <thead>
                                                    <tr>
                                                        <th style="width:32.5%">{!$Label.AROpportunity_OppType}</th>
                                                        <th style="width:22.5%">{!$Label.AROpportunity_Stage}</th>
                                                        <th style="width:20%">{!$Label.AROpportunity_AnnualRevenue}</th>
                                                        <th style="width:15%">{!$Label.AROpportunity_ProjectedCloseDate}</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                                                 
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button class="btn btn-danger btn-ok">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- link opportunities modal ends here -->
                
                <!-- Opportunity closed stage modal starts here -->
                <div id="opportunity-stage-close-modal" class="modal fade modal-authrex" role="dialog" data-backdrop="static" tabindex="-1" >
                    <div class="modal-dialog">
                    
                            <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                <h3 class="dependent-list-header">{!$Label.AROpportunity_CloseThisOpp}</h3>
                            </div>
                            <div class="form-group col-sm-12">
                            </div>
                            <div class="form-group col-sm-12">
                                <label for="opportunity-stage-closed" class="control-label"><span class="text-danger">*</span> {!$Label.AROpportunity_Stage}
                                <i class="opportunity-stage-closed-busy fa fa-refresh fa-spin" style="display:none"></i></label>
                                <select  id="opportunity-stage-closed" class="form-control opportunity-stage-closed clear-on-close" onChange="setCloseLostReasons(this.value)">
                                    <option value=""></option>
                                    <option value="Closed - Won">{!$Label.AROpportunity_ClosedWon}</option>
                                    <option value="Closed - Lost">{!$Label.AROpportunity_ClosedLost}</option>
                                </select>
                            </div>
                            <div class="form-group col-sm-12" id="divClosedLostReason" style="display:none">
                                <label for="closed-lost-reason" class="control-label"><span class="text-danger">*</span>{!$Label.AROpportunity_CloseLostReason}</label>
                                <i class="opportunity-closed-lost-reason-busy fa fa-refresh fa-spin" style="display:none"></i>
                                <select  id="closed-lost-reason" class="form-control opportunity-closed-lost-reason clear-on-close">
                                    <option value=""></option>
                              </select>
                            </div>
                            <div class="modal-footer">
                                <span class="text-danger save-error" id="stageClosedModalErrors"></span>
                                <button type="button" data-dismiss="modal" class="btn">Cancel</button>
                                <button type="button" class="btn btn-primary stage-close-modal-btn" >Save</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Opportunity closed stage modal ends here -->

                <div id="opportunity-case-modal" class="modal fade modal-authrex" role="dialog" data-backdrop="static" tabindex="-1" >
                    <div class="modal-dialog modal-lg">
                    
                            <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close btn-cancel-opportunity-case" aria-hidden="true">×</button>
                                <h3 class="dependent-list-header">{!$Label.AROpportunity_OppCaseSelection}</h3>
                            </div>
                            <div class="modal-body">
                                <div id="div-busy"><i class="fa fa-refresh fa-spin fa-2x"></i> {!$Label.AROpportunity_LoadingTheData}</div>
                                <div class="table-responsive" id="divLinkedCasesFilters" style="display: none;">
                                <!-- <div> -->
                                    <table class="table" style="margin-bottom: 0;">
                                        <tr>
                                            <td>
                                                <select id="filterCaseDate" data-width="125px" data-style="btn-default" title="Case Date" data-showTick="true" data-container="#divLinkedCasesFilters">
                                                    <option value="*">{!$Label.AROpportunity_AllTime}</option>
                                                    <option value="-30 d">{!$Label.AROpportunity_Prev30Days}</option>
                                                    <option value="-90 d">{!$Label.AROpportunity_Prev90Days}</option>
                                                    <option value="-1 q">{!$Label.AROpportunity_PrevQuarter}</option>
                                                    <option value="-1 f">{!$Label.AROpportunity_PrevFY}</option>
                                                    <option value="0 q">{!$Label.AROpportunity_CurrentQuarter}</option>
                                                    <option value="0 f">{!$Label.AROpportunity_CurrentFY}</option>
                                                    <option value="30 d">{!$Label.AROpportunity_Next30Days}</option>
                                                    <option value="90 d">{!$Label.AROpportunity_Next90Days}</option>
                                                    <option value="1 q">{!$Label.AROpportunity_NextQuarter}</option>
                                                    <option value="1 f">{!$Label.AROpportunity_NextFY}</option>
                                                </select>
                                            </td>
                                            <td><select id="filterCaseSurgeon" multiple="multiple" data-live-search="true" data-width="125px" data-style="btn-default" title="Surgeon" data-container="#divLinkedCasesFilters"></select></td>
                                            <td><select id="filterCaseAccount" multiple="multiple" data-live-search="true" data-width="125px" data-style="btn-default" title="Account" data-container="#divLinkedCasesFilters"></select></td>
                                            <td><select id="filterCaseProcedure" multiple="multiple" data-live-search="true" data-width="125px" data-style="btn-default" title="Procedure" data-container="#divLinkedCasesFilters"></select></td>
                                            <td><select id="filterCaseStatus" multiple="multiple" data-live-search="true" data-width="125px" data-style="btn-default" title="Status" data-container="#divLinkedCasesFilters"></select></td>
                                        </tr>
                                    </table>
                                </div>
                                
                                
                                <div class="table-responsive" id="divLinkedOpportunityFilters" style="display: none;">
                                <!-- <div> -->
                                    <table class="table" style="margin-bottom: 0;">
                                        <tr>
                                            <td><select id="filterOpprtunityName" multiple="multiple" data-live-search="true" data-width="125px" data-style="btn-default" title="Opprtunity Name" data-container="#divLinkedOpportunityFilters"></select></td>
                                            <td><select id="filterLinkOpportunityType" multiple="multiple" data-live-search="true" data-width="125px" data-style="btn-default" title="Opportunity Type" data-container="#divLinkedOpportunityFilters"></select></td>
                                            <td><select id="filterAnnualRevenue" multiple="multiple" data-live-search="true" data-width="125px" data-style="btn-default" title="Annual Revenue" data-container="#divLinkedOpportunityFilters"></select></td>
                                            <td>
                                                <select id="filterCloseDate" data-width="125px" data-style="btn-default" title="Close Date" data-container="#divLinkedOpportunityFilters" data-showTick="true">
                                                    <option value="*">{!$Label.AROpportunity_AllTime}</option>
                                                    <option value="-30 d">{!$Label.AROpportunity_Prev30Days}</option>
                                                    <option value="-90 d">{!$Label.AROpportunity_Prev90Days}</option>
                                                    <option value="-1 q">{!$Label.AROpportunity_PrevQuarter}</option>
                                                    <option value="-1 f">{!$Label.AROpportunity_PrevFY}</option>
                                                    <option value="0 q">{!$Label.AROpportunity_CurrentQuarter}</option>
                                                    <option value="0 f">{!$Label.AROpportunity_CurrentFY}</option>
                                                    <option value="30 d">{!$Label.AROpportunity_Next30Days}</option>
                                                    <option value="90 d">{!$Label.AROpportunity_Next90Days}</option>
                                                    <option value="1 q">{!$Label.AROpportunity_NextQuarter}</option>
                                                    <option value="1 f">{!$Label.AROpportunity_NextFY}</option>
                                                </select>
                                            </td>
                                            
                                        </tr>
                                    </table>
                                </div>
                                
                                
                                
                                
                                <table id="table-dependents"></table>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-cancel-opportunity-case">Cancel</button>
                                <button type="button" class="btn btn-primary" onclick="selectDependentList()">Ok</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!--CID - 000177/Mimansha Samal/May/5/2017/ Link Opp Cases Save warning modal -->
                <div class="modal fade  modal-authrex" id="cancel-opportunity-case-modal" data-backdrop="static" tabindex="-1" role="dialog" >
               
                    <div class="modal-dialog" style="width:450px">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title">&nbsp;&nbsp; Opportunity Case Selection</h4>
                            </div>
            
                            <div class="modal-body">
                                <div class="row">
                                    <div>
                                   
                                      <label class="dependent-opp-label">Do you want to save the changes you made for the Opportunity Case Selection? </label>
                                                  
                                    </div>
                                </div>
                            </div>
            
                            <div class="modal-footer">
                                <span class="text-danger save-error"></span>
                               
                                <button type="button" class="btn btn-default" data-dismiss="modal">{!$Label.CS_Yes}</button>
                                <button type="button" class="btn btn-primary btn-cancel-opp-case-warning">{!$Label.CS_No}</button>
                                
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal --> 
                
                <!--CID - 000177/Mimansha Samal/April/17/2017/ Add/Edit Account Notes Save warning modal -->
                
                <div id="opportunity-notes-modal" data-rec-id="" class="modal fade modal-authrex" role="dialog" data-backdrop="static" tabindex="-1" >
                    <div class="modal-dialog">
                    
                            <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close btn-cancel-opportunity-notes" aria-hidden="true">×</button>
                                <h3 class="dependent-list-header">{!$Label.AROpportunity_OppNotes}</h3>
                            </div>
                            <div class="modal-body">
                                <div>
                                    <div class="form-group row">
                                        <label for="oppNoteDate" class="col-sm-2 control-label" style="padding-top: 7px">{!$Label.AROpportunity_Date}</label>
                                        <div class="col-sm-10">
                                            <p class="form-control-static" id="oppNoteDate">
                                                dateFormatter(moment());
                                            </p>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="oppNotes" class="col-sm-2 control-label">{!$Label.AROpportunity_Note}&nbsp;<span class="text-danger">*</span></label>
                                        <div class="col-sm-10">
                                            <textarea class="form-control" rows="5" id="oppNotes"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <span class="text-danger save-error" id="addNoteErrors"></span>
                                
                                <button type="button" class="btn btn-cancel-opportunity-notes">Cancel</button>
                                <button type="button" class="btn btn-primary" onclick="addOpportunityNote()">Ok</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!--CID - 000177/Mimansha Samal/May/5/2017/ Link Opp Cases Save warning modal -->
                <div class="modal fade  modal-authrex" id="cancel-opportunity-notes-modal" data-backdrop="static" tabindex="-1" role="dialog" >
               
                    <div class="modal-dialog" style="width:450px">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title">&nbsp;&nbsp; Opportunity Notes</h4>
                            </div>
            
                            <div class="modal-body">
                                <div class="row">
                                    <div>
                                   
                                      <label>Do you want to save the changes you made for the Opportunity Notes? </label>
                                                  
                                    </div>
                                </div>
                            </div>
            
                            <div class="modal-footer">
                                <span class="text-danger save-error"></span>
                               
                                <button type="button" class="btn btn-default" data-dismiss="modal">{!$Label.CS_Yes}</button>
                                <button type="button" class="btn btn-primary btn-cancel-opp-notes-warning">{!$Label.CS_No}</button>
                                
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal --> 
                
                <!--CID - 000177/Mimansha Samal/April/17/2017/ Add/Edit Account Notes Save warning modal -->
                
                <div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                {!$Label.AROpportunity_DeletingOppContact}
                            </div>
                            <div class="modal-body">
                                <p class="confirm-modal-body">
                                {!$Label.AROpportunity_Confirmation}
                                </p>
                                <input type="hidden" id="deleteId" />
                                <input type="hidden" id="deleteMethod" />
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button class="btn btn-danger btn-ok">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="opportunity-cancel-confirm-modal" class="modal fade modal-authrex" role="dialog" data-backdrop="static" tabindex="-1" >
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                {!$Label.AROpportunity_ConfirmOppCancellation}
                            </div>
                            <div class="modal-body">
                                
                                {!$Label.AROpportunity_ConfirmationOpp}
                                
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button class="btn btn-danger btn-cancel-opp">Ok</button>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
                
                
                              
            <!--CID - 000041/Swetha P/Dec/9/2016/Edit opportunity warning message-->
             
            <div class="modal fade  modal-authrex" id="cancel-opportunity-modal" data-backdrop="static" tabindex="-1" role="dialog">
              <div class="modal-dialog"  style="width:450px">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title"><i class="fa fa-plus-square-o"></i>&nbsp;&nbsp;Opportunity</h4>
                  </div>

                  <div class="modal-body">
                   <div class="row">
      
                          <label>Do you want to save the changes you made for the opportunity? </label>
                     </div>         
                  </div>
                  <div class="modal-footer">
                    <span class="text-danger save-error"></span>&nbsp;&nbsp;
                   
                    <button type="button" class="btn btn-default" data-dismiss="modal">Yes</button>
                    <button type="button" class="btn btn-primary btn-cancel-opportunity-card">No</button>
                    
                  </div>
                </div><!-- /.modal-content -->
              </div><!-- /.modal-dialog -->
            </div><!-- /.modal -->  


                
            <!--CID - 000041/Swetha P/Dec/9/2016/Edit Opportunity warning  Card -->
            
                    <!-- Modal End -->
                <script type="text/javascript">
                    
                    var currentUserId = "{!$User.Id}"; 
                     
                    function assignSalesRepsTypeahead(){
                        
                        $("#opportunity-modal .add-sales-rep-typeahead").typeahead({
                            // typeahead setup for case participants
                            minLength: 1,
                            items: 50,
                            source: function(query, onSuccess) {
                                search(query, "CS_ARCCExtension.searchUsers", onSuccess);                                    
                            },
                            displayText: function(item) {
                                return globalDecodeEntities(item.Name);
                            },
                            afterSelect: function(item) {
                
                                if ( (item.Id != currentUserId) && ($("#opportunity-modal span[data-record-id="+item.Id+"].ctag").length === 0) ) {
                                    // no duplicates and can't add yourself
                                    $("#opportunity-modal div.ctag-list.sales-reps").append(obj2ctag(item));
                                }
                                $("#opportunity-modal .add-sales-rep-typeahead").val("");
                
                            }
                        });
                        
                        $("#opportunity-edit-modal .add-sales-rep-typeahead").typeahead({
                            // typeahead setup for case participants
                            minLength: 1,
                            items: 50,
                            source: function(query, onSuccess) {
                                search(query, "CS_ARCCExtension.searchUsers", onSuccess);                                    
                            },
                            displayText: function(item) {
                                return globalDecodeEntities(item.Name);
                            },
                            afterSelect: function(item) {
                
                                if ( (item.Id != currentUserId) && ($("#opportunity-edit-modal span[data-record-id="+item.Id+"].ctag").length === 0) ) {
                                    // no duplicates and can't add yourself
                                    $("#opportunity-edit-modal div.ctag-list.sales-reps").append(obj2ctag(item));
                                }
                                $("#opportunity-edit-modal .add-sales-rep-typeahead").val("");
                
                            }
                        });
                        
                    }   //  end of assignSalesRepsTypeahead
                    

                    function assignProcedureTypeahead(){
                        $("#opportunity-edit-modal input.procedure-typeahead").typeahead({
                            // typeahead setup for prefcards
                            minLength: 0,
                            items: 50,
                            source: function(query, onSuccess) {
                                search(query, "CS_ARCCExtension.searchProcedures", onSuccess);
                            },
                            displayText: function(item) {
                                return globalDecodeEntities(item.Name);
                            },
                            afterSelect: function(item) {                
                                /* if ( $("#opportunity-modal span[data-record-id="+item.Id+"].ctag").length === 0 ) {
                                    // no duplicates
                                    $("#opportunity-modal div.ctag-list.procedures").append(obj2ctag(item));
                                }
                                $("#opportunity-modal .procedure-typeahead").val(""); */
                                $("#opportunity-modal input.procedure").val(globalDecodeEntities(item.Name));
                                $("#opportunity-edit-modal input.procedure").attr("data-record-id", item.Id);
                              
                            }
                        });
                    }   //  end of assignProcedureTypeahead
                    
                    
                    function assignProductsTypeahead(){
                        $("#opportunity-modal input.products-typeahead").typeahead({
                            // typeahead setup for case products
                            minLength: 3,
                            items: 50,
                            source: function(query, onSuccess) {
                                search(query, "CS_ARCCExtension.searchProducts", onSuccess);                                    
                            },
                            displayText: function(item) {
                                return globalDecodeEntities(item.Name+" "+item.Material_Number__c);
                            },
                            afterSelect: function(item) {
                
                                if ( $("#opportunity-modal span[data-record-id="+item.Id+"].ctag").length === 0 ) {
                                    // no duplicates
                                    item.Name += " "+item.Material_Number__c;
                
                                    $("#opportunity-modal div.ctag-list.products").append(obj2ctag(item));
                                }
                                $("#opportunity-modal .products-typeahead").val("");
                
                            }
                        });
                    }   //  end of assignProductsTypeahead
                    
                    
                    function assignOppPartsTypeahead(){
                        $("#opportunity-edit-modal input.opportunity-part-number-typeahead").typeahead({
                            // typeahead setup for case products
                            minLength: 3,
                            items: 50,
                            source: function(query, onSuccess) {
                                search(query, "CS_ARCCExtension.searchPriceBookEntries", onSuccess);                                    
                            },
                            displayText: function(item) {
                                return globalDecodeEntities( item.Product2.Material_Number__c + " ; " + item.Product2.Name);
                            },
                            afterSelect: function(item) {
                            
                                $("#opportunity-edit-modal .opportunity-part-number-typeahead").val(item.Product2.Material_Number__c);
                                $("#opportunity-edit-modal .opportunity-part-number-typeahead").attr("data-part-id", item.Id);
                                
                                $("#opportunity-edit-modal .opportunity-part-description").val(item.Product2.Description);
                                $("#opportunity-edit-modal .opportunity-part-quantity").val("1");
                                $("#opportunity-edit-modal .opportunity-part-unit-price").val("$" + item.UnitPrice.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                                $("#opportunity-edit-modal .opportunity-part-unit-price").attr("data-unit-price", item.UnitPrice);
                                
                                $("#opportunity-edit-modal .opportunity-part-total-price").text("$" + item.UnitPrice.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                                $("#opportunity-edit-modal .opportunity-part-total-price").attr("data-total-price", item.UnitPrice);
                                
                                $("#opportunity-edit-modal button.add-opp-part").removeAttr('disabled');
                                //alert(item + " selected and need to add a row in table");
                
                            }
                        });
                    }   //  end of assignOppPartsTypeahead
                    
                    function assignOppPartDescriptionTypeahead(){
                        $("#opportunity-edit-modal input.opportunity-part-description-typeahead").typeahead({
                            // typeahead setup for case products
                            minLength: 3,
                            items: 50,
                            source: function(query, onSuccess) {
                                search(query, "CS_ARCCExtension.searchPriceBookEntries", onSuccess);                                    
                            },
                            displayText: function(item) {
                                return globalDecodeEntities( item.Product2.Material_Number__c + " ; " + item.Product2.Name);
                            },
                            afterSelect: function(item) {
                            
                                $("#opportunity-edit-modal .opportunity-part-number-typeahead").val(item.Product2.Material_Number__c);
                                $("#opportunity-edit-modal .opportunity-part-number-typeahead").attr("data-part-id", item.Id);
                                
                                $("#opportunity-edit-modal .opportunity-part-description").val(item.Product2.Description);
                                $("#opportunity-edit-modal .opportunity-part-quantity").val("1");
                                $("#opportunity-edit-modal .opportunity-part-unit-price").text("$" + item.UnitPrice.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                                $("#opportunity-edit-modal .opportunity-part-unit-price").attr("data-unit-price", item.UnitPrice);
                                
                                $("#opportunity-edit-modal .opportunity-part-total-price").text("$" + item.UnitPrice.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                                $("#opportunity-edit-modal .opportunity-part-total-price").attr("data-total-price", item.UnitPrice);
                                
                                $("#opportunity-edit-modal button.add-opp-part").removeAttr('disabled');
                                //alert(item + " selected and need to add a row in table");
                
                            }
                        });
                    }   //  end of assignOppPartDescriptionTypeahead
                    
                    
                    function setCompetitiveComapny(val){
                    
                        if(val == "Yes"){
                            $("#divCompetitiveCompany").show();
                            $("div#divCompetitiveCompany").show();
                        } else {
                            $("#divCompetitiveCompany").hide();
                            $("div#divCompetitiveCompany").hide();
                        }
                    }   //  end of setCompetitiveComapny
                    
                     
                    //add total annual revenue when the annual number of proc or potential revenue changes.
                    function populateTotalAnnualRevenue(){
                        
                        var opportunityType = $("#opportunity-edit-modal #opportunity-type").val();
                        console.log('##--populateTotalAnnualRevenue.opportunityType: '+ opportunityType);
                        if(opportunityType == "Product Conversion"){
                        
                            var potentialrev = $("#opportunity-edit-modal input#potentialRevenuePerCase").val();
                            if(potentialrev == null || potentialrev == ''){
                                potentialrev = null;
                            }else{
                                potentialrev = parseFloat(potentialrev.replace('$','').replace(/,/g,''));
                            }
                            var annualNumberOfProcedures = $("#opportunity-edit-modal #annualNumberOfProcedures").val();
                            if(annualNumberOfProcedures == null || annualNumberOfProcedures == ''){
                                annualNumberOfProcedures = null;
                            }
                            
                            if(annualNumberOfProcedures != null
                                &&  potentialrev != null){
                                totalAnnualRev = annualNumberOfProcedures * potentialrev;
                                $("#opportunity-edit-modal input.totalAnnualPotential").val("$"+totalAnnualRev.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                            }
                            
                        }else if(opportunityType == "SOS"){
                        
                            var patientVol = $("#opportunity-edit-modal input#patientVolume").val();
                            if(patientVol == null || patientVol == ''){
                                patientVol = null;
                            }
                            
                            var potentialUserNumber = $("#opportunity-edit-modal #potentialUserNumber").val();
                            if(potentialUserNumber == null || potentialUserNumber == ''){
                                potentialUserNumber = null;
                            }else{
                                potentialUserNumber = parseFloat(potentialUserNumber.replace('$','').replace(/,/g,''));
                            }
                            
                            if(potentialUserNumber != null
                                &&  patientVol != null){
                                totalAnnualRev = potentialUserNumber * patientVol;
                                $("#opportunity-edit-modal input.totalAnnualPotential").val("$"+totalAnnualRev.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                            }
                        
                        }else if(opportunityType == "Synergy Video"){
                        
                            var totalNumOfTowers = $("#opportunity-edit-modal input#totalNumOfTowers").val();
                            if(totalNumOfTowers == null || totalNumOfTowers == ''){
                                totalNumOfTowers = null;
                            }
                            
                            var potentialRevenuePerTower = $("#opportunity-edit-modal #potentialRevenuePerTower").val();
                            if(potentialRevenuePerTower == null || potentialRevenuePerTower == ''){
                                potentialRevenuePerTower = null;
                            }else{
                                potentialRevenuePerTower = parseFloat(potentialRevenuePerTower.replace('$','').replace(/,/g,''));
                            }
                            
                            if(potentialRevenuePerTower != null
                                &&  totalNumOfTowers != null){
                                totalAnnualRev = potentialRevenuePerTower * totalNumOfTowers;
                                $("#opportunity-edit-modal input.totalAnnualPotential").val("$"+totalAnnualRev.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                            }
                        
                        }else if(opportunityType == "Agreements"){
                        
                            var noChargeEquipmentValue = $("#opportunity-edit-modal input#noChargeEquipmentValue").val();
                            if(noChargeEquipmentValue == null || noChargeEquipmentValue == ''){
                                noChargeEquipmentValue = null;
                            }
                            
                            var disposablePurchaseValue = $("#opportunity-edit-modal #disposablePurchaseValue").val();
                            if(disposablePurchaseValue == null || disposablePurchaseValue == ''){
                                disposablePurchaseValue = null;
                            }else{
                                disposablePurchaseValue = parseFloat(disposablePurchaseValue.replace('$','').replace(/,/g,''));
                            }
                            
                            if(noChargeEquipmentValue != null
                                &&  disposablePurchaseValue != null){
                                totalAnnualRev = noChargeEquipmentValue * disposablePurchaseValue;
                                $("#opportunity-edit-modal input.totalAnnualPotential").val("$"+totalAnnualRev.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                            }
                        
                        }else if (opportunityType == "Synergy Installation"){
                        
                            var equipmentCost = $("#opportunity-edit-modal input#equipmentCost").val();
                            if(equipmentCost == null || equipmentCost == ''){
                                equipmentCost = null;
                            }else{
                                equipmentCost = parseFloat(equipmentCost.replace('$','').replace(/,/g,''));
                            }
                            
                            var laborAndMaterials = $("#opportunity-edit-modal #laborAndMaterials").val();
                            if(laborAndMaterials == null || laborAndMaterials == ''){
                                laborAndMaterials = null;
                            }else{
                                laborAndMaterials = parseFloat(laborAndMaterials.replace('$','').replace(/,/g,''));
                            }
                            
                            if(equipmentCost != null
                                &&  laborAndMaterials != null){
                                totalAnnualRev = equipmentCost + laborAndMaterials;
                                $("#opportunity-edit-modal input.totalBudgetary").val("$"+totalAnnualRev.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                                //$("#opportunity-edit-modal input.totalBudgetary").val("$"+totalAnnualRev.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                            }
                        
                        }// end of else-if
                        
                    }// end of populateTotalAnnualRevenue
                    
                    function calculatePartsPrice(e){
                        
                        //console.log('##--e: '+ e);
                        if(isNumber(e)){
                            var qty = parseInt($("#opportunity-edit-modal .opportunity-part-quantity").val());
                            //var price = parseFloat($("#opportunity-edit-modal .opportunity-part-unit-price").attr("data-unit-price"));
                            //console.log('##--price2: '+ $("#opportunity-edit-modal .opportunity-part-unit-price").val());
                            var price =parseFloat($("#opportunity-edit-modal .opportunity-part-unit-price").val().replace('$', "").replace(',', ""));
                            //console.log('##--price: '+ price);
                            var total = qty * price;
                            
                            $("#opportunity-edit-modal .opportunity-part-total-price").text("$" + total.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                            $("#opportunity-edit-modal .opportunity-part-total-price").attr("data-total-price", total);
                            
                            return true;
                        }
                        return false;
                    }   //  end of calculatePartsPrice
                    
                    function addPart(){
                        
                        if($("#opportunity-edit-modal button.add-opp-part").is(":disabled")){
                            return false;
                        }
                        
                        var eleFound=false;
                        $.each($("#opportunity-edit-modal .product-parts tbody tr"), function(i, v){
                            if($(v).attr("data-part-id") == $("#opportunity-edit-modal .opportunity-part-number-typeahead").attr("data-part-id")){
                                eleFound=true;
                            }
                        });
                        
                        if(eleFound){
                            alert("Part already selected. Delete and add the part");
                        } else {
                            var price =parseFloat($("#opportunity-edit-modal .opportunity-part-unit-price").val().replace('$', "").replace(',', ""));
                            //$("#opportunity-edit-modal .product-parts tbody").append('<tr data-part-id="'+$("#opportunity-edit-modal .opportunity-part-number-typeahead").attr("data-part-id")+'"><td><p class="form-control-static">'+$("#opportunity-edit-modal .opportunity-part-number-typeahead").val()+'</p></td><td><p class="form-control-static">'+$("#opportunity-edit-modal .opportunity-part-description").val()+'</p></td><td><p class="form-control-static part-quantity">'+$("#opportunity-edit-modal .opportunity-part-quantity").val()+'</p></td><td><p class="form-control-static">'+$("#opportunity-edit-modal .opportunity-part-unit-price").val()+'</p></td><td id="total" data-total="'+$("#opportunity-edit-modal .opportunity-part-total-price").attr("data-total-price")+'"><p class="form-control-static">'+$("#opportunity-edit-modal .opportunity-part-total-price").text()+'</p></td><td class="pull-right"><button class="btn btn-xs btn-primary" onclick="$(this).parent().parent().remove()">delete</button></td>');
                            $("#opportunity-edit-modal .product-parts tbody").append('<tr data-part-id="'+$("#opportunity-edit-modal .opportunity-part-number-typeahead").attr("data-part-id")+'"><td><p class="form-control-static">'+$("#opportunity-edit-modal .opportunity-part-number-typeahead").val()+'</p></td><td><p class="form-control-static">'+$("#opportunity-edit-modal .opportunity-part-description").val()+'</p></td><td><p class="form-control-static part-quantity">'+$("#opportunity-edit-modal .opportunity-part-quantity").val()+'</p></td><td><p class="form-control-static">'+"$" +price.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,')+'</p></td><td id="total" data-total="'+$("#opportunity-edit-modal .opportunity-part-total-price").attr("data-total-price")+'"><p class="form-control-static">'+$("#opportunity-edit-modal .opportunity-part-total-price").text()+'</p></td><td class="pull-right"><button class="btn btn-xs btn-primary" onclick="$(this).parent().parent().remove()">delete</button></td>');
                            
                        
                        }
                        
                        var totalAmount = 0;
                        $("#opportunity-edit-modal .product-parts tbody tr").each(function(){
                            row = $(this);
                            totalAmount += parseFloat($(this).find("td#total").attr("data-total"));
                        });
                        $("#opportunity-edit-modal .product-parts tfoot #totalProductAmount").attr("data-total", totalAmount);
                        $("#opportunity-edit-modal .product-parts tfoot #totalProductAmount").html("$" + totalAmount.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                        
                        $("#opportunity-edit-modal input.potentialRevenuePerCase").val("$"+totalAmount.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                        
                        var opportunityType = $("#opportunity-edit-modal #opportunity-type").val();
                        if(opportunityType == "Instrument Purchase"){
                            console.log('##--totalAmount: '+ totalAmount);
                            $("#opportunity-edit-modal input.totalAnnualPotential").val("$"+totalAmount.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                        
                        }
                        populateTotalAnnualRevenue();
                        $("#opportunity-edit-modal .opportunity-part-number-typeahead").val("");
                        $("#opportunity-edit-modal .opportunity-part-number-typeahead").removeAttr("data-part-id");
                        
                        $("#opportunity-edit-modal .opportunity-part-description").val("");
                        $("#opportunity-edit-modal .opportunity-part-quantity").val("");
                        $("#opportunity-edit-modal .opportunity-part-unit-price").val("");
                        $("#opportunity-edit-modal .opportunity-part-unit-price").removeAttr("data-unit-price");
                        
                        $("#opportunity-edit-modal .opportunity-part-total-price").text("");
                        $("#opportunity-edit-modal .opportunity-part-total-price").removeAttr("data-total-price");
                        
                        $("#opportunity-edit-modal button.add-opp-part").attr('disabled', 'disabled');
                        
                                
                    }   //  end of addPart
                    
                    
                    function populateOppDependentLists(e){
                        //var button = $(e.relatedTarget) // Button that triggered the modal
                        var trigger = $("button."+e).attr('data-trigger');
                        
                        
                        //var surgeonId = $("#opportunity-edit-modal #surgeon").attr('data-record-id');
                        
                        var surgeons = [];
                            /*$("#opportunity-edit-modal div.ctag-list.surgeon").children().each(function() {
                                surgeons.push($(this).attr("data-record-id"));
                            });*/
                            
                            $("#divOppSummaries div#divSurgeonSummary div").each(function() {
                                if($(this).attr("data-surgeon-id")){
                                    surgeons.push($(this).attr("data-surgeon-id"));
                                }
                            });
                            
                        //console.log('##--surgeons: '+ surgeons);
                    
                        var accountId = $("#oppDetailsView input#hiddenAccountId").val();
                        var opportunityId = $("#oppDetailsView input#opportunityId").val();
                        if(! (surgeons.length == 0 || accountId)){
                            alert('Please select Surgeon and Account.');
                            return false;
                        }
                        
                        $('#opportunity-case-modal').modal('show');
                        $("#opportunity-case-modal div#div-busy").show();
                        
                        //$('#table-dependents').bootstrapTable('destroy');
                        
                        if(e == "add-linked-cases"){
                            //table-dependents  
                            $('#opportunity-case-modal .dependent-list-header').html('Opportunity Case Selection');
                            //$('#table-dependents').attr("data-related-table", "linked-cases");
                            //console.log('##--surgeons: '+ surgeons);
                            //console.log('##--accountId: '+ accountId);
                            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.getCasesToBeLinked}",
                                 surgeons, opportunityId,
                                function(result, event) {
                                    var oppCases=[];
                                    
                                    $.each(result, function(i, v){
                                        surgeon = null;
                                        if(v.objCase.Practitioner__r)
                                            surgeon = v.objCase.Practitioner__r.Name;
                                        oppCases.push({"id": v.objCase.Id, "startDate": v.objCase.Event_Start_Date__c, "surgeon": surgeon, "account": v.objCase.Health_Care_Provider__r.Name, "procedure": v.procedureNames, "status": v.objCase.Status__c});
                                        
                                    });
                                    
                                    LINKED_CASES_LIST = oppCases;
                                    
                                    
                                    $('#table-dependents').bootstrapTable({
                                        classes: "table table-no-bordered table-striped table-hover",
                                        cache: false,
                                        pagination: true,
                                        pageSize: 5,
                                        pageList: [5, 10, 25, 50],
                                        sortable: true,
                                        idField: 'id',
                                        clickToSelect: true,
                                        columns: [ {
                                                    'field': 'state',
                                                    'checkbox': true
                                                },{
                                                    'field': 'startDate',
                                                    'title': 'Case Date',
                                                    'date': true,
                                                    'sortable': true,
                                                    'formatter': dateFormatter
                                                }, {
                                                    'field': 'surgeon',
                                                    'title': 'Surgeon',
                                                    'sortable': true
                                                }, {
                                                    'field': 'account',
                                                    'title': 'Account',
                                                    'sortable': true
                                                },{
                                                    'field': 'procedure',
                                                    'title': 'Procedure',
                                                    'sortable': true
                                                },{
                                                    'field': 'status',
                                                    'title': 'Status',
                                                    'sortable': true
                                                }]
                                        
                                    });
                                        
                                    /*constructDependentList(columns, oppCases);    */
                                    //$('#table-dependents').bootstrapTable('destroy');
                                    $('#table-dependents').bootstrapTable('load', oppCases);
                                   
                                    initLinkedListFilters('LinkedCases', oppCases);
                                    
                                    $("#opportunity-case-modal div#div-busy").hide();
                            }); //  end of Remote Action
                        } else {
                            
                            $('#opportunity-case-modal .dependent-list-header').html('Linked Opportunity Selection');
                            
                            $('#table-dependents').attr("data-related-table", "linked-opps");
                            //console.log('##--surgeons: '+ surgeons);
                            //console.log('##--accountId: '+ accountId);
                            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.getOpportunitiesToBeLinked}",
                            surgeons, opportunityId,
                            function(result, event) {
                                
                                var relatedOppTypes=[];
                                $.each(result, function(i, v){
                                    relatedOppTypes.push({"id": v.objOpportunitySurgeon.Opportunity__c, "oppName": v.objOpportunitySurgeon.Opportunity__r.Name, "oppType": v.objOpportunitySurgeon.Opportunity__r.Type, "annualRevenue": v.objOpportunitySurgeon.Opportunity__r.Potential_Revenue_per_Case__c, "closeDate": v.closeDate});
                                });
                                
                                LINKED_OPPS_LIST = relatedOppTypes;
                                //console.log('##--Linked Opps: ' + JSON.stringify(relatedOppTypes));
                                
                                $('#table-dependents').bootstrapTable({
                                        classes: "table table-no-bordered table-striped table-hover",
                                        cache: false,
                                        pagination: true,
                                        pageSize: 5,
                                        pageList: [5, 10, 25, 50],
                                        sortable: true,
                                        idField: 'id',
                                        clickToSelect: true,
                                        columns: [{
                                                    'field': 'state',
                                                    'checkbox': true
                                                }, {
                                                    'field': 'oppName',
                                                    'title': 'Opprtunity Name'
                                                }, {
                                                    'field': 'oppType',
                                                    'title': 'Opportunity Type'
                                                }, {
                                                    'field': 'annualRevenue',
                                                    'title': 'Annual Revenue'
                                                }, {
                                                    'field': 'closeDate',
                                                    'title': 'Projected Close Date',
                                                    //'date': true,
                                                    //'formatter': dateFormatterNoTime
                                                }]
                                        
                                    });
                                
                                
                                //constructDependentList(columns, relatedOppTypes);
                                
                                $('#table-dependents').bootstrapTable('load', relatedOppTypes);
                                initLinkedListFilters('LinkedOpportunities', relatedOppTypes);
                                
                                $("#opportunity-case-modal div#div-busy").hide();
                            }); //  end of Remote Action
                        }
                        
                    }   //  end of populateOppDependentLists
                    
                    
                    function constructDependentList(columns, oppList){
                        //  add headers to the table
                        
                            $.each(columns, function(i, v){
                                if(! v.checkbox){
                                    $('#table-dependents thead tr').append('<th class="clear-on-close"><input type="text" class="form-control dependent-filter" id="filter-'+v.field+'" placeholder="'+v.title+'" disabled="disabled" /></th>');
                                }
                            });
                            
                                //  Add rows to the table
                            $.each(oppList, function(i, v){
                                htm='<tr>';
                                $.each(columns, function(ind, col){
                                    if(col.checkbox){
                                        htm += '<tr data-index="'+i+'"><td class="bs-checkbox "><input data-index="'+i+'" name="btSelectItem" type="checkbox" value="'+v[col.field]+'"></td>';
                                    } else{
                                        if(col.date){
                                            htm += '<td style="">'+dateFormatter(v[col.field] || moment())+'</td>';
                                        } else{
                                            htm += '<td style="">'+(v[col.field] || "-")+'</td>';
                                        }
                                    }
                                });
                                htm += '</tr>';
                                $('#table-dependents tbody').append(htm);
                            });
                    }   //  end of constructDependentList
                    
                    function initLinkedListFilters(filterType, orgData){
                        
                        if(filterType == 'LinkedCases'){
                            //$('#divLinkedCasesFilters select[id^="filter"]').selectpicker('deselectAll'); 
                            //$('#divLinkedOpportunityFilters select[id^="filter"]').find('option').remove();
                            $("#divLinkedCasesFilters").show();
                            
                            $.each(orgData, function(i, v){
                                //console.log("index: " + i + "\t Val: " + v[col]);
                                
                                addOptionToSelect('divLinkedCasesFilters', 'filterCaseSurgeon', v["surgeon"]);
                                addProcOptionToSelect('divLinkedCasesFilters', 'filterCaseProcedure', v["procedure"]);
                                addOptionToSelect('divLinkedCasesFilters', 'filterCaseAccount', v["account"]);
                                addOptionToSelect('divLinkedCasesFilters', 'filterCaseStatus', v["status"]);
                            }); //  end of for-each
                            
                            //console.log("Dato for Select: " + JSON.stringify(OPPORTUNITY_LIST));
                            $('#divLinkedCasesFilters select[id^="filter"]').selectpicker();
                            $('#divLinkedCasesFilters select[id^="filter"]').selectpicker('deselectAll');
                            
                            $('#divLinkedCasesFilters select[id^="filter"]').on('changed.bs.select', function (e, i, newVal, oldVal) {
                                //filterOppListingTable();
                                //alert('Filtering coming soon.');
                                filterLinkedCasesTable();
                            });
                        } else {
                            
                            $("#divLinkedOpportunityFilters").show();
                            $.each(orgData, function(i, v){
                                //console.log("index: " + i + "\t Val: " + v[col]);
                                
                                addOptionToSelect('divLinkedOpportunityFilters', 'filterOpprtunityName', v["oppName"]);
                                addOptionToSelect('divLinkedOpportunityFilters', 'filterLinkOpportunityType', v["oppType"]);
                                addOptionToSelect('divLinkedOpportunityFilters', 'filterAnnualRevenue', v["annualRevenue"]);
                            }); //  end of for-each
                            
                            //console.log("Dato for Select: " + JSON.stringify(LINKED_OPPS_LIST));
                            $('#divLinkedOpportunityFilters select[id^="filter"]').selectpicker();
                            $('#divLinkedOpportunityFilters select[id^="filter"]').selectpicker('deselectAll');
                            
                            $('#divLinkedOpportunityFilters select[id^="filter"]').on('changed.bs.select', function (e, i, newVal, oldVal) {
                                
                                filterLinkedOppsTable();
                            });
                        }
                    }   //  end of initLinkedListFilters
                    
                    function filterLinkedCasesTable(){
                        
                        var table_data = $.grep(LINKED_CASES_LIST, function(value, index){
                            
                            if(hasFilteredData(value, 'divLinkedCasesFilters', 'filterCaseDate', 'startDate') &&
                                hasFilteredData(value, 'divLinkedCasesFilters', 'filterCaseSurgeon', 'surgeon') &&
                                hasFilteredData(value, 'divLinkedCasesFilters', 'filterCaseProcedure', 'procedure') &&
                                hasFilteredData(value, 'divLinkedCasesFilters', 'filterCaseAccount', 'account') &&
                                hasFilteredData(value, 'divLinkedCasesFilters', 'filterCaseStatus', 'status')){
                                //console.log("Element present");
                                return true;
                            }
                            return false;
                        }); //  end of grep LINKED_CASES_LIST
                        
                        //console.log("Filtered data: " + JSON.stringify(table_data));
                        $('#table-dependents').bootstrapTable('load', table_data);
                        
                    }   //  end of filterLinkedCasesTable
                    
                    
                    function filterLinkedOppsTable(){
                        
                        var table_data = $.grep(LINKED_OPPS_LIST, function(value, index){
                            
                            if(hasFilteredData(value, 'divLinkedOpportunityFilters', 'filterOpprtunityName', 'oppName') &&
                                hasFilteredData(value, 'divLinkedOpportunityFilters', 'filterLinkOpportunityType', 'oppType') &&
                                hasFilteredData(value, 'divLinkedOpportunityFilters', 'filterAnnualRevenue', 'annualRevenue') &&
                                hasFilteredData(value, 'divLinkedOpportunityFilters', 'filterCloseDate', 'closeDate')){
                                //console.log("Element present");
                                return true;
                            }
                            return false;
                        }); //  end of grep LINKED_OPPS_LIST
                        
                        //console.log("Filtered data: " + JSON.stringify(table_data));
                        $('#table-dependents').bootstrapTable('load', table_data);
                        
                    }   //  end of filterLinkedOppsTable
                    
                    
                    function selectDependentList(){
                        
                        var type = $('#table-dependents').attr("data-related-table");
                        var IDs = [];
                        
                        /*
                        $("#table-dependents tbody").find('input[type="checkbox"]').each(function(){
                            if($(this).is(':checked')){
                                IDs.push($(this).val());
                            }
                        });
                        
                        return false;
                        */
                        
                        //console.log("selected lines: " + JSON.stringify($('#table-dependents').bootstrapTable('getSelections')));
                        if($('#table-dependents').bootstrapTable('getSelections')){
                            $.each($('#table-dependents').bootstrapTable('getSelections'), function(i, v){
                                IDs.push(v.id);
                            });
                        }
                        
                        //console.log('Selected Linked Opps: ' + IDs);
                        
                        if(type == 'linked-opps'){
                            
                            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.saveLinkedOpportunities}",
                                $("#oppDetailsView input#opportunityId").val(), IDs,
                                function(result, event) {
                                    if(event.statusCode == 200){
                                        loadOpportunityActivities($("#oppDetailsView select#activityFilter").val());
                                        $("#divLinkedOppsSummary p.remove-when-present").hide();
                                        $.each(result, function(i, v){
                                            $("#divLinkedOppsSummary").append("<div id='"+v.Id+"' data-linked-opp-id='"+v.Linked_Opportunity__c+"'><dl><dt>"+v.Linked_Opportunity__r.Name+"</dt><dd>"+v.Linked_Opportunity__r.Type+"<div class='pull-right'><a href='#' onclick='deleteSublistItem(\"LinkedOpportunity\", \""+v.Id+"\")'>Delete</a></div></dd></dl></div>");
                                        });
                                        
                                    }
                            }); //  end of remote call to save linked Opps
                        } else {
                            
                            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.saveLinkedCases}",
                                $("#oppDetailsView input#opportunityId").val(), IDs,
                                function(result, event) {
                                    if(event.statusCode == 200){
                                        
                                        loadOpportunityActivities($("#oppDetailsView select#activityFilter").val());
                                    }
                            }); //  end of remote call to save linked Cases
                            
                        }
                        
                        
                        
                        /*
                        var type = $('#table-dependents').attr("data-related-table");
                        var selectedItems = $('#table-dependents tbody tr').bootstrapTable('getSelections');
                        
                        $("#"+type+" tbody").find("tr").each(function(){ IDs.push($(this).attr("data-item-id")); });
                        
                        console.log("selectedItems: " + JSON.stringify(selectedItems));
                        $("#table-dependents tbody").find("tr").each(function(){
                            var selectedRow = $(this)
                            console.log("selectedRow: " + JSON.stringify(selectedRow));
                            
                            if($(this).find("td:first").find('input[type="checkbox"]').is(':checked')){
                                id= $(this).find('input[type="checkbox"]').val();
                                var rowhtml='';
                                $(this).find('td').not(':first').each(function(i, e){
                                    rowhtml += "<td>" + $(e).text() + "</td>";
                                });
                                $("#"+type+" tbody").append('<tr data-item-id="'+id+'">'+rowhtml+'<td style="width:10%; vertical-align:middle;text-align:right"><button class="btn btn-xs btn-primary" onclick="$(this).parent().parent().remove()">delete</button></td>');
                            }
                             
                        });
                        */
                        $('#opportunity-case-modal').modal('hide');
                    }   //  end of selectDependentList
                    
                    
                    function loadOpportunityActivities(activityType){
                        //console.log('##--activityType:'+ activityType);
                        $("i.divNextSteps-busy").show();
                        $("i.divCompletedSteps-busy").show();
                        
                        // added by chad for 4.1
                        // store activities in a global object to make setting up the links much easier
                        window.oppActivities = {};

                        Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.retreiveActivities}",
                                activityType,//'All Activities',
                                $("#oppDetailsView input#opportunityId").val(),
                                function(result, event) {
                                    if(event.statusCode == 200){
                                        // clear the existing activities
                                        $("#divNextSteps").empty();
                                        $("#divCompletedSteps").empty();
                                        
                                        $.each(result, function(i, v){
                                            
                                            oppActivities[v.oppy.recId] = v.oppy;

                                            htm = constructActivity(v);
                                            
                                            console.log('##--log Date: '+ dateFormatter(moment(v.logDate)));
                                            console.log('##--oppy log Date: '+ dateFormatter(moment(v.oppy.logDate)));  
                                            
                                            console.log('##--log Date: '+ moment(v.logDate).isSameOrBefore(moment()));
                                            if ( v.oppy.activityType == 'TASK' ) {

                                                if ( v.oppy.stage == 'Completed') {
                                                    $("#divCompletedSteps").append(htm);
                                                } else {
                                                    $("#divNextSteps").append(htm);
                                                }

                                            } else {
                                                
                                                if(moment(v.oppy.logDate).isSameOrBefore(moment())){ //  moment().startOf('day')
                                                    $("#divCompletedSteps").append(htm);
                                                } else{
                                                    $("#divNextSteps").append(htm);
                                                }

                                            }
                                            
                                        }); //  end of for-each activity
                                        $("i.divNextSteps-busy").hide();
                                        $("i.divCompletedSteps-busy").hide();

                                    }

                            }); //  end of remote call to get the existing Activites
                    }   //  end of loadOpportunityActivities
                    

                    function showAddNotes(){
                        $("#opportunity-notes-modal span#addNoteErrors").html('');
                        $("#opportunity-notes-modal #oppNoteDate").html(dateFormatter(moment()));
                        $("#opportunity-notes-modal").modal('show'); 
                        $('#opportunity-notes-modal').attr('data-rec-id','');
                    }   //  end of showAddNotes
                    
                    function showAddTasks() {

                        $("#task-modal div.dueDate-container").data("DateTimePicker").clear();
                        
                        $("#task-modal .hide-on-create").hide();

                        $("h4.modal-title.create").show();
                        $("h4.modal-title.edit").hide();

                        $("#task-modal .association-label").text("Opportunity");
                        $("#task-modal select.task-type").val( "opportunity" );

                        // set the modal title
                        var taskTypeLabel = $("#task-modal select.task-type").find("option:selected").text();
                        $("#task-modal .task-type-label").text( taskTypeLabel );

                        $("#task-modal .delete").show();
                        $("#task-modal select.task-type").attr("disabled",true);

                        $("#task-modal select.subject").hide();
                        $("#task-modal .other-subject").show();
                        $("#task-modal input.other-subject").val("");
                        
                                                                                    
                        var recordId = $("#oppDetailsView input#opportunityId").val();
                        var name = $("div.opportunityName").first().text();
                        var accountName = $("div.accountName").first().text();
                        var accountId = $("#oppDetailsView #hiddenAccountId").val();                            

                        $("#task-modal .associated-object").val(name);
                        $("#task-modal .associated-object").attr("data-record-id", recordId);                         
                        $("#task-modal input.account").attr("data-record-id", accountId).val(accountName);
                                    
                        $("#task-modal div.ctag-list.surgeon").empty();
                        $("#divSurgeonSummary div").each(function(i, d) {
                            var surgId = $(d).attr("data-surgeon-id");
                            var name = $(d).find("dt").text();
                            if ( surgId && name ) {
                                $("#task-modal div.ctag-list.surgeon").append(obj2ctag({
                                    Id: surgId,
                                    Name: name
                                }));
                            }

                        });

                        // remove "free-form" option from subject
                        $("#task-modal select.subject option[value=free-form]").remove;

                        $("#task-modal .association-container").show();
                        $("#task-modal .account-container").show();
                        $("#task-modal .surgeon-container").show();

                        var teamId = $("input#hiddenAccountTeamId").val(); 
                        console.log('##--showAddTasks.teamId: '+ teamId);
                        loadTerritoryTreeForTeam("treeTaskTeam", "task-modal");
                        if ( teamId ) {
                                        
                            // set the team and trigger change to update the task owner list
                            DDTEAMTREE=true;
                            
                            $("#task-modal #taskTeamButton").closest("div.dropdown").find("input[value='"+teamId+"']").click();

                        }
                                                                       
                        // view list should not be visible
                        $("#task-modal button.association-button").hide();

                        $("#task-modal").modal("show");

                    }
                    
                    /*
                    Added by Srinivas Satooor on 8.21.2017 for Release 4.4 CID-000440
                    This method is called from opp detail, activity dropdown and will
                    show the modal to add attachments.
                    */
                    function showAddAttachments(){
                    
                        $("#attachment-modal span#attachment-modal-error").html('');
                        $("#attachment-modal #oppFileName").val(""); 
                        $('#attachment-modal').attr('data-rec-id','');
                        $('#attachment-modal button.save').show(); 
                        $('#attachment-modal button.download').hide();
                        $('#attachment-modal button.delete').hide();
                        $('#attachment-modal h4.edit').hide();
                        $('#attachment-modal h4.create').show();
                        $("#attachment-modal span.choosefile").removeAttr('disabled');
                        $("#attachment-modal span.choosefile").removeAttr('readonly');
                        $("#attachment-modal input#oppFileInput").removeAttr('disabled');
                        $("#attachment-modal input#oppFileInput").removeAttr('readonly'); 
                    
                        $("#attachment-modal").modal("show");
                    }// end of showAddAttachments
                    
                    //added by srinivas.sattoor on 8.21.2017 for release 4.4 CID-000440
                    function editAttachment(opp){
                        console.log('##--editAttachment.opp: '+JSON.stringify(opp));
                        $("#attachment-modal #oppFileName").val(opp.notes); 
                        $('#attachment-modal').attr('data-rec-id',opp.recId); 
                        //$('#attachment-modal button.save').hide(); 
                        $('#attachment-modal button.download').show();
                        $('#attachment-modal button.delete').show();
                        $('#attachment-modal h4.edit').show();
                        $('#attachment-modal h4.create').hide();
                        $("#attachment-modal span.choosefile").attr('disabled','disabled');
                        $("#attachment-modal span.choosefile").attr('readonly','true');
                        $("#attachment-modal input#oppFileInput").attr('disabled','disabled');
                        $("#attachment-modal input#oppFileInput").attr('readonly','true');
                        $("#attachment-modal").modal("show");
                    }//end of editAttachment 
                     
                    function editTask(taskId){
                        // editing a task
                        $("h4.modal-title.create").hide();
                        $("h4.modal-title.edit").show();

                        Visualforce.remoting.Manager.invokeAction("CS_AROpportunityCC.retrieveMyTaskDetail", taskId,
                        function(t, event) {
                            $(".task-busy").hide();
                            if ( event.status ) {
                                
                                $("#task-modal .modal-title.create").hide();
                                $("#task-modal .hide-on-create").show();
                                $("#task-modal .modal-title.edit").show();
                                $("#task-modal .delete").show();

                                $("#task-modal select.task-type").attr("disabled",true);
                                
                                $("#task-modal").attr("data-record-id", taskId);
                                
                                // priority button
                                $("#task-modal button.priority").each(function() {
                                    if ( $(this).attr("data-value") == t.priority ) {
                                        $(this).removeClass("btn-default").addClass("btn-primary");
                                    } else if ( $(this).hasClass("btn-primary") ) {
                                        $(this).removeClass("btn-primary").addClass("btn-default");
                                    }
                                });

                                // status button
                                $("#task-modal button.status").each(function() {
                                    if ( $(this).attr("data-value") == t.status ) {
                                        $(this).removeClass("btn-default").addClass("btn-primary");
                                    } else if ( $(this).hasClass("btn-primary") ) {
                                        $(this).removeClass("btn-primary").addClass("btn-default");
                                    }
                                });

                                // subject picklist or freeform text
                                // always use the free-form input by not populating the select pull down - chad 2017-06-22
                                var found = false;
                                $("#task-modal select.subject option").each(function() {
                                    
                                    var optionVal = $(this).val();

                                    /*
                                    if ( t.subject == optionVal ) {
                                        $(this).attr("selected",true);
                                        found = true;
                                    } else {
                                        $(this).removeAttr("selected");
                                    }
                                    */
                                    
                                    

                                });

                                if ( !found && typeof t.subject !== 'undefined' && t.subject.length > 0 ) {
                                    // subject wasn't in picklist but it does exist show it in the freeform text
                                    $("#task-modal select.subject").hide();
                                    $("#task-modal .other-subject").show();
                                    $("#task-modal input.other-subject").val( globalDecodeEntities(t.subject));
                                }

                                $("#task-modal .association-label").text(t.taskType);
                                $("#task-modal select.task-type").val( t.taskType.toLowerCase() );
                                
                                // set the task modal header
                                var taskTypeLabel = $("#task-modal select.task-type").find("option:selected").text();
                                $("#task-modal .task-type-label").text( taskTypeLabel );

                                var recordId = t.sourceId;
                                var name = t.source;
                                var accountName = t.accountName;
                                var accountId = t.accountId;                                

                                $("#task-modal .associated-object").val(name);
                                $("#task-modal .associated-object").attr("data-record-id", recordId);                         
                                $("#task-modal input.account").attr("data-record-id", accountId).val(accountName);
                                    
                                $("#task-modal div.ctag-list.surgeon").empty();
                                //Added by srinivas sattoor 08.03.2017
                                var lstTaskRelations = t.lstTaskRelations;
                                for ( var i=0; i < lstTaskRelations.length; i++ ) {
                                
                                    $("#task-modal div.ctag-list.surgeon").append(obj2ctag({
                                      Name: globalDecodeEntities(lstTaskRelations[i].Relation.Name),
                                      Id: lstTaskRelations[i].RelationId
                                    }));
                
                                }
                                /*for ( var i=0; i < t.additionalSurgeons.length; i++) {
                                   $("#task-modal div.ctag-list.surgeon").append(obj2ctag({
                                        Id: t.additionalSurgeons[i].id,
                                        Name: t.additionalSurgeons[i].name
                                    }));
                                }*/

                                // remove "free-form" option from subject
                                $("#task-modal select.subject option[value=free-form]").remove;

                                $("#task-modal .association-container").show();
                                $("#task-modal button.association-button").show();
                                $("#task-modal .account-container").show();
                                $("#task-modal .surgeon-container").show();
                                                                       

                                /*if ( t.teamId ) {
                                    // set the team and trigger change to update the task owner list

                                    $("#treeTaskTeam").one("team.tree.created", function() {

                                        // put this at the end of the task queue to try and further reduce race conditions
                                        window.setTimeout(function() {
                                            DDTEAMTREE=true;
                                            $("#task-modal #taskTeamButton").closest("div.dropdown").find("input[value='"+t.teamId+"']").click(); 
                                        });

                                    });
                                    
                                }*/

                                // the other misc inputs
                                $("#task-modal input.dueDate").val(t.s_dueDate);
                                $("#task-modal textarea.description").val(globalDecodeEntities(t.description));
                                $("#task-modal select.task-owner").val(t.taskOwnerId);

                                $("#task-modal span.createdBy").text(globalDecodeEntities(t.createdBy));
                            
                                // the task owner list is built using a remoting call, we need to wait until it's finished
                                // before setting the owner
                                $("#task-modal #taskTeamButton").one("task.team.changed", function() {
                                    $("#task-modal select.task-owner").val(t.taskOwnerId).change();
                                });
                                
                                // view list should not be visible
                                $("#task-modal button.association-button").hide();

                                $("#task-modal").modal("show");
                                
                            } else {

                                $("span.my-task-error").text(" - "+event.message);
                            }
                        });
                        
                    }
                    
                    // end added by fer

                    function addOpportunityNote(){
                        $("#opportunity-notes-modal span#addNoteErrors").html('');
                        
                        note = $("#opportunity-notes-modal #oppNotes").val();
                        if(note == null || note == ''){
                            $("#opportunity-notes-modal span#addNoteErrors").html('Please enter a note');
                            return false;
                        }
                        noteId =$("#opportunity-notes-modal").attr('data-rec-id') || '';
                            //  if valid save the note
                        Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.CS_AROpportunityCC.createNote}",
                            $("#oppDetailsView input#opportunityId").val(), note, noteId,
                            function(result, event) {
                                if(event.statusCode == 200){
                                    
                                    //loadOpportunityActivities('All Activities');
                                    loadOpportunityActivities($("#oppDetailsView select#activityFilter").val());
                                    
                                    $('#opportunity-notes-modal').modal('hide');
                                }
                        }); //  end of remote call to save linked Opps
                        
                    }   //  end of addOpportunityNote
                    
                    function linkActivity(opp){

                        var type = opp.activityType;
                        var recId = opp.recId;

                         if(type=='SURGICAL CASE')
                         {
                             window.location="/ARCaseDetail?id="+recId;
                         }
                         if(type=='NOTE')
                         {                        
                            editNote(opp);                         
                         }
                         if(type=='OPPORTUNITY')
                         {
                             window.location ="/AROpportunityDetail?id="+recId;
                         }
                         if(type=='TASK')
                         {
                            editTask(recId);
                         }
                         
                         if(type=='ATTACHMENT')
                         {
                            editAttachment(opp);
                         }
                         /*
                            Vishnu Release 4.4
                                To show the lead details
                         */
                         else if(type == 'LEAD'){
                            showLeadDetails(opp);
                         }
                    } 
                    
                    function editNote(opp){
                         
                        var recId = opp.recId;
                        var type = opp.activityType;
                        var notes = "";
                        if ( opp.notes ) {
                            notes = opp.notes;
                        } 
                        var owner = opp.logOwner;

                        $("#opportunity-notes-modal span#addNoteErrors").html('');
                        var username=$('.uname').text();
                        if(owner!=username)//updated by srinivas sattoor 08.10.2017
                        {
                            return;
                        }
                        else if(type=='NOTE' && owner==username)
                        {
                              $('#opportunity-notes-modal').modal('show'); 
                              $("#opportunity-notes-modal #oppNoteDate").html(dateFormatter(moment()));
                              $('#opportunity-notes-modal').attr('data-rec-id',recId) ;
                              notes=notes.replace(/y~;/g, '\"'); 
                              $("#opportunity-notes-modal #oppNotes").val(globalDecodeEntities(notes));
                              $("#opportunity-notes-modal button.btn-delete" ).show();
                              noteId = recId;                      
                        }
                    
                    } 
                    
                    function getUIClassForActivity(type){
                        console.log('##--getUIClassForActivity.type: '+type);
                        switch(type){
                            case "LOG": 
                                return "fa fa-folder-open-o fa-1x fa-inverse fa-border fa-meeting-log";
                            case "SURGICAL CASE":
                                return "fa fa-calendar fa-1x fa-inverse fa-border fa-meeting-surgicalcase";
                            case "NOTE":
                                return "fa fa-pencil-square-o fa-1x fa-inverse fa-border fa-meeting-note";
                            // added by chad
                            case "TASK":
                                return "fa fa-tasks fa-rotate-180 fa-1x fa-inverse fa-border fa-meeting-task";
                            case "LEAD":
                                return "fa fa-star fa-1x fa-inverse fa-border fa-meeting-lead"; 
                                //added by srinivas.sattoor on 8.21.2017 for release 4.4 CID-000440
                            case "ATTACHMENT":
                                return "fa fa-paperclip  fa-1x fa-inverse fa-border fa-meeting-attachment"; 
                            // end added by chad
                        }   //  end of switch
                        
                        //fa fa-calendar fa-2x fa-inverse fa-border fa-meeting-background
                    }   //  end of getUIClassForActivity
                    
                    //Date Format Modified to MM-DD-YYYY format in Release 2.2(CID:-000045) by Mimansha Samal
                    function constructActivity(v){
                        var notes;
                        var link;
                        var username=$('.uname').text();
                        var iconStyle=""; 
                        
                        var notesparam= (v.oppy.notes);
                        if ( typeof notesparam === "undefined" ) { 
                           notesparam = ""; 
                        } else {
                           notesparam = globalDecodeEntities(notesparam);
                        }
                        
                        var styleStr = "";        
                        if(v.oppy.activityType=='SURGICAL CASE' || v.oppy.activityType=='OPPORTUNITY' 
                                    || (v.oppy.activityType=='NOTE' && v.oppy.logOwner==username) || v.oppy.activityType=='TASK' 
                                    || v.oppy.activityType=='LEAD' || v.oppy.activityType=='ATTACHMENT') { //added by srinivas.sattoor on 8.21.2017 for release 4.4 CID-000440                              
                            
                            if(v.oppy.activityType =='OPPORTUNITY') {
                                iconStyle='style="background-color:#800080 !important"';  
                            }

                            styleStr = "style='cursor:pointer;color:#3A9DDB;padding-left:0px;'";

                        } else {
                            link ='style="padding-left:0px"'; 
                            styleStr = 'style="padding-left:0px"'; 
                        }
                           
                        /*htm = '<div class="col-sm-12 form-group detail_div"> '+
                              '     <div class="col-sm-3 form-group detail_div">  '+
                              '         <i class="'+getUIClassForActivity(v.oppy.activityType)+'"></i> '+
                              '     </div> '+
                              '     <div class="col-sm-6 form-group detail_div"> '+ 
                              '         '+v.oppy.activityType+' <br/> '+
                              '         '+v.oppy.notes +
                              '     </div> '+
                              '     <div class="col-sm-3 form-group detail_div"> '+ 
                              '         '+ moment(v.oppy.logDate).format("MM-DD-YYYY h:mm A") +
                              '     </div> '+
                              ' </div>';*/
                              
                         htm = '<div class="col-sm-12 form-group detail_div" data-record-id="'+v.oppy.recId+'"> '+
                                 '     <div class="col-sm-1 form-group detail_div axis-detail-pg-data-href" style="margin-bottom:5px !important" >  '+
                                 '         <i class="'+getUIClassForActivity(v.oppy.activityType)+'"  '+iconStyle+'  ></i> '+
                                 '     </div> '+
                                 '     <div id="'+v.oppy.recId+'" class="col-sm-8 form-group detail_div" style="word-break:normal;padding:0 !important"> '+
                                 '         <div class="col-sm-12 form-group activity-link '+v.oppy.activityType+'" '+styleStr+' data-type="textarea" >'+ 
                                 '         '+v.oppy.activityType+''+                                 
                                 '         </div> '+                                 
                                 '         <span class="notes">'+notesparam + '</span>'+  
                                 '     </div> '+
                                 '     <div  class="col-sm-3 form-group detail_div" style="padding-left:0px;padding-right:0px;" > '+ 
                                 '         '+ v.oppy.logOwner +' <br/> '+
                                 '         '+ dateFormatter(v.oppy.logDate) +
                                 '     </div> '+                                 
                                 ' </div>';
                        return htm;
                    }   //  end of constructActivity
                    
                    
                    function isEditOpportunityInputsValid(){

                        if(! $("#opportunity-modal #opportunity-owner").val() || 
                            ! $("#opportunity-modal #opportunityName").val() ||
                            ! $("#opportunity-modal #account").val() ||
                            ! $("#opportunity-modal #closeDate").val() || 
                            ! $("#opportunity-modal #competitive-conversion").val()  
                            ){
                            
                            return false;
                        } 
                        return true;
                    }   //  end of isEditOpportunityInputsValid
                    
                    function isClosedLostPopulatedWhenStageIsClosed(){
                    
                        var stageName = $("#opportunity-edit-modal #stage").val();
                        var closedLostReason = $("#opportunity-edit-modal select#opp-edit-closed-lost-reason").val();
                        console.log('##--isClosedLostPopulatedWhenStageIsClosed.stageName: '+ stageName);
                        console.log('##--isClosedLostPopulatedWhenStageIsClosed.closedLostReason: '+ closedLostReason);
                        if(stageName == 'Closed - Lost' && closedLostReason == 0){
                        
                            return false; 
                        
                        }else{
                            return true;
                        }
                    
                    }// end of isClosedLostPopulatedWhenStageIsClosed
                    
                    function isClosedOpportunityValid(){ 
                    
                        if(! $("#opportunity-stage-close-modal select#opportunity-stage-closed").val() ){
                            
                            return false;
                        }
                        
                        if( $("#opportunity-stage-close-modal select#opportunity-stage-closed").val()  == 'Closed - Lost' &&
                            ! $("#opportunity-stage-close-modal select#closed-lost-reason").val()){
                            return false;
                        }
                        
                        return true;
                    
                    }//end of isClosedOpportunityValid 
                    
                    function obj2ctag(obj) {
                        var label = globalDecodeEntities(obj.Name);
                        var id = obj.Id;
            
                        var ctag = '<span class="ctag alert alert-info" data-record-id="'+id+'">';
                        ctag += label
                        ctag += '&nbsp;<span data-role="remove-tag"></span></span>';
                        
                        return ctag;
                    }
            
                    $("div.ctag-list").on("click","[data-role=remove-tag]", function() {
                        // removes tags from a tag-list
                        $(this).parent().remove();
                    });        
            
                    function search(q, controllerMethod, successCallback, errorCallback) {
                        // calls a search method on the controller, method passed in as a param
            
                        Visualforce.remoting.Manager.invokeAction(controllerMethod,
                        q,
                        function(result, event) {
                            if (event.status) {
                                successCallback(result);
                            } else {
                                if ( typeof errorCallback === 'function' ) {
                                    errorCallback(event);
                                } else {
                                    console.log("Errors returned but no error handler found");
                                }
                            }
                        });
                    
                    }
                    
                    //moved to ARTemplate by Srinivas Sattoor Release 3.2 
                    /*function isNumber(evt) {
                        evt = (evt) ? evt : window.event;
                        var charCode = (evt.which) ? evt.which : evt.keyCode;
                        if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                            return false;
                        }
                        return true;
                    }   //  end of isNumber
                    
                    //Date Format Modified to MM-DD-YYYY format in Release 2.2(CID:-000045) by Mimansha Samal
                    function dateFormatter(val){
                        //return moment(val).format('M/D/YYYY');
                        return moment(val).format("MM-DD-YYYY h:mm A");//YYYY-MM-DD, hh:mm:ss);
                    }
                    
                    //Date Format Modified to MM-DD-YYYY format in Release 2.2(CID:-000045) by Mimansha Samal
                    function dateFormatterNoTime(val){
                        //return moment(val).format('M/D/YYYY');
                        return moment(val).format("MM-DD-YYYY");//YYYY-MM-DD, hh:mm:ss);
                    }*/

                    /*
                        Vishnu Release 4.4
                            Adding methods that will be useful in Lead conversion
                    */
                    function showLeadDetails(opp){
                        console.log('##--opp: ' + JSON.stringify(opp));
                        console.log('opp.recId'  + opp.recId);
                        Visualforce.remoting.Manager.invokeAction("CS_ARCCExtension.retrieveLeadDetails",
                        opp.recId,
                        function(result, event) {
                            if (event.status) {
                                //  TODO: Add the logic to show the Lead Details modal pop-up
                                renderLeadDetails(result, "#divLeadDetailsModal", true);
                                //$("#lead-details-modal").modal('show');
                            } else {
                                //  TODO: Display Error
                            }
                        }); //  end of remote action to get the Conf Member details

                    }   //  end of showLeadDetails

                </script>
            </div>
          
        </apex:define>
    </apex:composition>

</apex:page>